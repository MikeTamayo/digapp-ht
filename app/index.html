<!doctype html>

<html lang="">

<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="generator" content="Polymer Starter Kit" />
  <title>DIG</title>
  <!-- Place favicon.ico in the `app/` directory -->

  <!-- Chrome for Android theme color -->
  <meta name="theme-color" content="#2E3AA1">

  <!-- Web Application Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Tile color for Win8 -->
  <meta name="msapplication-TileColor" content="#3372DF">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="PSK">
  <link rel="icon" sizes="192x192" href="images/touch/chrome-touch-icon-192x192.png">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Polymer Starter Kit">
  <link rel="apple-touch-icon" href="images/touch/apple-touch-icon.png">

  <!-- Tile icon for Win8 (144x144) -->
  <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">

  <!-- build:css styles/main.css -->
  <!-- Must link leaflet css (https://github.com/leaflet-extras/leaflet-map/issues/46) -->
  <link rel="stylesheet" href="bower_components/leaflet/dist/leaflet.css">
  <link rel="stylesheet" href="styles/main.css">
  <!-- endbuild-->

  <!-- build:js bower_components/webcomponentsjs/webcomponents-lite.min.js -->
  <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <!-- endbuild -->

  <script src="scripts/google-analytics.js"></script>
  
  <!-- will be replaced with elements/elements.vulcanized.html -->
  <link rel="import" href="elements/elements.html">
  <!-- endreplace-->

  <link rel="import" href="styles/custom-icons.html">
  <link rel="import" href="styles/icon-styles.html">
  <link rel="import" href="styles/search-styles.html">
  <style is="custom-style" include="icon-styles"></style>
  <style is="custom-style" include="search-styles"></style>
</head>

<body unresolved class="fullbleed layout vertical">
  <span id="browser-sync-binding"></span>

  <template is="dom-bind" id="app">

    <!-- exposes clientConfig object which is a container for data
      transform functions -->
    <client-config config="{{clientConfig}}"></client-config>

    <!--get app configuration from server -->
    <iron-ajax
      auto
      url="/config"
      handle-as="json"
      last-response="{{config}}">
    </iron-ajax>

    <!--initialize new elastic client connection to server
      esclient can be used throughout the application lifecycle -->
    <elastic-client
      config="[[config.elasticConfig]]"
      client="{{esclient}}">
    </elastic-client>

    <!-- Main Search Query -->
    <elastic-client-highlight-builder
      fields='["*"]'
      pre-tags="<highlight>"
      post-tags="</highlight>"
      number-of-fragments="0"
      ejs-highlight="{{highlight}}">
    </elastic-client-highlight-builder>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      page="{{pageNum}}"
      page-size="{{pageSize}}"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{searchResults}}"
      last-error="{{searchError}}"
      result-count="{{resultCount}}"
      aggregations="[]"
      filters="[[filterArray]]"
      sort="{{sort}}"
      loading="{{loading}}"
      request-as-json="{{esRequest}}">
    </elastic-client-search>

    <create-filter-array
      facet-selection="[[facetSelection]]"
      filter-array="{{filterArray}}">
    </create-filter-array>

    <json-transform
      data-in="{{searchResults}}"
      data-out="{{records}}"
      transform-function="[[clientConfig.transforms.relatedEntities.webpage]]">
    </json-transform>

    <!-- Facets -->
    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{countryResult}}"
      last-error="{{countryError}}"
      aggregations="{{buildArray(countryAgg)}}"
      filters="[[filterArray]]"
      loading="{{countryLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{cityResult}}"
      last-error="{{cityError}}"
      aggregations="{{buildArray(cityAgg)}}"
      filters="[[filterArray]]"
      loading="{{cityLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{phoneEmailResult}}"
      last-error="{{phoneEmailError}}"
      aggregations="{{buildArray(phoneEmailAgg)}}"
      filters="[[filterArray]]"
      loading="{{phoneEmailLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{publisherResult}}"
      last-error="{{publisherError}}"
      aggregations="{{buildArray(publisherAgg)}}"
      filters="[[filterArray]]"
      loading="{{publisherLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{nameResult}}"
      last-error="{{nameError}}"
      aggregations="{{buildArray(nameAgg)}}"
      filters="[[filterArray]]"
      loading="{{nameLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{ageResult}}"
      last-error="{{ageError}}"
      aggregations="{{buildArray(ageAgg)}}"
      filters="[[filterArray]]"
      loading="{{ageLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{ethnicityResult}}"
      last-error="{{ethnicityError}}"
      aggregations="{{buildArray(ethnicityAgg)}}"
      filters="[[filterArray]]"
      loading="{{ethnicityLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{heightResult}}"
      last-error="{{heightError}}"
      aggregations="{{buildArray(heightAgg)}}"
      filters="[[filterArray]]"
      loading="{{heightLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{weightResult}}"
      last-error="{{weightError}}"
      aggregations="{{buildArray(weightAgg)}}"
      filters="[[filterArray]]"
      loading="{{weightLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{hairColorResult}}"
      last-error="{{hairColorError}}"
      aggregations="{{buildArray(hairColorAgg)}}"
      filters="[[filterArray]]"
      loading="{{hairColorLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{eyeColorResult}}"
      last-error="{{eyeColorError}}"
      aggregations="{{buildArray(eyeColorAgg)}}"
      filters="[[filterArray]]"
      loading="{{eyeColorLoading}}">
    </elastic-client-search>
    <!-- End Facets -->

    <dig-logger
      supertype="Search"
      subtype="SubmitQuery"
      value="[[logMessage]]"
      username="[[config.username]]">
    </dig-logger>

    <search-logger
      query-value="[[queryValue]]"
      age-facet-selection="[[facetSelection.age]]"
      city-facet-selection="[[facetSelection.city]]"
      country-facet-selection="[[facetSelection.country]]"
      date-facet-selection="[[facetSelection.dateCreated]]"
      email-facet-selection="[[facetSelection.email]]"
      ethnicity-facet-selection="[[facetSelection.ethnicity]]"
      eye-facet-selection="[[facetSelection.eyeColor]]"
      hair-facet-selection="[[facetSelection.hairColor]]"
      height-facet-selection="[[facetSelection.height]]"
      name-facet-selection="[[facetSelection.name]]"
      phone-facet-selection="[[facetSelection.phone]]"
      publisher-facet-selection="[[facetSelection.website]]"
      weight-facet-selection="[[facetSelection.weight]]"
      log-message="{{logMessage}}">
    </search-logger>

    <paper-header-panel class="flex" mode="waterfall">

      <!-- Search toolbar -->
      <paper-toolbar>
        <img class="bottom" src="images/dig-logo-original.png" alt="">
        <div class="bottom drawer-spacer"></div>
        <!-- Hide until we can support multiple search types.
        <div class="bottom v-divider"></div>
        <elastic-type-selector class="bottom white-input-container"
          available-types="{{config.elasticTypes}}"
          elastic-types="{{esTypes}}">
        </elastic-type-selector>
        -->
        <div class="bottom v-divider"></div>
        <div class="bottom flex">
            <elastic-client-input class="white-input-container"
              field="_all"
              value="{{queryValue}}"
              query="{{ejsQuery}}"
              label="Enter Keywords"
              advanced="[[advancedSearch]]"
              autobuild="true">
            </elastic-client-input>
        </div>
        <paper-icon-button class="bottom" icon="custom-icons:show-all" title="Show All Results for Selected Facets" on-tap="_showAll"></paper-icon-button>
        <a class="bottom" href="." style="color: #ffffff;">
          <paper-icon-button icon="clear" title="Reset Page"></paper-icon-button>
        </a>
        <batch-phone class="bottom" query-value="{{queryValue}}"></batch-phone>

        <batch-image-search class="bottom" query-value="{{queryValue}}" memex-user=[[config.memexUser]] memex-password=[[config.memexPassword]] blur="[[blurImages]]"></batch-image-search>

        <!-- Add a top margin to the user settings so it aligns vertically with the buttons in the elastic-client-input -->

        <load-user-info class="bottom"
          show-search
          client="[[esclient]]"
          loading="[[loading]]"
          username="[[config.username]]"
          advanced-search="{{advancedSearch}}"
          blur-images="{{blurImages}}"
          search-text="{{queryValue}}"
          facets="{{facetSelection}}"
          es-request="{{esRequest}}"
          user-index="[[config.userIndex]]"
          user-type="[[config.userType]]"
          enable-save-btn="[[enableSaveBtn(searchResults, searchError)]]"
          show-save-btn>
        </load-user-info>
      </paper-toolbar>

      <paper-drawer-panel drawer-width="320px">

        <!-- Sidebar on left side -->
        <paper-header-panel drawer>
          <iron-pages attr-for-selected="data-type" selected="webpage">
            <section data-type="webpage">
              <!--TODO: create different sort for all types + different elastic-client-searches for all types -->
              <elastic-sort-input sort-string="{{offerSortString}}" field="dateCreated"></elastic-sort-input>
              <elastic-sort input-string="{{offerSortString}}" sort="{{sort}}"></elastic-sort>

              <div class="h-divider"></div>
              <selected-facets-display facet-selection="{{facetSelection.dateCreated}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{facetSelection.country}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{facetSelection.city}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{facetSelection.phone}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{facetSelection.email}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{facetSelection.website}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{facetSelection.name}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{facetSelection.age}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{facetSelection.ethnicity}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{facetSelection.height}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{facetSelection.weight}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{facetSelection.hairColor}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{facetSelection.eyeColor}}"></selected-facets-display>

              <div id="date" class="facet-header">
                <span class="facet-toggle" title="Toggle Date Facet List" on-tap="toggleList">Date</span>
                <iron-icon id="date-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Date Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="date-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Date Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <iron-collapse id="date-list" class="facet-list" opened>
                <date-range-display
                  facet-selection="{{facetSelection.dateCreated}}">
                </date-range-display>
              </iron-collapse>

              <div id="country" class="facet-header">
                <span class="facet-toggle" title="Toggle Country Facet List" on-tap="toggleList">Country</span>
                <iron-icon id="country-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Country Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="country-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Country Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="countryAgg"
                field="mainEntity.availableAtOrFrom.address.addressCountry"
                count="{{countryCount}}"
                ejs-aggregation="{{countryAgg}}"
                type="terms"
                order="{{countrySortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Country"
                    buckets="[[countryResult.aggregations.countryAgg.countryAgg.buckets]]"
                    loading="[[countryLoading]]"
                    error="[[countryError]]"
                    facet-selection="{{facetSelection.country}}"
                    agg-count="{{countryCount}}"
                    order-by="{{countrySortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <aggregation-sort facets="[[countryFacets]]" order-by="{{countrySortOrder}}">
                  </aggregation-sort>
                </div>
              </div>

              <iron-collapse id="country-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[countryResult.aggregations.countryAgg.countryAgg.buckets]]"
                  facet-selection="{{facetSelection.country}}"
                  facets="{{countryFacets}}"
                  category="Country">
                </checkbox-list-display>
                <elastic-error error="[[countryError]]" message="{{countryErrorMessage}}"></elastic-error>
                <status-text
                  count="[[countryFacets.length]]"
                  error="[[countryErrorMessage]]"
                  loading="[[countryLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div id="city" class="facet-header">
                <span class="facet-toggle" title="Toggle City Facet List" on-tap="toggleList">City</span>
                <iron-icon id="city-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle City Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="city-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle City Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="cityAgg"
                field="mainEntity.availableAtOrFrom.address.key"
                count="{{cityCount}}"
                ejs-aggregation="{{cityAgg}}"
                type="terms"
                order="{{citySortOrder}}">
              </elastic-client-aggregation-builder>

              <json-transform
                data-in="{{cityResult}}"
                data-out="{{cityAndStateResult}}"
                transform-function="[[clientConfig.transforms.filterAggs.cityResults]]">
              </json-transform>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="City"
                    buckets="[[cityAndStateResult.aggregations.cityAgg.cityAgg.buckets]]"
                    loading="[[cityLoading]]"
                    error="[[cityError]]"
                    facet-selection="{{facetSelection.city}}"
                    agg-count="{{cityCount}}"
                    order-by="{{citySortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <aggregation-sort facets="[[cityFacets]]" order-by="{{citySortOrder}}">
                  </aggregation-sort>
                </div>
              </div>

              <iron-collapse id="city-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[cityAndStateResult.aggregations.cityAgg.cityAgg.buckets]]"
                  facet-selection="{{facetSelection.city}}"
                  facets="{{cityFacets}}"
                  category="City">
                </checkbox-list-display>
                <elastic-error error="[[cityError]]" message="{{cityErrorMessage}}"></elastic-error>
                <status-text
                  count="[[cityFacets.length]]"
                  error="[[cityErrorMessage]]"
                  loading="[[cityLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <!-- Phone and email use a transform on the same aggregation set -->
              <elastic-client-aggregation-builder
                name="phoneEmailAgg"
                field="mentions"
                ejs-aggregation="{{phoneEmailAgg}}"
                type="terms"
                count="0"
                order="{{phoneEmailSortOrder}}">
              </elastic-client-aggregation-builder>

              <div id="phone" class="facet-header">
                <span class="facet-toggle" title="Toggle Telephone Facet List" on-tap="toggleList">Telephone</span>
                <iron-icon id="phone-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Telephone Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="phone-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Telephone Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <facets-transform
                data-in="{{phoneEmailResult}}"
                data-out="{{phoneResult}}"
                limit="{{phoneCount}}"
                transform-function="[[clientConfig.transforms.filterAggs.mentionsPhoneResults]]">
              </facets-transform>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Telephone"
                    buckets="[[phoneResult.aggregations.phoneAgg.phoneAgg.buckets]]"
                    current-max-facets="[[phoneFacetMax]]"
                    loading="[[phoneEmailLoading]]"
                    error="[[phoneEmailError]]"
                    facet-selection="{{facetSelection.phone}}"
                    agg-count="{{phoneCount}}"
                    paging="true"
                    order-by="{{phoneEmailSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <aggregation-sort facets="[[phoneFacets]]" order-by="{{phoneEmailSortOrder}}">
                  </aggregation-sort>
                </div>
              </div>

              <iron-collapse id="phone-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[phoneResult.aggregations.phoneAgg.phoneAgg.buckets]]"
                  facet-selection="{{facetSelection.phone}}"
                  facets="{{phoneFacets}}"
                  show="{{phoneFacetMax}}"
                  category="Telephone">
                </checkbox-list-display>
                <elastic-error error="[[phoneEmailError]]" message="{{phoneEmailErrorMessage}}"></elastic-error>
                <status-text
                  count="[[phoneFacets.length]]"
                  error="[[phoneEmailErrorMessage]]"
                  loading="[[phoneEmailLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div id="email" class="facet-header">
                <span class="facet-toggle" title="Toggle Email Address Facet List" on-tap="toggleList">Email Address</span>
                <iron-icon id="email-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Email Address Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="email-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Email Address Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <facets-transform
                data-in="{{phoneEmailResult}}"
                data-out="{{emailResult}}"
                limit="{{emailCount}}"
                transform-function="[[clientConfig.transforms.filterAggs.mentionsEmailResults]]">
              </facets-transform>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Email Address"
                    buckets="[[emailResult.aggregations.emailAgg.emailAgg.buckets]]"
                    current-max-facets="[[emailFacetMax]]"
                    loading="[[phoneEmailLoading]]"
                    error="[[phoneEmailError]]"
                    facet-selection="{{facetSelection.email}}"
                    agg-count="{{emailCount}}"
                    paging="true"
                    order-by="{{phoneEmailSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <aggregation-sort facets="[[emailFacets]]" order-by="{{phoneEmailSortOrder}}">
                  </aggregation-sort>
                </div>
              </div>

              <iron-collapse id="email-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[emailResult.aggregations.emailAgg.emailAgg.buckets]]"
                  facet-selection="{{facetSelection.email}}"
                  facets="{{emailFacets}}"
                  show="{{emailFacetMax}}"
                  category="Email Address">
                </checkbox-list-display>
                <elastic-error error="[[phoneEmailError]]" message="{{phoneEmailErrorMessage}}"></elastic-error>
                <status-text
                  count="[[emailFacets.length]]"
                  error="[[phoneEmailErrorMessage]]"
                  loading="[[phoneEmailLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div id="website" class="facet-header">
                <span class="facet-toggle" title="Toggle Website Facet List" on-tap="toggleList">Website</span>
                <iron-icon id="website-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Website Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="website-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Website Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="publisherAgg"
                field="publisher.name.raw"
                count="{{publisherCount}}"
                ejs-aggregation="{{publisherAgg}}"
                type="terms"
                order="{{publisherSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Website"
                    buckets="[[publisherResult.aggregations.publisherAgg.publisherAgg.buckets]]"
                    loading="[[publisherLoading]]"
                    error="[[publisherError]]"
                    facet-selection="{{facetSelection.website}}"
                    agg-count="{{publisherCount}}"
                    order-by="{{publisherSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <aggregation-sort facets="[[publisherFacets]]" order-by="{{publisherSortOrder}}">
                  </aggregation-sort>
                </div>
              </div>

              <iron-collapse id="website-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[publisherResult.aggregations.publisherAgg.publisherAgg.buckets]]"
                  facet-selection="{{facetSelection.website}}"
                  facets="{{publisherFacets}}"
                  category="Website">
                </checkbox-list-display>
                <elastic-error error="[[publisherError]]" message="{{publisherErrorMessage}}"></elastic-error>
                <status-text
                  count="[[publisherFacets.length]]"
                  error="[[publisherErrorMessage]]"
                  loading="[[publisherLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div id="name" class="facet-header">
                <span class="facet-toggle" title="Toggle Name Facet List" on-tap="toggleList">Name</span>
                <iron-icon id="name-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Name Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="name-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Name Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="nameAgg"
                field="mainEntity.itemOffered.name.raw"
                count="{{nameCount}}"
                ejs-aggregation="{{nameAgg}}"
                type="terms"
                order="{{nameSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Name"
                    buckets="[[nameResult.aggregations.nameAgg.nameAgg.buckets]]"
                    loading="[[nameLoading]]"
                    error="[[nameError]]"
                    facet-selection="{{facetSelection.name}}"
                    agg-count="{{nameCount}}"
                    order-by="{{nameSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <aggregation-sort facets="[[nameFacets]]" order-by="{{nameSortOrder}}">
                  </aggregation-sort>
                </div>
              </div>

              <iron-collapse id="name-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[nameResult.aggregations.nameAgg.nameAgg.buckets]]"
                  facet-selection="{{facetSelection.name}}"
                  facets="{{nameFacets}}"
                  category="Name">
                </checkbox-list-display>
                <elastic-error error="[[nameError]]" message="{{nameErrorMessage}}"></elastic-error>
                <status-text
                  count="[[nameFacets.length]]"
                  error="[[nameErrorMessage]]"
                  loading="[[nameLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div id="age" class="facet-header">
                <span class="facet-toggle" title="Toggle Age Facet List" on-tap="toggleList">Age</span>
                <iron-icon id="age-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Age Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="age-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Age Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="ageAgg"
                field="mainEntity.itemOffered.age"
                count="{{ageCount}}"
                ejs-aggregation="{{ageAgg}}"
                type="terms"
                order="{{ageSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Age"
                    buckets="[[ageResult.aggregations.ageAgg.ageAgg.buckets]]"
                    loading="[[ageLoading]]"
                    error="[[ageError]]"
                    facet-selection="{{facetSelection.age}}"
                    agg-count="{{ageCount}}"
                    order-by="{{ageSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <aggregation-sort facets="[[ageFacets]]" order-by="{{ageSortOrder}}">
                  </aggregation-sort>
                </div>
              </div>

              <iron-collapse id="age-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[ageResult.aggregations.ageAgg.ageAgg.buckets]]"
                  facet-selection="{{facetSelection.age}}"
                  facets="{{ageFacets}}"
                  category="Age">
                </checkbox-list-display>
                <elastic-error error="[[ageError]]" message="{{ageErrorMessage}}"></elastic-error>
                <status-text
                  count="[[ageFacets.length]]"
                  error="[[ageErrorMessage]]"
                  loading="[[ageLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div id="ethnicity" class="facet-header">
                <span class="facet-toggle" title="Toggle Ethnicity Facet List" on-tap="toggleList">Ethnicity</span>
                <iron-icon id="ethnicity-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Ethnicity Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="ethnicity-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Ethnicity Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="ethnicityAgg"
                field="mainEntity.itemOffered.ethnicity"
                count="{{ethnicityCount}}"
                ejs-aggregation="{{ethnicityAgg}}"
                type="terms"
                order="{{ethnicitySortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Ethnicity"
                    buckets="[[ethnicityResult.aggregations.ethnicityAgg.ethnicityAgg.buckets]]"
                    loading="[[ethnicityLoading]]"
                    error="[[ethnicityError]]"
                    facet-selection="{{facetSelection.ethnicity}}"
                    agg-count="{{ethnicityCount}}"
                    order-by="{{ethnicitySortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <aggregation-sort facets="[[ethnicityFacets]]" order-by="{{ethnicitySortOrder}}">
                  </aggregation-sort>
                </div>
              </div>

              <iron-collapse id="ethnicity-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[ethnicityResult.aggregations.ethnicityAgg.ethnicityAgg.buckets]]"
                  facet-selection="{{facetSelection.ethnicity}}"
                  facets="{{ethnicityFacets}}"
                  category="Ethnicity">
                </checkbox-list-display>
                <elastic-error error="[[ethnicityError]]" message="{{ethnicityErrorMessage}}"></elastic-error>
                <status-text
                  count="[[ethnicityFacets.length]]"
                  error="[[ethnicityErrorMessage]]"
                  loading="[[ethnicityLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div id="height" class="facet-header">
                <span class="facet-toggle" title="Toggle Height Facet List" on-tap="toggleList">Height (cm)</span>
                <iron-icon id="height-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Height Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="height-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Height Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="heightAgg"
                field="mainEntity.itemOffered.height"
                count="{{heightCount}}"
                ejs-aggregation="{{heightAgg}}"
                type="terms"
                order="{{heightSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Height (cm)"
                    buckets="[[heightResult.aggregations.heightAgg.heightAgg.buckets]]"
                    loading="[[heightLoading]]"
                    error="[[heightError]]"
                    facet-selection="{{facetSelection.height}}"
                    agg-count="{{heightCount}}"
                    order-by="{{heightSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <aggregation-sort facets="[[heightFacets]]" order-by="{{heightSortOrder}}">
                  </aggregation-sort>
                </div>
              </div>

              <iron-collapse id="height-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[heightResult.aggregations.heightAgg.heightAgg.buckets]]"
                  facets="{{heightFacets}}"
                  facet-selection="{{facetSelection.height}}"
                  category="Height (cm)">
                </checkbox-list-display>
                <elastic-error error="[[heightError]]" message="{{heightErrorMessage}}"></elastic-error>
                <status-text
                  count="[[heightFacets.length]]"
                  error="[[heightErrorMessage]]"
                  loading="[[heightLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div id="weight" class="facet-header">
                <span class="facet-toggle" title="Toggle Weight Facet List" on-tap="toggleList">Weight (kg)</span>
                <iron-icon id="weight-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Weight Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="weight-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Weight Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="weightAgg"
                field="mainEntity.itemOffered.weight"
                count="{{weightCount}}"
                ejs-aggregation="{{weightAgg}}"
                type="terms"
                order="{{weightSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Weight (kg)"
                    buckets="[[weightResult.aggregations.weightAgg.weightAgg.buckets]]"
                    loading="[[weightLoading]]"
                    error="[[weightError]]"
                    facet-selection="{{facetSelection.weight}}"
                    agg-count="{{weightCount}}"
                    order-by="{{weightSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <aggregation-sort facets="[[weightFacets]]" order-by="{{weightSortOrder}}">
                  </aggregation-sort>
                </div>
              </div>

              <iron-collapse id="weight-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[weightResult.aggregations.weightAgg.weightAgg.buckets]]"
                  facets="{{weightFacets}}"
                  facet-selection="{{facetSelection.weight}}"
                  category="Weight (kg)">
                </checkbox-list-display>
                <elastic-error error="[[weightError]]" message="{{weightErrorMessage}}"></elastic-error>
                <status-text
                  count="[[weightFacets.length]]"
                  error="[[weightErrorMessage]]"
                  loading="[[weightLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div id="hair-color" class="facet-header">
                <span class="facet-toggle" title="Toggle Hair Color Facet List" on-tap="toggleList">Hair Color</span>
                <iron-icon id="hair-color-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Hair Color Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="hair-color-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Hair Color Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="hairColorAgg"
                field="mainEntity.itemOffered.hairColor"
                count="{{hairColorCount}}"
                ejs-aggregation="{{hairColorAgg}}"
                type="terms"
                order="{{hairColorSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Hair Color"
                    buckets="[[hairColorResult.aggregations.hairColorAgg.hairColorAgg.buckets]]"
                    loading="[[hairColorLoading]]"
                    error="[[hairColorError]]"
                    facet-selection="{{facetSelection.hairColor}}"
                    agg-count="{{hairColorCount}}"
                    order-by="{{hairColorSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <aggregation-sort facets="[[hairColorFacets]]" order-by="{{hairColorSortOrder}}">
                  </aggregation-sort>
                </div>
              </div>

              <iron-collapse id="hair-color-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[hairColorResult.aggregations.hairColorAgg.hairColorAgg.buckets]]"
                  facets="{{hairColorFacets}}"
                  facet-selection="{{hairColorFacetSelection}}"
                  category="Hair Color">
                </checkbox-list-display>
                <elastic-error error="[[hairColorError]]" message="{{hairColorErrorMessage}}"></elastic-error>
                <status-text
                  count="[[hairColorFacets.length]]"
                  error="[[hairColorErrorMessage]]"
                  loading="[[hairColorLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div id="eye-color" class="facet-header">
                <span class="facet-toggle" title="Toggle Eye Color Facet List" on-tap="toggleList">Eye Color</span>
                <iron-icon id="eye-color-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Eye Color Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="eye-color-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Eye Color Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="eyeColorAgg"
                field="mainEntity.itemOffered.eyeColor"
                count="{{eyeColorCount}}"
                ejs-aggregation="{{eyeColorAgg}}"
                type="terms"
                order="{{eyeColorSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Eye Color"
                    buckets="[[eyeColorResult.aggregations.eyeColorAgg.eyeColorAgg.buckets]]"
                    loading="[[eyeColorLoading]]"
                    error="[[eyeColorError]]"
                    facet-selection="{{facetSelection.eyeColor}}"
                    filter="{{eyeColorFilter}}"
                    agg-count="{{eyeColorCount}}"
                    order-by="{{eyeColorSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <aggregation-sort facets="[[eyeColorFacets]]" order-by="{{eyeColorSortOrder}}">
                  </aggregation-sort>
                </div>
              </div>

              <iron-collapse id="eye-color-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[eyeColorResult.aggregations.eyeColorAgg.eyeColorAgg.buckets]]"
                  facets="{{eyeColorFacets}}"
                  facet-selection="{{facetSelection.eyeColor}}"
                  category="Eye Color">
                </checkbox-list-display>
                <elastic-error error="[[eyeColorError]]" message="{{eyeColorErrorMessage}}"></elastic-error>
                <status-text
                  count="[[eyeColorFacets.length]]"
                  error="[[eyeColorErrorMessage]]"
                  loading="[[eyeColorLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>
            </section>

            <section data-type="phone">phone</section>
            <section data-type="email">email</section>
            <section data-type="adultservice">provider</section>
            <section data-type="seller">seller</section>
            <section data-type="webpage">webpage</section>
            <section data-type=''>ALL</section>
          </iron-pages>
        </paper-header-panel>

        <!-- Main content on right side -->
        <paper-header-panel main>
          <section>
            <div class="search-results-header">
              <template is="dom-if" if="[[!searchError]]">
                <div class="paper-font-title flex">[[recordsListTitle]]</div>
              </template>

              <template is="dom-if" if="[[searchError]]">
                <elastic-error error="[[searchError]]" message="{{searchErrorMessage}}"></elastic-error>
                <div class="paper-font-title flex">
                  [[searchErrorMessage]]
                </div>
              </template>

              <div class="flex-none">
                <!-- Place search controls or view options here -->
              </div>
            </div>
            <div class="h-divider"></div>
            <paper-material class="main-search-results-wrapper">
              <section class="main-search-results">
                <records-list
                  client="[[esclient]]"
                  annotation-index="[[config.annotationIndex]]"
                  annotation-type="[[config.annotationType]]"
                  annotation-relevant="[[config.annotationRelevant]]"
                  annotation-query-template="{{config.queryTemplates.annotationQuery}}"
                  new-tab="true"
                  query-results="{{records.data}}"
                  total-results="{{records.count}}"
                  page="{{pageNum}}"
                  loading="{{loading}}"
                  type="Result"
                  records-list-title="{{recordsListTitle}}"
                  current-user="[[config.username]]"
                  blur="[[blurImages]]">
                </records-list>
              </section>
            </paper-material>
          </section>
        </paper-header-panel>

      </paper-drawer-panel>

    </paper-header-panel>

  </template>

  <script src="behaviors/array-behavior.js"></script>

  <script>
    (function(document) {
      /* globals DigBehaviors */
      var app = document.querySelector('#app');

      app.facetSelection = {
        dateCreated: {},
        country: {},
        city: {},
        phone: {},
        email: {},
        website: {},
        name: {},
        age: {},
        ethnicity: {},
        height: {},
        weight: {},
        hairColor: {},
        eyeColor: {}
      };

      app.buildArray = DigBehaviors.ArrayBehavior.buildArray;

      app.getElasticTypes = function() {
        return ['webpage'];
      };

      app._showAll = function() {
        app.set('queryValue', null);
      };

      /**
       * Opens or closes the facet list corresponding to the ID of the element that triggered the event.
       */
      app.toggleList = function(event) {
        if(event.target.parentElement && event.target.parentElement.id) {
          var type = event.target.parentElement.id;
          if(this.$[type + '-list']) {
            this.$[type + '-list'].toggle();
            this.$[type + '-icon-closed'].style.display = (this.$[type + '-icon-closed'].style.display !== 'none' ? 'none' : '');
            this.$[type + '-icon-opened'].style.display = (this.$[type + '-icon-opened'].style.display !== 'none' ? 'none' : '');
          }
        }
      };

      app.enableSaveBtn = function(searchResults, searchError) {
        return searchResults !== null && searchError === null;
      };

    })(document);
  </script>
</body>

</html>
