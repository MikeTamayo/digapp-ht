<!--
Copyright 2017 Next Century Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!doctype html>

<html lang="">

<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="generator" content="Polymer Starter Kit" />
  <title>DIG</title>
  <!-- Place favicon.ico in the `app/` directory -->

  <!-- Chrome for Android theme color -->
  <meta name="theme-color" content="#2E3AA1">

  <!-- Web Application Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Tile color for Win8 -->
  <meta name="msapplication-TileColor" content="#3372DF">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="PSK">
  <link rel="icon" sizes="192x192" href="images/touch/chrome-touch-icon-192x192.png">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Polymer Starter Kit">
  <link rel="apple-touch-icon" href="images/touch/apple-touch-icon.png">

  <!-- Tile icon for Win8 (144x144) -->
  <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">

  <!-- build:css styles/main.css -->
  <!-- Must link leaflet css (https://github.com/leaflet-extras/leaflet-map/issues/46) -->
  <link rel="stylesheet" href="bower_components/leaflet/dist/leaflet.css">
  <link rel="stylesheet" href="styles/main.css">
  <!-- endbuild-->

  <!-- build:js bower_components/webcomponentsjs/webcomponents-lite.min.js -->
  <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <!-- endbuild -->

  <script src="scripts/google-analytics.js"></script>
  
  <!-- will be replaced with elements/elements.vulcanized.html -->
  <link rel="import" href="elements/elements.html">
  <!-- endreplace-->

  <link rel="import" href="styles/custom-icons.html">
  <link rel="import" href="styles/icon-styles.html">
  <style is="custom-style" include="icon-styles"></style>
</head>

<body unresolved class="fullbleed layout vertical">
  <span id="browser-sync-binding"></span>

  <template is="dom-bind" id="app">
    <!-- exposes clientConfig object which is a container for data
      transform functions -->
    <client-config config="{{clientConfig}}"></client-config>

    <!--get app configuration from server -->
    <iron-ajax
      auto
      url="/config"
      handle-as="json"
      last-response="{{config}}">
    </iron-ajax>

    <!--initialize new elastic client connection to server
      esclient can be used throughout the application lifecycle -->
    <elastic-client
      config="[[config.elasticConfig]]"
      client="{{esclient}}">
    </elastic-client>

    <!-- Main Search Query -->
    <elastic-client-highlight-builder
      fields='["*"]'
      pre-tags="<highlight>"
      post-tags="</highlight>"
      number-of-fragments="0"
      ejs-highlight="{{highlight}}">
    </elastic-client-highlight-builder>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      page="{{pageNum}}"
      page-size="{{pageSize}}"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{searchResults}}"
      last-error="{{searchError}}"
      result-count="{{resultCount}}"
      aggregations="[]"
      filters="[[filterArray]]"
      sort="{{sort}}"
      highlight="[[highlight]]"
      loading="{{loading}}"
      request-as-json="{{esRequest}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <json-transform
      data-in="{{searchResults}}"
      data-out="{{records}}"
      transform-function="[[clientConfig.transforms.webpage.webpages]]">
    </json-transform>

    <!-- Facets -->
    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{countryResult}}"
      last-error="{{countryError}}"
      aggregations="{{buildArray(countryAgg)}}"
      filters="[[filterArray]]"
      loading="{{countryLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{cityResult}}"
      last-error="{{cityError}}"
      aggregations="{{buildArray(cityAgg)}}"
      filters="[[filterArray]]"
      loading="{{cityLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{phoneResult}}"
      last-error="{{phoneError}}"
      aggregations="{{buildArray(phoneAgg)}}"
      filters="[[filterArray]]"
      loading="{{phoneLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{emailResult}}"
      last-error="{{emailError}}"
      aggregations="{{buildArray(emailAgg)}}"
      filters="[[filterArray]]"
      loading="{{emailLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{publisherResult}}"
      last-error="{{publisherError}}"
      aggregations="{{buildArray(publisherAgg)}}"
      filters="[[filterArray]]"
      loading="{{publisherLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{nameResult}}"
      last-error="{{nameError}}"
      aggregations="{{buildArray(nameAgg)}}"
      filters="[[filterArray]]"
      loading="{{nameLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{ageResult}}"
      last-error="{{ageError}}"
      aggregations="{{buildArray(ageAgg)}}"
      filters="[[filterArray]]"
      loading="{{ageLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{ethnicityResult}}"
      last-error="{{ethnicityError}}"
      aggregations="{{buildArray(ethnicityAgg)}}"
      filters="[[filterArray]]"
      loading="{{ethnicityLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{heightResult}}"
      last-error="{{heightError}}"
      aggregations="{{buildArray(heightAgg)}}"
      filters="[[filterArray]]"
      loading="{{heightLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{weightResult}}"
      last-error="{{weightError}}"
      aggregations="{{buildArray(weightAgg)}}"
      filters="[[filterArray]]"
      loading="{{weightLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{hairColorResult}}"
      last-error="{{hairColorError}}"
      aggregations="{{buildArray(hairColorAgg)}}"
      filters="[[filterArray]]"
      loading="{{hairColorLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{eyeColorResult}}"
      last-error="{{eyeColorError}}"
      aggregations="{{buildArray(eyeColorAgg)}}"
      filters="[[filterArray]]"
      loading="{{eyeColorLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{imageResult}}"
      last-error="{{imageError}}"
      aggregations="{{buildArray(imageAgg)}}"
      filters="[[filterArray]]"
      loading="{{imageLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>
    <!-- End Facets -->

    <dig-logger
      es-client="[[esclient]]"
      es-index="[[config.logIndex]]"
      es-type="[[config.logType]]"
      supertype="Search"
      subtype="SubmitQuery"
      value="[[logMessage]]"
      username="[[config.username]]">
    </dig-logger>

    <search-log-message-assembler
      query-value="[[searchParameters.text]]"
      age-facet-selection="[[searchParameters.age]]"
      city-facet-selection="[[searchParameters.city]]"
      country-facet-selection="[[searchParameters.country]]"
      date-facet-selection="[[searchParameters.dateCreated]]"
      email-facet-selection="[[searchParameters.email]]"
      ethnicity-facet-selection="[[searchParameters.ethnicity]]"
      eye-facet-selection="[[searchParameters.eyeColor]]"
      hair-facet-selection="[[searchParameters.hairColor]]"
      height-facet-selection="[[searchParameters.height]]"
      name-facet-selection="[[searchParameters.name]]"
      phone-facet-selection="[[searchParameters.phone]]"
      publisher-facet-selection="[[searchParameters.website]]"
      weight-facet-selection="[[searchParameters.weight]]"
      has-image-facet-selection="[[searchParameters.hasImage]]"
      image-facet-selection="[[searchParameters.image]]"
      annotations-filter-option-selection="[[searchParameters.annotationsFilter]]"
      log-message="{{logMessage}}">
    </search-log-message-assembler>

    <annotation-manager
      client="[[esclient]]"
      annotation-index="[[config.annotationIndex]]"
      annotation-type="[[config.annotationType]]"
      relevant="[[config.annotationRelevant]]"
      username="[[config.username]]"
      annotations="{{annotations}}"
      annotation-manager="{{annotationManager}}">
    </annotation-manager>

    <paper-header-panel class="flex" mode="waterfall">

      <!-- Search toolbar -->
      <paper-toolbar id="navbar">
        <img class="bottom" src="images/dig-logo-original.png" alt="">
        <div class="bottom drawer-spacer"></div>

        <!-- Hide until we can support multiple search types.
        <div class="bottom v-divider"></div>
        <elastic-type-selector class="bottom white-input-container"
          available-types="{{config.elasticTypes}}"
          elastic-types="{{esTypes}}">
        </elastic-type-selector>
        -->

        <!-- Icon for search dropdown panel -->
        <modal-icon class="bottom" id="moreSearchOptionsBtn" openable ripple on-tap="toggleSearchDropdownPanel">
        </modal-icon>

        <div class="bottom v-divider"></div>
        <div class="bottom flex">
          <elastic-client-input class="white-input-container"
            field="_all"
            value="{{searchParameters.text}}"
            query="{{ejsQuery}}"
            label="[[createSearchInputLabel(advancedSearch)]]"
            advanced="[[advancedSearch]]">
          </elastic-client-input>
        </div>

        <a class="bottom" href="." style="color: #ffffff;">
          <paper-icon-button icon="clear" title="Reset Page"></paper-icon-button>
        </a>

        <load-user-info class="bottom"
          show-search
          client="[[esclient]]"
          loading="[[loading]]"
          username="[[config.username]]"
          user-id="{{userId}}"
          user-record-exists="{{userRecordExists}}"
          advanced-search="{{advancedSearch}}"
          blur-images="{{blurImages}}"
          searches="{{userSearches}}"
          search-parameters="{{searchParameters}}"
          es-request="{{esRequest}}"
          user-index="[[config.userIndex]]"
          user-type="[[config.userType]]"
          notification-query-date="{{notificationDate}}"
          sort-newest='Sort("dateCreated").order("desc")'
          current-sort="[[selectedSort]]"
          process-request="{{processRequest}}">
        </load-user-info>

        <save-search id="saveSearchDialog"
          client="[[esclient]]"
          username="[[config.username]]"
          user-id="[[userId]]"
          existing-searches="{{userSearches}}"
          search-parameters="[[searchParameters]]"
          es-request="[[esRequest]]"
          user-index="[[config.userIndex]]"
          user-type="[[config.userType]]"
          user-record-exists="[[userRecordExists]]">
        </save-search>

        <bulk-search id="bulkSearchDialog" search-parameters="{{searchParameters}}" process-request="{{processRequest}}"></bulk-search>

        <similar-image-search id="similarImageSearchDialog"
          blur="[[blurImages]]"
          query-value="[[searchParameters.text]]"
          image-service-auth="[[config.imageServiceAuth]]"
          image-service-host="[[config.imageServiceHost]]"
          link-function="[[clientConfig.transforms.image.externalImageLink]]">
        </similar-image-search>

        <search-help id="searchHelpDialog"></search-help>

        <search-filter-builder
          annotations="[[annotations]]"
          search-parameters="{{searchParameters}}"
          filter-list="{{filterArray}}">
        </search-filter-builder>

        <state-manager id="stateManager"
          page-type="search"
          client="[[esclient]]"
          state-index="[[config.filterStatesIndex]]"
          state-type="[[config.filterStatesType]]"
          state-id="[[params.state]]"
          filter-collection="{{searchParameters}}"
          process-request="{{processRequest}}">
        </state-manager>

        <paper-icon-button icon="menu" class="bottom dropdown-trigger" title="More Options" on-tap="toggleMenu"></paper-icon-button>

        <iron-dropdown id="menuDropdown" class="bottom" horizontal-align="right" vertical-align="top" vertical-offset="80">
          <div class="dropdown-content">
            <paper-icon-item title="Show All Results for the Selected Facets" on-tap="showAll">
              <iron-icon icon="custom-icons:show-all" item-icon></iron-icon>
              Show All Results
            </paper-icon-item>

            <paper-icon-item disabled="[[isSaveButtonDisabled(searchResults, searchError)]]" title="Save the Search Keywords and Selected Facets" on-tap="openSaveSearchDialog">
              <iron-icon icon="save" item-icon></iron-icon>
              Save Search
            </paper-icon-item>

            <paper-icon-item disabled="[[noSearchParameters(searchParameters.*)]]" title="Generate a Link for this Page with the Search Keywords and Selected Facets" on-tap="generateLink">
              <iron-icon icon="link" item-icon></iron-icon>
              Generate Link
            </paper-icon-item>

            <paper-icon-item title="Upload or Enter Multiple Telephone Numbers" on-tap="openBatchPhoneSearchDialog">
              <iron-icon icon="file-upload" item-icon></iron-icon>
              Bulk Telephone Search
            </paper-icon-item>

            <paper-icon-item title="Search on an Image URL or Uploaded Image" on-tap="openSimilarImageSearchDialog">
              <iron-icon icon="image:compare" item-icon></iron-icon>
              Similar Image Search
            </paper-icon-item>

            <paper-icon-item active="[[advancedSearch]]" class="toggle" title="[[getAdvancedSearchTitle(advancedSearch)]]" on-tap="toggleAdvancedSearch">
              <iron-icon icon="custom-icons:advanced-search" item-icon></iron-icon>
              Toggle Advanced Search Mode
            </paper-icon-item>

            <paper-icon-item title="Search Help" on-tap="openSearchHelpDialog">
              <iron-icon icon="help" item-icon></iron-icon>
              Search Help
            </paper-icon-item>

            <paper-icon-item title="Contact DIG Support" on-tap="emailSupport">
              <iron-icon icon="communication:contact-mail" item-icon></iron-icon>
              Contact DIG Support
            </paper-icon-item>
          </div>
        </iron-dropdown>
      </paper-toolbar>

      <!-- search dropdown panel -->
      <iron-collapse id="moreSearchOptions" class="horizontal layout paper-header">
        <div class="search-options">
          <span>Enter text for the fields you would like to search on. For reporting purposes, check each field that you would like included in your reports.</span>
          <div class="horizontal layout">
            <template is="dom-repeat" items="[[getSearchFieldColumns()]]" as="key">
              <div class="vertical layout">
                <template is="dom-repeat" items="[[getSearchFieldColumn(key)]]">
                  <div class="horizontal layout end white-input-container">
                    <paper-input class="white-input-container"
                      label="{{item.title}}"
                      value="{{item.value}}">
                    </paper-input>
                    <paper-checkbox noink></paper-checkbox>
                  </div>
                </template>
              </div>
              <div class="v-divider"></div>
            </template>
          </div>
        </div>
      </iron-collapse>

      <paper-drawer-panel drawer-width="320px">

        <!-- Sidebar on left side -->
        <paper-header-panel drawer>
          <paper-toolbar class="drawer-header">
            <div class="layout vertical">
              <!--TODO: create different sort for all types + different elastic-client-searches for all types -->
              <elastic-sort-input class="layout horizontal" field="dateCreated" selected="{{searchParameters.sort}}">
              </elastic-sort-input>
              <elastic-sort input-string="[[searchParameters.sort]]" sort="{{sort}}"></elastic-sort>

              <div class="h-divider"></div>

              <template is="dom-if" if="[[noFacets(searchParameters.*)]]">
                <div class="no-selected-facets">No Selected Facets</div>
              </template>

              <div class="layout horizontal wrap">
                <selected-facets-display facet-selection="{{searchParameters.dateCreated}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.country}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.city}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.phone}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.email}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.website}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.name}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.age}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.ethnicity}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.height}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.weight}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.hairColor}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.eyeColor}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.hasImage}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.image}}"></selected-facets-display>
              </div>

              <div class="h-divider"></div>

              <div id="annotation-options" class="filter-header">
                <span class="filter-toggle" title="Toggle Annotation Options" on-tap="toggleList">Annotation Options</span>
                <iron-icon id="annotation-options-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Annotation Options" on-tap="toggleList"></iron-icon>
                <iron-icon id="annotation-options-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Annotation Options" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <iron-collapse id="annotation-options-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[createAnnotationOptionsBuckets()]]"
                  facet-selection="{{searchParameters.annotationsFilter}}"
                  category="Annotations">
                </checkbox-list-display>
              </iron-collapse>

              <div class="h-divider"></div>
            </div>
          </paper-toolbar>

          <iron-pages attr-for-selected="data-type" selected="webpage">
            <section data-type="webpage">
              <div class="facet filter-header layout horizontal">
                <span class="flex">Facets</span>
                <span class="filter-toggle" on-tap="toggleAllFacetLists">
                  {{getToggleAllFacetsText(facetListsExpanded)}}
                </span>
                <iron-icon class="filter-toggle" icon="{{getToggleAllFacetsIcon(facetListsExpanded)}}"
                  title="Toggle All Facets" on-tap="toggleAllFacetLists">
                </iron-icon>
              </div>

              <div class="h-divider"></div>

              <div id="date" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Date Facet List" on-tap="toggleList">Date</span>
                <iron-icon id="date-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Date Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="date-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Date Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <iron-collapse id="date-list" class="filter-list" opened>
                <date-range-display
                  facet-selection="{{searchParameters.dateCreated}}">
                </date-range-display>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="country" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Country Facet List" on-tap="toggleList">Country</span>
                <iron-icon id="country-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Country Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="country-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Country Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="countryAgg"
                field="mainEntity.availableAtOrFrom.address.addressCountry"
                count="{{countryCount}}"
                ejs-aggregation="{{countryAgg}}"
                type="terms"
                order="{{countrySortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Country"
                    buckets="[[countryResult.aggregations.countryAgg.countryAgg.buckets]]"
                    loading="[[countryLoading]]"
                    error="[[countryError]]"
                    facet-selection="{{searchParameters.country}}"
                    agg-count="{{countryCount}}"
                    order-by="{{countrySortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[countryFacets.length]]">
                    <aggregation-sort facets="[[countryFacets]]" order-by="{{countrySortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="country-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[countryResult.aggregations.countryAgg.countryAgg.buckets]]"
                  facet-selection="{{searchParameters.country}}"
                  facets="{{countryFacets}}"
                  category="Country">
                </checkbox-list-display>
                <elastic-error error="[[countryError]]" message="{{countryErrorMessage}}"></elastic-error>
                <status-text
                  count="[[countryFacets.length]]"
                  error="[[countryErrorMessage]]"
                  loading="[[countryLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="city" class="facet filter-header">
                <span class="filter-toggle" title="Toggle City Facet List" on-tap="toggleList">City</span>
                <iron-icon id="city-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle City Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="city-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle City Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="cityAgg"
                field="mainEntity.availableAtOrFrom.address.key"
                count="{{cityCount}}"
                ejs-aggregation="{{cityAgg}}"
                type="terms"
                order="{{citySortOrder}}">
              </elastic-client-aggregation-builder>

              <json-transform
                data-in="{{cityResult}}"
                data-out="{{cityAndStateResult}}"
                transform-function="[[clientConfig.transforms.filterAggs.cityResults]]">
              </json-transform>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="City"
                    buckets="[[cityAndStateResult.aggregations.cityAgg.cityAgg.buckets]]"
                    loading="[[cityLoading]]"
                    error="[[cityError]]"
                    facet-selection="{{searchParameters.city}}"
                    agg-count="{{cityCount}}"
                    order-by="{{citySortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[cityFacets.length]]">
                    <aggregation-sort facets="[[cityFacets]]" order-by="{{citySortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="city-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[cityAndStateResult.aggregations.cityAgg.cityAgg.buckets]]"
                  facet-selection="{{searchParameters.city}}"
                  facets="{{cityFacets}}"
                  category="City">
                </checkbox-list-display>
                <elastic-error error="[[cityError]]" message="{{cityErrorMessage}}"></elastic-error>
                <status-text
                  count="[[cityFacets.length]]"
                  error="[[cityErrorMessage]]"
                  loading="[[cityLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="phone" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Telephone Facet List" on-tap="toggleList">Telephone</span>
                <iron-icon id="phone-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Telephone Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="phone-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Telephone Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="phoneAgg"
                field="mentionsPhone"
                count="{{phoneCount}}"
                ejs-aggregation="{{phoneAgg}}"
                type="terms"
                order="{{phoneSortOrder}}">
              </elastic-client-aggregation-builder>

              <json-transform
                data-in="{{phoneResult.aggregations.phoneAgg.phoneAgg.buckets}}"
                data-out="{{phoneResultBuckets}}"
                transform-function="[[clientConfig.transforms.phone.cleanPhoneBuckets]]">
              </json-transform>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Telephone"
                    buckets="[[phoneResultBuckets]]"
                    loading="[[phoneLoading]]"
                    error="[[phoneError]]"
                    facet-selection="{{searchParameters.phone}}"
                    agg-count="{{phoneCount}}"
                    order-by="{{phoneSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[phoneFacets.length]]">
                    <aggregation-sort facets="[[phoneFacets]]" order-by="{{phoneSortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="phone-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[phoneResultBuckets]]"
                  facet-selection="{{searchParameters.phone}}"
                  facets="{{phoneFacets}}"
                  category="Telephone">
                </checkbox-list-display>
                <elastic-error error="[[phoneError]]" message="{{phoneErrorMessage}}"></elastic-error>
                <status-text
                  count="[[phoneFacets.length]]"
                  error="[[phoneErrorMessage]]"
                  loading="[[phoneLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="email" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Email Address Facet List" on-tap="toggleList">Email Address</span>
                <iron-icon id="email-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Email Address Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="email-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Email Address Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="emailAgg"
                field="mentionsEmail"
                count="{{emailCount}}"
                ejs-aggregation="{{emailAgg}}"
                type="terms"
                order="{{emailSortOrder}}">
              </elastic-client-aggregation-builder>

              <json-transform
                data-in="{{emailResult.aggregations.emailAgg.emailAgg.buckets}}"
                data-out="{{emailResultBuckets}}"
                transform-function="[[clientConfig.transforms.email.cleanEmailBuckets]]">
              </json-transform>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Email Address"
                    buckets="[[emailResultBuckets]]"
                    loading="[[emailLoading]]"
                    error="[[emailError]]"
                    facet-selection="{{searchParameters.email}}"
                    agg-count="{{emailCount}}"
                    order-by="{{emailSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[emailFacets.length]]">
                    <aggregation-sort facets="[[emailFacets]]" order-by="{{emailSortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="email-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[emailResultBuckets]]"
                  facet-selection="{{searchParameters.email}}"
                  facets="{{emailFacets}}"
                  category="Email Address">
                </checkbox-list-display>
                <elastic-error error="[[emailError]]" message="{{emailErrorMessage}}"></elastic-error>
                <status-text
                  count="[[emailFacets.length]]"
                  error="[[emailErrorMessage]]"
                  loading="[[emailLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="website" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Website Facet List" on-tap="toggleList">Website</span>
                <iron-icon id="website-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Website Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="website-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Website Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="publisherAgg"
                field="publisher.name.raw"
                count="{{publisherCount}}"
                ejs-aggregation="{{publisherAgg}}"
                type="terms"
                order="{{publisherSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Website"
                    buckets="[[publisherResult.aggregations.publisherAgg.publisherAgg.buckets]]"
                    loading="[[publisherLoading]]"
                    error="[[publisherError]]"
                    facet-selection="{{searchParameters.website}}"
                    agg-count="{{publisherCount}}"
                    order-by="{{publisherSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[publisherFacets.length]]">
                    <aggregation-sort facets="[[publisherFacets]]" order-by="{{publisherSortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="website-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[publisherResult.aggregations.publisherAgg.publisherAgg.buckets]]"
                  facet-selection="{{searchParameters.website}}"
                  facets="{{publisherFacets}}"
                  category="Website">
                </checkbox-list-display>
                <elastic-error error="[[publisherError]]" message="{{publisherErrorMessage}}"></elastic-error>
                <status-text
                  count="[[publisherFacets.length]]"
                  error="[[publisherErrorMessage]]"
                  loading="[[publisherLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="name" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Name Facet List" on-tap="toggleList">Name</span>
                <iron-icon id="name-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Name Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="name-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Name Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="nameAgg"
                field="mainEntity.itemOffered.name.raw"
                count="{{nameCount}}"
                ejs-aggregation="{{nameAgg}}"
                type="terms"
                order="{{nameSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Name"
                    buckets="[[nameResult.aggregations.nameAgg.nameAgg.buckets]]"
                    loading="[[nameLoading]]"
                    error="[[nameError]]"
                    facet-selection="{{searchParameters.name}}"
                    agg-count="{{nameCount}}"
                    order-by="{{nameSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[nameFacets.length]]">
                    <aggregation-sort facets="[[nameFacets]]" order-by="{{nameSortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="name-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[nameResult.aggregations.nameAgg.nameAgg.buckets]]"
                  facet-selection="{{searchParameters.name}}"
                  facets="{{nameFacets}}"
                  category="Name">
                </checkbox-list-display>
                <elastic-error error="[[nameError]]" message="{{nameErrorMessage}}"></elastic-error>
                <status-text
                  count="[[nameFacets.length]]"
                  error="[[nameErrorMessage]]"
                  loading="[[nameLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="age" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Age Facet List" on-tap="toggleList">Age</span>
                <iron-icon id="age-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Age Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="age-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Age Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="ageAgg"
                field="mainEntity.itemOffered.age"
                count="{{ageCount}}"
                ejs-aggregation="{{ageAgg}}"
                type="terms"
                order="{{ageSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Age"
                    buckets="[[ageResult.aggregations.ageAgg.ageAgg.buckets]]"
                    loading="[[ageLoading]]"
                    error="[[ageError]]"
                    facet-selection="{{searchParameters.age}}"
                    agg-count="{{ageCount}}"
                    order-by="{{ageSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[ageFacets.length]]">
                    <aggregation-sort facets="[[ageFacets]]" order-by="{{ageSortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="age-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[ageResult.aggregations.ageAgg.ageAgg.buckets]]"
                  facet-selection="{{searchParameters.age}}"
                  facets="{{ageFacets}}"
                  category="Age">
                </checkbox-list-display>
                <elastic-error error="[[ageError]]" message="{{ageErrorMessage}}"></elastic-error>
                <status-text
                  count="[[ageFacets.length]]"
                  error="[[ageErrorMessage]]"
                  loading="[[ageLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="ethnicity" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Ethnicity Facet List" on-tap="toggleList">Ethnicity</span>
                <iron-icon id="ethnicity-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Ethnicity Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="ethnicity-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Ethnicity Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="ethnicityAgg"
                field="mainEntity.itemOffered.ethnicity"
                count="{{ethnicityCount}}"
                ejs-aggregation="{{ethnicityAgg}}"
                type="terms"
                order="{{ethnicitySortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Ethnicity"
                    buckets="[[ethnicityResult.aggregations.ethnicityAgg.ethnicityAgg.buckets]]"
                    loading="[[ethnicityLoading]]"
                    error="[[ethnicityError]]"
                    facet-selection="{{searchParameters.ethnicity}}"
                    agg-count="{{ethnicityCount}}"
                    order-by="{{ethnicitySortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[ethnicityFacets.length]]">
                    <aggregation-sort facets="[[ethnicityFacets]]" order-by="{{ethnicitySortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="ethnicity-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[ethnicityResult.aggregations.ethnicityAgg.ethnicityAgg.buckets]]"
                  facet-selection="{{searchParameters.ethnicity}}"
                  facets="{{ethnicityFacets}}"
                  category="Ethnicity">
                </checkbox-list-display>
                <elastic-error error="[[ethnicityError]]" message="{{ethnicityErrorMessage}}"></elastic-error>
                <status-text
                  count="[[ethnicityFacets.length]]"
                  error="[[ethnicityErrorMessage]]"
                  loading="[[ethnicityLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="height" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Height Facet List" on-tap="toggleList">Height (cm)</span>
                <iron-icon id="height-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Height Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="height-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Height Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="heightAgg"
                field="mainEntity.itemOffered.height"
                count="{{heightCount}}"
                ejs-aggregation="{{heightAgg}}"
                type="terms"
                order="{{heightSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Height (cm)"
                    buckets="[[heightResult.aggregations.heightAgg.heightAgg.buckets]]"
                    loading="[[heightLoading]]"
                    error="[[heightError]]"
                    facet-selection="{{searchParameters.height}}"
                    agg-count="{{heightCount}}"
                    order-by="{{heightSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[heightFacets.length]]">
                    <aggregation-sort facets="[[heightFacets]]" order-by="{{heightSortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="height-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[heightResult.aggregations.heightAgg.heightAgg.buckets]]"
                  facets="{{heightFacets}}"
                  facet-selection="{{searchParameters.height}}"
                  category="Height (cm)">
                </checkbox-list-display>
                <elastic-error error="[[heightError]]" message="{{heightErrorMessage}}"></elastic-error>
                <status-text
                  count="[[heightFacets.length]]"
                  error="[[heightErrorMessage]]"
                  loading="[[heightLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="weight" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Weight Facet List" on-tap="toggleList">Weight (kg)</span>
                <iron-icon id="weight-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Weight Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="weight-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Weight Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="weightAgg"
                field="mainEntity.itemOffered.weight"
                count="{{weightCount}}"
                ejs-aggregation="{{weightAgg}}"
                type="terms"
                order="{{weightSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Weight (kg)"
                    buckets="[[weightResult.aggregations.weightAgg.weightAgg.buckets]]"
                    loading="[[weightLoading]]"
                    error="[[weightError]]"
                    facet-selection="{{searchParameters.weight}}"
                    agg-count="{{weightCount}}"
                    order-by="{{weightSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[weightFacets.length]]">
                    <aggregation-sort facets="[[weightFacets]]" order-by="{{weightSortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="weight-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[weightResult.aggregations.weightAgg.weightAgg.buckets]]"
                  facets="{{weightFacets}}"
                  facet-selection="{{searchParameters.weight}}"
                  category="Weight (kg)">
                </checkbox-list-display>
                <elastic-error error="[[weightError]]" message="{{weightErrorMessage}}"></elastic-error>
                <status-text
                  count="[[weightFacets.length]]"
                  error="[[weightErrorMessage]]"
                  loading="[[weightLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="hair-color" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Hair Color Facet List" on-tap="toggleList">Hair Color</span>
                <iron-icon id="hair-color-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Hair Color Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="hair-color-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Hair Color Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="hairColorAgg"
                field="mainEntity.itemOffered.hairColor"
                count="{{hairColorCount}}"
                ejs-aggregation="{{hairColorAgg}}"
                type="terms"
                order="{{hairColorSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Hair Color"
                    buckets="[[hairColorResult.aggregations.hairColorAgg.hairColorAgg.buckets]]"
                    loading="[[hairColorLoading]]"
                    error="[[hairColorError]]"
                    facet-selection="{{searchParameters.hairColor}}"
                    agg-count="{{hairColorCount}}"
                    order-by="{{hairColorSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[hairColorFacets.length]]">
                    <aggregation-sort facets="[[hairColorFacets]]" order-by="{{hairColorSortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="hair-color-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[hairColorResult.aggregations.hairColorAgg.hairColorAgg.buckets]]"
                  facets="{{hairColorFacets}}"
                  facet-selection="{{searchParameters.hairColor}}"
                  category="Hair Color">
                </checkbox-list-display>
                <elastic-error error="[[hairColorError]]" message="{{hairColorErrorMessage}}"></elastic-error>
                <status-text
                  count="[[hairColorFacets.length]]"
                  error="[[hairColorErrorMessage]]"
                  loading="[[hairColorLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="eye-color" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Eye Color Facet List" on-tap="toggleList">Eye Color</span>
                <iron-icon id="eye-color-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Eye Color Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="eye-color-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Eye Color Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="eyeColorAgg"
                field="mainEntity.itemOffered.eyeColor"
                count="{{eyeColorCount}}"
                ejs-aggregation="{{eyeColorAgg}}"
                type="terms"
                order="{{eyeColorSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    title="Eye Color"
                    buckets="[[eyeColorResult.aggregations.eyeColorAgg.eyeColorAgg.buckets]]"
                    loading="[[eyeColorLoading]]"
                    error="[[eyeColorError]]"
                    facet-selection="{{searchParameters.eyeColor}}"
                    filter="{{eyeColorFilter}}"
                    agg-count="{{eyeColorCount}}"
                    order-by="{{eyeColorSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[eyeColorFacets.length]]">
                    <aggregation-sort facets="[[eyeColorFacets]]" order-by="{{eyeColorSortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="eye-color-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[eyeColorResult.aggregations.eyeColorAgg.eyeColorAgg.buckets]]"
                  facets="{{eyeColorFacets}}"
                  facet-selection="{{searchParameters.eyeColor}}"
                  category="Eye Color">
                </checkbox-list-display>
                <elastic-error error="[[eyeColorError]]" message="{{eyeColorErrorMessage}}"></elastic-error>
                <status-text
                  count="[[eyeColorFacets.length]]"
                  error="[[eyeColorErrorMessage]]"
                  loading="[[eyeColorLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="has-image" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Has Image Facet List" on-tap="toggleList">Has Image</span>
                <iron-icon id="has-image-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Has Image Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="has-image-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Has Image Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <iron-collapse id="has-image-list" class="filter-list" opened>
                <checkbox-list-display
                  buckets="[[createHasImageFacetBuckets()]]"
                  facet-selection="{{searchParameters.hasImage}}"
                  category="Has Image">
                </checkbox-list-display>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="image" class="facet filter-header">
                <span class="filter-toggle" title="Toggle Image Facet List" on-tap="toggleList">Image</span>
                <iron-icon id="image-icon-opened" class="filter-toggle" icon="icons:expand-less" title="Toggle Image Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="image-icon-closed" class="filter-toggle" icon="icons:expand-more" title="Toggle Image Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="imageAgg"
                field="hasImagePart.url.raw"
                count="{{imageCount}}"
                ejs-aggregation="{{imageAgg}}"
                type="terms"
                order="{{imageSortOrder}}">
              </elastic-client-aggregation-builder>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <view-all-facets
                    images
                    image-style-class="[[getBlurStyleClass(blurImages)]]"
                    title="Image"
                    buckets="[[imageResult.aggregations.imageAgg.imageAgg.buckets]]"
                    loading="[[imageLoading]]"
                    error="[[imageError]]"
                    facet-selection="{{searchParameters.image}}"
                    filter="{{imageFilter}}"
                    agg-count="{{imageCount}}"
                    order-by="{{imageSortOrder}}">
                  </view-all-facets>
                </div>
                <div class="flex self-end">
                  <template is="dom-if" if="[[imageFacets.length]]">
                    <aggregation-sort facets="[[imageFacets]]" order-by="{{imageSortOrder}}">
                    </aggregation-sort>
                  </template>
                </div>
              </div>

              <iron-collapse id="image-list" class="filter-list" opened>
                <checkbox-list-display
                  images
                  image-style-class="[[getBlurStyleClass(blurImages)]]"
                  buckets="[[imageResult.aggregations.imageAgg.imageAgg.buckets]]"
                  facets="{{imageFacets}}"
                  facet-selection="{{searchParameters.image}}"
                  category="Image">
                </checkbox-list-display>
                <elastic-error error="[[imageError]]" message="{{imageErrorMessage}}"></elastic-error>
                <status-text
                  count="[[imageFacets.length]]"
                  error="[[imageErrorMessage]]"
                  loading="[[imageLoading]]"
                  empty="No Facets">
                </status-text>
              </iron-collapse>
            </section>

            <section data-type="phone">phone</section>
            <section data-type="email">email</section>
            <section data-type="adultservice">provider</section>
            <section data-type="seller">seller</section>
            <section data-type="webpage">webpage</section>
            <section data-type=''>ALL</section>
          </iron-pages>
        </paper-header-panel>

        <!-- Main content on right side -->
        <paper-header-panel main id="searchPanel">
          <div id="searchTitle" class="layout horizontal">
            <template is="dom-if" if="[[!searchError]]">
              <div class="paper-font-title flex">[[recordsListTitle]]</div>
            </template>

            <template is="dom-if" if="[[searchError]]">
              <elastic-error error="[[searchError]]" message="{{searchErrorMessage}}"></elastic-error>
              <div class="paper-font-title flex">
                [[searchErrorMessage]]
              </div>
            </template>

            <export-button
              data="[[shownRecords]]"
              transform-function="[[clientConfig.transforms.offer.createExportData]]">
            </export-button>
          </div>

          <records-list id="searchResults"
            client="[[esclient]]"
            annotation-manager="[[annotationManager]]"
            new-tab="true"
            query-results="{{records.data}}"
            total-results="{{records.count}}"
            shown-results="{{shownRecords}}"
            page="{{pageNum}}"
            page-size="[[pageSize]]"
            loading="{{loading}}"
            type="Result"
            records-list-title="{{recordsListTitle}}"
            current-user="[[config.username]]"
            blur="[[blurImages]]"
            notification-query-date="{{notificationDate}}">
          </records-list>
        </paper-header-panel>

      </paper-drawer-panel>

    </paper-header-panel>

  </template>

  <!-- Need to include dependencies here for IE -->
  <script src="bower_components/lodash/dist/lodash.js"></script>
  <script src="behaviors/array-behavior.js"></script>
  <script src="behaviors/browser-behavior.js"></script>
  <script src="behaviors/state-behavior.js"></script>

  <script>
    (function(document) {
      /* globals _, DigBehaviors */
      var app = document.querySelector('#app');

      app.facetListsExpanded = true;

      app.searchParameters = DigBehaviors.StateBehavior.buildSearchStateForUI({});

      app.params = DigBehaviors.BrowserBehavior.getUrlParameters(window.location.search);

      DigBehaviors.BrowserBehavior.removeStateParameter(window.history, window.location);

      app.buildArray = DigBehaviors.ArrayBehavior.buildArray;

      /* search dropdown panel code */
      app.showMoreSearchOptions = false;

      // might be too complex
      app.searchFields = {
        col1: [
          {title: 'Phone Number', value: ''},
          {title: 'Email', value: ''},
          {title: 'Street Address', value: ''},
          {title: 'Social Media ID', value: ''}
        ],
        col2: [
          {title: 'Review Site ID', value: ''},
          {title: 'Name', value: ''},
          {title: 'Location', value: ''},
          {title: 'Age', value: ''}
        ],
        col3: [
          {title: 'Ethnicity', value: ''},
          {title: 'Price', value: ''},
          //{title: 'Tattoos', value: ''},
          //{title: 'Multiple Providers', value: ''},
          {title: 'Hair Color', value: ''},
          {title: 'Services', value: ''}
        ],
        col4: [
          {title: 'Height', value: ''},
          {title: 'Weight', value: ''},
          {title: 'Eye Color', value: ''},
          {title: 'Post Date', value: ''}
        ]
      };

      app.getSearchFieldColumns = function() {
        return _.keys(app.searchFields);
      };

      app.getSearchFieldColumn = function(key) {
        return app.searchFields[key];
      };

      app.toggleSearchDropdownPanel = function() {
        app.showMoreSearchOptions = !app.showMoreSearchOptions;
        this.$.moreSearchOptions.toggle();
        this.$.moreSearchOptionsBtn.open = app.showMoreSearchOptions ? true : false;
      };

      /* end search dropdown panel code */

      app.createAnnotationOptionsBuckets = function() {
        return [{
          key: 'showRelevant',
          text: 'Show Only "Relevant" Ads'
        }, {
          key: 'hideNotRelevant',
          text: 'Hide "Not Relevant" Ads'
        }];
      };

      app.createHasImageFacetBuckets = function() {
        return [{
          key: 'Yes'
        }];
      };

      app.createSearchInputLabel = function(advancedSearch) {
        return advancedSearch ? 'Enter Keywords (Advanced Search On)' : 'Enter Keywords';
      };

      app.emailSupport = function() {
        window.open('mailto:dig-support@nextcentury.com');
      };

      app.generateLink = function() {
        this.$.menuDropdown.close();
        this.$.stateManager.generateLink();
      };

      app.getAdvancedSearchTitle = function(advancedSearch) {
        return 'Click to ' + (advancedSearch ? 'Deactivate' : 'Activate') + ' Advanced Search Mode';
      };

      app.getBlurStyleClass = function(blurImages) {
        return blurImages ? 'small-blur' : '';
      };

      app.getElasticTypes = function() {
        return ['webpage'];
      };

      app.isSaveButtonDisabled = function(searchResults, searchError) {
        return !(searchResults !== null && searchError === null);
      };

      app.noFacets = function() {
        return _.keys(app.searchParameters).every(function(facet) {
          if(facet === 'annotationsFilter' || facet === 'sort' || facet === 'text' || _.isEmpty(app.searchParameters[facet])) {
            return true;
          }
          return _.keys(app.searchParameters[facet]).every(function(key) {
            return !app.searchParameters[facet][key].enabled;
          });
        });
      };

      app.noSearchParameters = function() {
        return _.keys(app.searchParameters).every(function(facet) {
          return facet === 'sort' || _.isEmpty(app.searchParameters[facet]);
        });
      };

      app.openBatchPhoneSearchDialog = function() {
        this.$.menuDropdown.close();
        this.$.bulkSearchDialog.open();
      };

      app.openSaveSearchDialog = function() {
        this.$.menuDropdown.close();
        this.$.saveSearchDialog.open();
      };

      app.openSearchHelpDialog = function() {
        this.$.menuDropdown.close();
        this.$.searchHelpDialog.open();
      };

      app.openSimilarImageSearchDialog = function() {
        this.$.menuDropdown.close();
        this.$.similarImageSearchDialog.open();
      };

      app.showAll = function() {
        this.$.menuDropdown.close();
        app.set('searchParameters.text', null);
      };

      app.toggleMenu = function() {
        if(this.$.menuDropdown.style.display === 'none') {
          this.$.menuDropdown.open();
        } else {
          this.$.menuDropdown.close();
        }
      };

      app.toggleAdvancedSearch = function() {
        document.querySelector('load-user-info')._toggleAdvancedSearch();
      };

      /**
       * Opens or closes the facet list corresponding to the ID of the element that triggered the event.
       */
      app.toggleList = function(event) {
        if(event.target.parentElement && event.target.parentElement.id) {
          var type = event.target.parentElement.id;
          if(this.$[type + '-list']) {
            this.$[type + '-list'].toggle();
            this.$[type + '-icon-closed'].style.display = (this.$[type + '-icon-closed'].style.display !== 'none' ? 'none' : '');
            this.$[type + '-icon-opened'].style.display = (this.$[type + '-icon-opened'].style.display !== 'none' ? 'none' : '');
          }
        }
      };

      app.toggleAllFacetLists = function() {
        app.facetListsExpanded = !app.facetListsExpanded;
        // All facet lists should have the class 'facet' and an id
        var allFacetListNames = document.querySelectorAll('.facet');

        for(var i = 0, length = allFacetListNames.length; i < length; i++) {
          if(allFacetListNames[i].id) {
            var name = allFacetListNames[i].id;
            this.$[name + '-list'].opened = app.facetListsExpanded;
            this.$[name + '-icon-closed'].style.display = app.facetListsExpanded ? 'none' : '';
            this.$[name + '-icon-opened'].style.display = (!app.facetListsExpanded) ? 'none' : '';
          }
        }
      };

      app.getToggleAllFacetsText = function() {
        return (app.facetListsExpanded ? 'Collapse' : 'Expand') + ' All';
      };

      app.getToggleAllFacetsIcon = function() {
        return (app.facetListsExpanded ? 'icons:expand-less' : 'icons:expand-more');
      };
    })(document);
  </script>
</body>

</html>
