<!doctype html>

<html lang="">

<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="generator" content="Polymer Starter Kit" />
  <title>DIG</title>
  <!-- Place favicon.ico in the `app/` directory -->

  <!-- Chrome for Android theme color -->
  <meta name="theme-color" content="#2E3AA1">

  <!-- Web Application Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Tile color for Win8 -->
  <meta name="msapplication-TileColor" content="#3372DF">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="PSK">
  <link rel="icon" sizes="192x192" href="images/touch/chrome-touch-icon-192x192.png">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Polymer Starter Kit">
  <link rel="apple-touch-icon" href="images/touch/apple-touch-icon.png">

  <!-- Tile icon for Win8 (144x144) -->
  <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">

  <!-- build:css styles/main.css -->
  <!-- Must link leaflet css (https://github.com/leaflet-extras/leaflet-map/issues/46) -->
  <link rel="stylesheet" href="bower_components/leaflet/dist/leaflet.css">
  <link rel="stylesheet" href="styles/main.css">
  <!-- endbuild-->

  <!-- build:js bower_components/webcomponentsjs/webcomponents-lite.min.js -->
  <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <!-- endbuild -->

  <script src="scripts/google-analytics.js"></script>
  
  <!-- will be replaced with elements/elements.vulcanized.html -->
  <link rel="import" href="elements/elements.html">
  <!-- endreplace-->

  <style is="custom-style" include="search-styles"></style>
  <style is="custom-style" include="web-component-styles"></style>
</head>

<body unresolved class="fullbleed layout vertical">
  <span id="browser-sync-binding"></span>

  <template is="dom-bind" id="app">

    <!-- exposes clientConfig object which is a container for data
      transform functions -->
    <client-config config="{{clientConfig}}"></client-config>

    <!--get app configuration from server -->
    <iron-ajax
      id="ajax"
      auto
      url="/config"
      handle-as="json"
      last-response="{{config}}">
    </iron-ajax>

    <!--initialize new elastic client connection to server
      esclient can be used throughout the application lifecycle -->
    <elastic-client
      config="[[config.elasticConfig]]"
      client="{{esclient}}">
    </elastic-client>

    <!-- Main Search Query -->
    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      page="{{pageNum}}"
      page-size="{{pageSize}}"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{searchResults}}"
      last-error="{{searchError}}"
      result-count="{{resultCount}}"
      aggregations="[]"
      filters="[[buildArray(countryFilter, cityFilter, phoneFilter, emailFilter, publisherFilter, nameFilter, ageFilter, ethnicityFilter, heightFilter, weightFilter, hairColorFilter, eyeColorFilter)]]"
      sort="{{sort}}"
      loading="{{loading}}">
    </elastic-client-search>

    <json-transform
      data-in="{{searchResults}}"
      data-out="{{records}}"
      transform-function="[[clientConfig.transforms.relatedEntities.webpage]]">
    </json-transform>

    <!-- Facets -->
    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{countryResult}}"
      last-error="{{countryError}}"
      aggregations="{{buildArray(countryAgg)}}"
      filters="[[buildArray(countryFilter, cityFilter, phoneFilter, emailFilter, publisherFilter, nameFilter, ageFilter, ethnicityFilter, heightFilter, weightFilter, hairColorFilter, eyeColorFilter)]]"
      loading="{{countryLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{cityResult}}"
      last-error="{{cityError}}"
      aggregations="{{buildArray(cityAgg)}}"
      filters="[[buildArray(countryFilter, cityFilter, phoneFilter, emailFilter, publisherFilter, nameFilter, ageFilter, ethnicityFilter, heightFilter, weightFilter, hairColorFilter, eyeColorFilter)]]"
      loading="{{cityLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{phoneEmailResult}}"
      last-error="{{phoneEmailError}}"
      aggregations="{{buildArray(phoneEmailAgg)}}"
      filters="[[buildArray(countryFilter, cityFilter, phoneFilter, emailFilter, publisherFilter, nameFilter, ageFilter, ethnicityFilter, heightFilter, weightFilter, hairColorFilter, eyeColorFilter)]]"
      loading="{{phoneEmailLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{publisherResult}}"
      last-error="{{publisherError}}"
      aggregations="{{buildArray(publisherAgg)}}"
      filters="[[buildArray(countryFilter, cityFilter, phoneFilter, emailFilter, publisherFilter, nameFilter, ageFilter, ethnicityFilter, heightFilter, weightFilter, hairColorFilter, eyeColorFilter)]]"
      loading="{{publisherLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{nameResult}}"
      last-error="{{nameError}}"
      aggregations="{{buildArray(nameAgg)}}"
      filters="[[buildArray(countryFilter, cityFilter, phoneFilter, emailFilter, publisherFilter, nameFilter, ageFilter, ethnicityFilter, heightFilter, weightFilter, hairColorFilter, eyeColorFilter)]]"
      loading="{{nameLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{ageResult}}"
      last-error="{{ageError}}"
      aggregations="{{buildArray(ageAgg)}}"
      filters="[[buildArray(countryFilter, cityFilter, phoneFilter, emailFilter, publisherFilter, nameFilter, ageFilter, ethnicityFilter, heightFilter, weightFilter, hairColorFilter, eyeColorFilter)]]"
      loading="{{ageLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{ethnicityResult}}"
      last-error="{{ethnicityError}}"
      aggregations="{{buildArray(ethnicityAgg)}}"
      filters="[[buildArray(countryFilter, cityFilter, phoneFilter, emailFilter, publisherFilter, nameFilter, ageFilter, ethnicityFilter, heightFilter, weightFilter, hairColorFilter, eyeColorFilter)]]"
      loading="{{ethnicityLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{heightResult}}"
      last-error="{{heightError}}"
      aggregations="{{buildArray(heightAgg)}}"
      filters="[[buildArray(countryFilter, cityFilter, phoneFilter, emailFilter, publisherFilter, nameFilter, ageFilter, ethnicityFilter, heightFilter, weightFilter, hairColorFilter, eyeColorFilter)]]"
      loading="{{heightLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{weightResult}}"
      last-error="{{weightError}}"
      aggregations="{{buildArray(weightAgg)}}"
      filters="[[buildArray(countryFilter, cityFilter, phoneFilter, emailFilter, publisherFilter, nameFilter, ageFilter, ethnicityFilter, heightFilter, weightFilter, hairColorFilter, eyeColorFilter)]]"
      loading="{{weightLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{hairColorResult}}"
      last-error="{{hairColorError}}"
      aggregations="{{buildArray(hairColorAgg)}}"
      filters="[[buildArray(countryFilter, cityFilter, phoneFilter, emailFilter, publisherFilter, nameFilter, ageFilter, ethnicityFilter, heightFilter, weightFilter, hairColorFilter, eyeColorFilter)]]"
      loading="{{hairColorLoading}}">
    </elastic-client-search>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[ejsQuery]]"
      results="{{eyeColorResult}}"
      last-error="{{eyeColorError}}"
      aggregations="{{buildArray(eyeColorAgg)}}"
      filters="[[buildArray(countryFilter, cityFilter, phoneFilter, emailFilter, publisherFilter, nameFilter, ageFilter, ethnicityFilter, heightFilter, weightFilter, hairColorFilter, eyeColorFilter)]]"
      loading="{{eyeColorLoading}}">
    </elastic-client-search>
    <!-- End Facets -->

    <dig-logger value="[[queryValue]]"
                username="[[config.username]]">
    </dig-logger>

    <paper-header-panel class="flex" mode="waterfall">

      <!-- Search toolbar -->
      <paper-toolbar>
        <img src="images/dig-logo-original.png" alt="">
        <div class="drawer-spacer"></div>
        <!-- Hide until we can support multiple search types.
        <div class="v-divider"></div>
        <elastic-type-selector class="white-input-container"
          available-types="{{config.elasticTypes}}"
          elastic-types="{{esTypes}}">
        </elastic-type-selector>
        -->
        <div class="v-divider"></div>
        <div class="flex-6">
            <elastic-client-input class="white-input-container"
              field="_all"
              value="{{queryValue}}"
              query="{{ejsQuery}}"
              label="Enter Keywords"
              advanced="[[advancedSearch]]"
              autobuild="true">
            </elastic-client-input>
        </div>
        <a href="." style="color: #ffffff;">
          <paper-icon-button icon="clear" title="Reset Page"></paper-icon-button>
        </a>
        <!-- Add a top margin to the user settings so it aligns vertically with the buttons in the elastic-client-input -->
        <user-settings
          username="[[config.username]]"
          show-advanced-search
          advanced-search="{{advancedSearch}}"
          blur-images="{{blurImages}}">
        </user-settings>
      </paper-toolbar>

      <paper-drawer-panel drawer-width="320px">

        <!-- Sidebar on left side -->
        <paper-header-panel drawer>
          <iron-pages attr-for-selected="data-type" selected="webpage">
            <section data-type="webpage">
              <!--TODO: create different sort for all types + different elastic-client-searches for all types -->
              <elastic-sort-input sort-string="{{offerSortString}}" field="dateCreated"></elastic-sort-input>
              <elastic-sort input-string="{{offerSortString}}" sort="{{sort}}"></elastic-sort>

              <div class="h-divider"></div>
              <selected-facets-display facet-selection="{{countryFacetSelection}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{cityFacetSelection}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{phoneFacetSelection}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{emailFacetSelection}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{websiteFacetSelection}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{nameFacetSelection}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{ageFacetSelection}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{ethnicityFacetSelection}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{heightFacetSelection}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{weightFacetSelection}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{hairColorFacetSelection}}"></selected-facets-display>
              <selected-facets-display facet-selection="{{eyeColorFacetSelection}}"></selected-facets-display>

              <div id="country" class="facet-header">
                <span class="facet-toggle" title="Toggle Country Facet List" on-tap="toggleList">Country</span>
                <iron-icon id="country-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Country Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="country-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Country Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="countryAgg"
                field="mainEntity.availableAtOrFrom.address.addressCountry"
                count="{{countryCount}}"
                ejs-aggregation="{{countryAgg}}"
                type="terms">
              </elastic-client-aggregation-builder>

              <view-all-facets
                title="Country"
                buckets="[[countryResult.aggregations.countryAgg.countryAgg.buckets]]"
                loading="[[countryLoading]]"
                error="[[countryError]]"
                facet-selection="{{countryFacetSelection}}"
                agg-count="{{countryCount}}">
              </view-all-facets>

              <iron-collapse id="country-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[countryResult.aggregations.countryAgg.countryAgg.buckets]]"
                  facet-selection="{{countryFacetSelection}}"
                  facets="{{countryFacets}}"
                  category="Country">
                </checkbox-list-display>
                <elastic-checkbox-list-filter
                  facet-selection="{{countryFacetSelection}}"
                  filter-name="countryAgg"
                  combination-type="or"
                  field="mainEntity.availableAtOrFrom.address.addressCountry"
                  ejs-filter="{{countryFilter}}">
                </elastic-checkbox-list-filter>
                <state-message
                  array="[[countryFacets]]"
                  loading="[[countryLoading]]"
                  error="[[countryError]]"
                  label="Facets">
                </state-message>
              </iron-collapse>

              <div id="city" class="facet-header">
                <span class="facet-toggle" title="Toggle City Facet List" on-tap="toggleList">City</span>
                <iron-icon id="city-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle City Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="city-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle City Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="cityAgg"
                field="mainEntity.availableAtOrFrom.address.key"
                count="{{cityCount}}"
                ejs-aggregation="{{cityAgg}}"
                type="terms">
              </elastic-client-aggregation-builder>

              <json-transform
                data-in="{{cityResult}}"
                data-out="{{cityAndStateResult}}"
                transform-function="[[clientConfig.transforms.filterAggs.cityResults]]">
              </json-transform>

              <view-all-facets
                title="City"
                buckets="[[cityAndStateResult.aggregations.cityAgg.cityAgg.buckets]]"
                loading="[[cityLoading]]"
                error="[[cityError]]"
                facet-selection="{{cityFacetSelection}}"
                agg-count="{{cityCount}}">
              </view-all-facets>

              <iron-collapse id="city-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[cityAndStateResult.aggregations.cityAgg.cityAgg.buckets]]"
                  facet-selection="{{cityFacetSelection}}"
                  facets="{{cityFacets}}"
                  category="City">
                </checkbox-list-display>
                <elastic-checkbox-list-filter
                  facet-selection="{{cityFacetSelection}}"
                  filter-name="cityAgg"
                  combination-type="or"
                  field="mainEntity.availableAtOrFrom.address.key"
                  ejs-filter="{{cityFilter}}"
                  category="City">
                </elastic-checkbox-list-filter>
                <state-message
                  array="[[cityFacets]]"
                  loading="[[cityLoading]]"
                  error="[[cityError]]"
                  label="Facets">
                </state-message>
              </iron-collapse>

              <!-- Phone and email use a transform on the same aggregation set -->
              <elastic-client-aggregation-builder
                name="phoneEmailAgg"
                field="mentions"
                ejs-aggregation="{{phoneEmailAgg}}"
                type="terms"
                count="0">
              </elastic-client-aggregation-builder>

              <div id="phone" class="facet-header">
                <span class="facet-toggle" title="Toggle Telephone Facet List" on-tap="toggleList">Telephone</span>
                <iron-icon id="phone-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Telephone Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="phone-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Telephone Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <facets-transform
                data-in="{{phoneEmailResult}}"
                data-out="{{phoneResult}}"
                limit="{{phoneCount}}"
                transform-function="[[clientConfig.transforms.filterAggs.mentionsPhoneResults]]">
              </facets-transform>

              <view-all-facets
                title="Telephone"
                buckets="[[phoneResult.aggregations.phoneAgg.phoneAgg.buckets]]"
                current-max-facets="[[phoneFacetMax]]"
                loading="[[phoneEmailLoading]]"
                error="[[phoneEmailError]]"
                facet-selection="{{phoneFacetSelection}}"
                agg-count="{{phoneCount}}"
                paging="true">
              </view-all-facets>

              <iron-collapse id="phone-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[phoneResult.aggregations.phoneAgg.phoneAgg.buckets]]"
                  facet-selection="{{phoneFacetSelection}}"
                  facets="{{phoneFacets}}"
                  show="{{phoneFacetMax}}"
                  category="Telephone">
                </checkbox-list-display>
                <elastic-checkbox-list-filter
                  facet-selection="{{phoneFacetSelection}}"
                  filter-name="phoneAgg"
                  combination-type="or"
                  field="mentions"
                  ejs-filter="{{phoneFilter}}"
                  category="Telephone">
                </elastic-checkbox-list-filter>
                <state-message
                  array="[[phoneFacets]]"
                  loading="[[phoneEmailLoading]]"
                  error="[[phoneEmailError]]"
                  label="Facets">
                </state-message>
              </iron-collapse>

              <div id="email" class="facet-header">
                <span class="facet-toggle" title="Toggle Email Address Facet List" on-tap="toggleList">Email Address</span>
                <iron-icon id="email-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Email Address Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="email-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Email Address Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <facets-transform
                data-in="{{phoneEmailResult}}"
                data-out="{{emailResult}}"
                limit="{{emailCount}}"
                transform-function="[[clientConfig.transforms.filterAggs.mentionsEmailResults]]">
              </facets-transform>

              <view-all-facets
                title="Email Address"
                buckets="[[emailResult.aggregations.emailAgg.emailAgg.buckets]]"
                current-max-facets="[[emailFacetMax]]"
                loading="[[phoneEmailLoading]]"
                error="[[phoneEmailError]]"
                facet-selection="{{emailFacetSelection}}"
                agg-count="{{emailCount}}"
                paging="true">
              </view-all-facets>

              <iron-collapse id="email-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[emailResult.aggregations.emailAgg.emailAgg.buckets]]"
                  facet-selection="{{emailFacetSelection}}"
                  facets="{{emailFacets}}"
                  show="{{emailFacetMax}}"
                  category="Email Address">
                </checkbox-list-display>
                <elastic-checkbox-list-filter
                  facet-selection="{{emailFacetSelection}}"
                  filter-name="emailAgg"
                  combination-type="or"
                  field="mentions"
                  ejs-filter="{{emailFilter}}"
                  category="Email Address">
                </elastic-checkbox-list-filter>
                <state-message
                  array="[[emailFacets]]"
                  loading="[[phoneEmailLoading]]"
                  error="[[phoneEmailError]]"
                  label="Facets">
                </state-message>
              </iron-collapse>

              <div id="website" class="facet-header">
                <span class="facet-toggle" title="Toggle Website Facet List" on-tap="toggleList">Website</span>
                <iron-icon id="website-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Website Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="website-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Website Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="publisherAgg"
                field="publisher.name.raw"
                count="{{publisherCount}}"
                ejs-aggregation="{{publisherAgg}}"
                type="terms">
              </elastic-client-aggregation-builder>

              <view-all-facets
                title="Website"
                buckets="[[publisherResult.aggregations.publisherAgg.publisherAgg.buckets]]"
                loading="[[publisherLoading]]"
                error="[[publisherError]]"
                facet-selection="{{websiteFacetSelection}}"
                agg-count="{{publisherCount}}">
              </view-all-facets>

              <iron-collapse id="website-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[publisherResult.aggregations.publisherAgg.publisherAgg.buckets]]"
                  facet-selection="{{websiteFacetSelection}}"
                  facets="{{publisherFacets}}"
                  category="Website">
                </checkbox-list-display>
                <elastic-checkbox-list-filter
                  facet-selection="{{websiteFacetSelection}}"
                  filter-name="publisherAgg"
                  combination-type="or"
                  field="publisher.name.raw"
                  ejs-filter="{{publisherFilter}}"
                  category="Website">
                </elastic-checkbox-list-filter>
                <state-message
                  array="[[publisherFacets]]"
                  loading="[[publisherLoading]]"
                  error="[[publisherError]]"
                  label="Facets">
                </state-message>
              </iron-collapse>

              <div id="name" class="facet-header">
                <span class="facet-toggle" title="Toggle Name Facet List" on-tap="toggleList">Name</span>
                <iron-icon id="name-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Name Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="name-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Name Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="nameAgg"
                field="mainEntity.itemOffered.name.raw"
                count="{{nameCount}}"
                ejs-aggregation="{{nameAgg}}"
                type="terms">
              </elastic-client-aggregation-builder>

              <view-all-facets
                title="Name"
                buckets="[[nameResult.aggregations.nameAgg.nameAgg.buckets]]"
                loading="[[nameLoading]]"
                error="[[nameError]]"
                facet-selection="{{nameFacetSelection}}"
                agg-count="{{nameCount}}">
              </view-all-facets>

              <iron-collapse id="name-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[nameResult.aggregations.nameAgg.nameAgg.buckets]]"
                  facet-selection="{{nameFacetSelection}}"
                  facets="{{nameFacets}}"
                  category="Name">
                </checkbox-list-display>
                <elastic-checkbox-list-filter
                  facet-selection="{{nameFacetSelection}}"
                  filter-name="nameAgg"
                  combination-type="or"
                  field="mainEntity.itemOffered.name.raw"
                  ejs-filter="{{nameFilter}}"
                  category="Name">
                </elastic-checkbox-list-filter>
                <state-message
                  array="[[nameFacets]]"
                  loading="[[nameLoading]]"
                  error="[[nameError]]"
                  label="Facets">
                </state-message>
              </iron-collapse>

              <div id="age" class="facet-header">
                <span class="facet-toggle" title="Toggle Age Facet List" on-tap="toggleList">Age</span>
                <iron-icon id="age-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Age Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="age-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Age Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="ageAgg"
                field="mainEntity.itemOffered.age"
                count="{{ageCount}}"
                ejs-aggregation="{{ageAgg}}"
                type="terms">
              </elastic-client-aggregation-builder>

              <view-all-facets
                title="Age"
                buckets="[[ageResult.aggregations.ageAgg.ageAgg.buckets]]"
                loading="[[ageLoading]]"
                error="[[ageError]]"
                facet-selection="{{ageFacetSelection}}"
                agg-count="{{ageCount}}">
              </view-all-facets>

              <iron-collapse id="age-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[ageResult.aggregations.ageAgg.ageAgg.buckets]]"
                  facet-selection="{{ageFacetSelection}}"
                  facets="{{ageFacets}}"
                  category="Age">
                </checkbox-list-display>
                <elastic-checkbox-list-filter
                  facet-selection="{{ageFacetSelection}}"
                  filter-name="ageAgg"
                  combination-type="or"
                  field="mainEntity.itemOffered.age"
                  ejs-filter="{{ageFilter}}"
                  category="Age">
                </elastic-checkbox-list-filter>
                <state-message
                  array="[[ageFacets]]"
                  loading="[[ageLoading]]"
                  error="[[ageError]]"
                  label="Facets">
                </state-message>
              </iron-collapse>

              <div id="ethnicity" class="facet-header">
                <span class="facet-toggle" title="Toggle Ethnicity Facet List" on-tap="toggleList">Ethnicity</span>
                <iron-icon id="ethnicity-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Ethnicity Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="ethnicity-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Ethnicity Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="ethnicityAgg"
                field="mainEntity.itemOffered.ethnicity"
                count="{{ethnicityCount}}"
                ejs-aggregation="{{ethnicityAgg}}"
                type="terms">
              </elastic-client-aggregation-builder>

              <view-all-facets
                title="Ethnicity"
                buckets="[[ethnicityResult.aggregations.ethnicityAgg.ethnicityAgg.buckets]]"
                loading="[[ethnicityLoading]]"
                error="[[ethnicityError]]"
                facet-selection="{{ethnicityFacetSelection}}"
                agg-count="{{ethnicityCount}}">
              </view-all-facets>

              <iron-collapse id="ethnicity-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[ethnicityResult.aggregations.ethnicityAgg.ethnicityAgg.buckets]]"
                  facet-selection="{{ethnicityFacetSelection}}"
                  facets="{{ethnicityFacets}}"
                  category="Ethnicity">
                </checkbox-list-display>
                <elastic-checkbox-list-filter
                  facet-selection="{{ethnicityFacetSelection}}"
                  filter-name="ethnicityAgg"
                  combination-type="or"
                  field="mainEntity.itemOffered.ethnicity"
                  ejs-filter="{{ethnicityFilter}}"
                  category="Ethnicity">
                </elastic-checkbox-list-filter>
                <state-message
                  array="[[ethnicityFacets]]"
                  loading="[[ethnicityLoading]]"
                  error="[[ethnicityError]]"
                  label="Facets">
                </state-message>
              </iron-collapse>

              <div id="height" class="facet-header">
                <span class="facet-toggle" title="Toggle Height Facet List" on-tap="toggleList">Height (cm)</span>
                <iron-icon id="height-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Height Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="height-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Height Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="heightAgg"
                field="mainEntity.itemOffered.height"
                count="{{heightCount}}"
                ejs-aggregation="{{heightAgg}}"
                type="terms">
              </elastic-client-aggregation-builder>

              <view-all-facets
                title="Height (cm)"
                buckets="[[heightResult.aggregations.heightAgg.heightAgg.buckets]]"
                loading="[[heightLoading]]"
                error="[[heightError]]"
                facet-selection="{{heightFacetSelection}}"
                agg-count="{{heightCount}}">
              </view-all-facets>

              <iron-collapse id="height-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[heightResult.aggregations.heightAgg.heightAgg.buckets]]"
                  facets="{{heightFacets}}"
                  facet-selection="{{heightFacetSelection}}"
                  category="Height (cm)">
                </checkbox-list-display>
                <elastic-checkbox-list-filter
                  facet-selection="{{heightFacetSelection}}"
                  filter-name="heightAgg"
                  combination-type="or"
                  field="mainEntity.itemOffered.height"
                  ejs-filter="{{heightFilter}}"
                  category="Height (cm)">
                </elastic-checkbox-list-filter>
                <state-message
                  array="[[heightFacets]]"
                  loading="[[heightLoading]]"
                  error="[[heightError]]"
                  label="Facets">
                </state-message>
              </iron-collapse>

              <div id="weight" class="facet-header">
                <span class="facet-toggle" title="Toggle Weight Facet List" on-tap="toggleList">Weight (kg)</span>
                <iron-icon id="weight-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Weight Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="weight-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Weight Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="weightAgg"
                field="mainEntity.itemOffered.weight"
                count="{{weightCount}}"
                ejs-aggregation="{{weightAgg}}"
                type="terms">
              </elastic-client-aggregation-builder>

              <view-all-facets
                title="Weight (kg)"
                buckets="[[weightResult.aggregations.weightAgg.weightAgg.buckets]]"
                loading="[[weightLoading]]"
                error="[[weightError]]"
                facet-selection="{{weightFacetSelection}}"
                agg-count="{{weightCount}}">
              </view-all-facets>

              <iron-collapse id="weight-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[weightResult.aggregations.weightAgg.weightAgg.buckets]]"
                  facets="{{weightFacets}}"
                  facet-selection="{{weightFacetSelection}}"
                  category="Weight (kg)">
                </checkbox-list-display>
                <elastic-checkbox-list-filter
                  facet-selection="{{weightFacetSelection}}"
                  filter-name="weightAgg"
                  combination-type="or"
                  field="mainEntity.itemOffered.weight"
                  ejs-filter="{{weightFilter}}"
                  category="Weight (kg)">
                </elastic-checkbox-list-filter>
                <state-message
                  array="[[weightFacets]]"
                  loading="[[weightLoading]]"
                  error="[[weightError]]"
                  label="Facets">
                </state-message>
              </iron-collapse>

              <div id="hair-color" class="facet-header">
                <span class="facet-toggle" title="Toggle Hair Color Facet List" on-tap="toggleList">Hair Color</span>
                <iron-icon id="hair-color-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Hair Color Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="hair-color-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Hair Color Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="hairColorAgg"
                field="mainEntity.itemOffered.hairColor"
                count="{{hairColorCount}}"
                ejs-aggregation="{{hairColorAgg}}"
                type="terms">
              </elastic-client-aggregation-builder>

              <view-all-facets
                title="Hair Color"
                buckets="[[hairColorResult.aggregations.hairColorAgg.hairColorAgg.buckets]]"
                loading="[[hairColorLoading]]"
                error="[[hairColorError]]"
                facet-selection="{{hairColorFacetSelection}}"
                agg-count="{{hairColorCount}}">
              </view-all-facets>

              <iron-collapse id="hair-color-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[hairColorResult.aggregations.hairColorAgg.hairColorAgg.buckets]]"
                  facets="{{hairColorFacets}}"
                  facet-selection="{{hairColorFacetSelection}}"
                  category="Hair Color">
                </checkbox-list-display>
                <elastic-checkbox-list-filter
                  facet-selection="{{hairColorFacetSelection}}"
                  filter-name="hairColorAgg"
                  combination-type="or"
                  field="mainEntity.itemOffered.hairColor"
                  ejs-filter="{{hairColorFilter}}"
                  category="Hair Color">
                </elastic-checkbox-list-filter>
                <state-message
                  array="[[hairColorFacets]]"
                  loading="[[hairColorLoading]]"
                  error="[[hairColorError]]"
                  label="Facets">
                </state-message>
              </iron-collapse>

              <div id="eye-color" class="facet-header">
                <span class="facet-toggle" title="Toggle Eye Color Facet List" on-tap="toggleList">Eye Color</span>
                <iron-icon id="eye-color-icon-opened" class="facet-toggle" icon="icons:expand-less" title="Toggle Eye Color Facet List" on-tap="toggleList"></iron-icon>
                <iron-icon id="eye-color-icon-closed" class="facet-toggle" icon="icons:expand-more" title="Toggle Eye Color Facet List" on-tap="toggleList" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="eyeColorAgg"
                field="mainEntity.itemOffered.eyeColor"
                count="{{eyeColorCount}}"
                ejs-aggregation="{{eyeColorAgg}}"
                type="terms">
              </elastic-client-aggregation-builder>

              <view-all-facets
                title="Eye Color"
                buckets="[[eyeColorResult.aggregations.eyeColorAgg.eyeColorAgg.buckets]]"
                loading="[[eyeColorLoading]]"
                error="[[eyeColorError]]"
                facet-selection="{{eyeColorFacetSelection}}"
                filter="{{eyeColorFilter}}"
                agg-count="{{eyeColorCount}}">
              </view-all-facets>

              <iron-collapse id="eye-color-list" class="facet-list" opened>
                <checkbox-list-display
                  buckets="[[eyeColorResult.aggregations.eyeColorAgg.eyeColorAgg.buckets]]"
                  facets="{{eyeColorFacets}}"
                  facet-selection="{{eyeColorFacetSelection}}"
                  category="Eye Color">
                </checkbox-list-display>
                <elastic-checkbox-list-filter
                  facet-selection="{{eyeColorFacetSelection}}"
                  filter-name="eyeColorAgg"
                  combination-type="or"
                  field="mainEntity.itemOffered.eyeColor"
                  ejs-filter="{{eyeColorFilter}}"
                  category="Eye Color">
                </elastic-checkbox-list-filter>
                <state-message
                  array="[[eyeColorFacets]]"
                  loading="[[eyeColorLoading]]"
                  error="[[eyeColorError]]"
                  label="Facets">
                </state-message>
              </iron-collapse>
            </section>

            <section data-type="phone">phone</section>
            <section data-type="email">email</section>
            <section data-type="adultservice">provider</section>
            <section data-type="seller">seller</section>
            <section data-type="webpage">webpage</section>
            <section data-type=''>ALL</section>
          </iron-pages>
        </paper-header-panel>

        <!-- Main content on right side -->
        <paper-header-panel main>
          <section>
            <div class="search-results-header">
              <template is="dom-if" if="[[!searchError]]">
                <div class="paper-font-title flex">[[recordsListTitle]]</div>
              </template>

              <template is="dom-if" if="[[searchError]]">
                <div class="paper-font-title flex">
                  <error-message error="[[searchError]]"></error-message>
                </div>
              </template>

              <div class="flex-none">
                <!-- Place search controls or view options here -->
              </div>
            </div>
            <div class="h-divider"></div>
            <paper-material class="main-search-results-wrapper">
              <section class="main-search-results">
                <records-list
                  client="[[esclient]]"
                  annotation-index="[[config.annotationIndex]]"
                  annotation-type="[[config.annotationType]]"
                  annotation-relevant="[[config.annotationRelevant]]"
                  annotation-query-template="{{config.queryTemplates.annotationQuery}}"
                  new-tab="true"
                  query-results="{{records.data}}"
                  total-results="{{records.count}}"
                  page="{{pageNum}}"
                  loading="{{loading}}"
                  type="Result"
                  records-list-title="{{recordsListTitle}}"
                  current-user="[[config.username]]"
                  blur="[[blurImages]]">
                </records-list>
              </section>
            </paper-material>
          </section>
        </paper-header-panel>

      </paper-drawer-panel>

    </paper-header-panel>

  </template>

  <script src="behaviors/array-behavior.js"></script>

  <script>
    (function(document) {
      /* globals DigBehaviors */
      var app = document.querySelector('#app');

      app.buildArray = DigBehaviors.ArrayBehavior.buildArray;

      app.getElasticTypes = function() {
        return ['webpage'];
      };

      /**
       * Opens or closes the facet list corresponding to the ID of the element that triggered the event.
       */
      app.toggleList = function(event) {
        if(event.target.parentElement && event.target.parentElement.id) {
          var type = event.target.parentElement.id;
          if(this.$[type + '-list']) {
            this.$[type + '-list'].toggle();
            this.$[type + '-icon-closed'].style.display = (this.$[type + '-icon-closed'].style.display !== 'none' ? 'none' : '');
            this.$[type + '-icon-opened'].style.display = (this.$[type + '-icon-opened'].style.display !== 'none' ? 'none' : '');
          }
        }
      };

    })(document);
  </script>
</body>

</html>
