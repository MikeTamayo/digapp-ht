<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../dig-behaviors/array-behavior.html">
<link rel="import" href="../feature-query-and-display/feature-query-and-display.html">

<dom-module id="people-features">
  <template>
    <style>
      :host {
        display: block;
        --feature-agg-bar-color: var(--light-entity-provider-color);
        overflow-x: auto;
      }
    </style>

    <div class="layout horizontal">
      <feature-query-and-display class="flex-2"
        aggregation-name="people_features"
        aggregation-field="[[getAggregationField('name.raw')]]"
        filter-field="itemOffered.name.raw"
        produced-filter="{{nameFilter}}"
        query-field="[[queryField]]"
        query-values="[[queryValues]]"
        client="[[client]]"
        index="[[index]]"
        index-types='["offer"]'
        consumed-filters="[[buildArray(consumedFilters, ageFilter, ethnicityFilter, hairFilter, eyeFilter, heightFilter, weightFilter)]]"
        transform="[[transforms.common.peopleFeatures]]"
        transform-property="features"
        data-id="key"
        data-text="key"
        feature-title="Name">
      </feature-query-and-display>

      <feature-query-and-display class="flex-2"
        aggregation-name="people_features"
        aggregation-field="[[getAggregationField('age')]]"
        filter-field="itemOffered.age"
        produced-filter="{{ageFilter}}"
        query-field="[[queryField]]"
        query-values="[[queryValues]]"
        client="[[client]]"
        index="[[index]]"
        index-types='["offer"]'
        consumed-filters="[[buildArray(consumedFilters, nameFilter, ethnicityFilter, hairFilter, eyeFilter, heightFilter, weightFilter)]]"
        transform="[[transforms.common.peopleFeatures]]"
        transform-property="features"
        data-id="key"
        data-text="key"
        feature-title="Age">
      </feature-query-and-display>

      <feature-query-and-display class="flex-2"
        aggregation-name="people_features"
        aggregation-field="[[getAggregationField('ethnicity')]]"
        filter-field="itemOffered.ethnicity"
        produced-filter="{{ethnicityFilter}}"
        query-field="[[queryField]]"
        query-values="[[queryValues]]"
        client="[[client]]"
        index="[[index]]"
        index-types='["offer"]'
        consumed-filters="[[buildArray(consumedFilters, nameFilter, ageFilter, hairFilter, eyeFilter, heightFilter, weightFilter)]]"
        transform="[[transforms.common.peopleFeatures]]"
        transform-property="features"
        data-id="key"
        data-text="key"
        feature-title="Ethnicity">
      </feature-query-and-display>

      <feature-query-and-display class="flex-2"
        aggregation-name="people_features"
        aggregation-field="[[getAggregationField('hairColor')]]"
        filter-field="itemOffered.hairColor"
        produced-filter="{{hairFilter}}"
        query-field="[[queryField]]"
        query-values="[[queryValues]]"
        client="[[client]]"
        index="[[index]]"
        index-types='["offer"]'
        consumed-filters="[[buildArray(consumedFilters, nameFilter, ageFilter, ethnicityFilter, eyeFilter, heightFilter, weightFilter)]]"
        transform="[[transforms.common.peopleFeatures]]"
        transform-property="features"
        data-id="key"
        data-text="key"
        feature-title="Hair Color">
      </feature-query-and-display>
    </div>

    <div class="layout horizontal">
      <feature-query-and-display class="flex-2"
        aggregation-name="people_features"
        aggregation-field="[[getAggregationField('eyeColor')]]"
        filter-field="itemOffered.eyeColor"
        produced-filter="{{eyeFilter}}"
        query-field="[[queryField]]"
        query-values="[[queryValues]]"
        client="[[client]]"
        index="[[index]]"
        index-types='["offer"]'
        consumed-filters="[[buildArray(consumedFilters, nameFilter, ageFilter, ethnicityFilter, hairFilter, heightFilter, weightFilter)]]"
        transform="[[transforms.common.peopleFeatures]]"
        transform-property="features"
        data-id="key"
        data-text="key"
        feature-title="Eye Color">
      </feature-query-and-display>

      <feature-query-and-display class="flex-2"
        aggregation-name="people_features"
        aggregation-field="[[getAggregationField('height')]]"
        filter-field="itemOffered.height"
        produced-filter="{{heightFilter}}"
        query-field="[[queryField]]"
        query-values="[[queryValues]]"
        client="[[client]]"
        index="[[index]]"
        index-types='["offer"]'
        consumed-filters="[[buildArray(consumedFilters, nameFilter, ageFilter, ethnicityFilter, hairFilter, eyeFilter, weightFilter)]]"
        transform="[[transforms.common.peopleFeatures]]"
        transform-property="features"
        data-id="key"
        data-text="key"
        feature-title="Height (cm)">
      </feature-query-and-display>

      <feature-query-and-display class="flex-2"
        aggregation-name="people_features"
        aggregation-field="[[getAggregationField('weight')]]"
        filter-field="itemOffered.weight"
        produced-filter="{{weightFilter}}"
        query-field="[[queryField]]"
        query-values="[[queryValues]]"
        client="[[client]]"
        index="[[index]]"
        index-types='["offer"]'
        consumed-filters="[[buildArray(consumedFilters, nameFilter, ageFilter, ethnicityFilter, hairFilter, eyeFilter, heightFilter)]]"
        transform="[[transforms.common.peopleFeatures]]"
        transform-property="features"
        data-id="key"
        data-text="key"
        feature-title="Weight (kg)">
      </feature-query-and-display>

      <!-- Add a 4th column to the bottom row so it matches the top row. -->
      <div class="flex-2"></div>
    </div>
  </template>

  <script>
  (function() {
    /* globals DigBehaviors */
    'use strict';

    Polymer({
      is: 'people-features',

      behaviors: [DigBehaviors.ArrayBehavior],

      properties: {
        /**
         * The field for the elasticsearch query.
         */
        queryField: {
          type: String
        },

        /**
         * The string value or array of values for the elasticsearch query.
         */
        queryValues: {
          type: Array
        },

        /**
         * The elasticsearch client.
         */
        client: {
          type: Object
        },

        /**
         * The elasticsearch index to query.
         */
        index: {
          type: String
        },

        /**
         * The list of elasticjs filters used in the aggregations run by this component.
         */
        consumedFilters: {
          type: Array,
          notify: true
        },

        /**
         * The elasticjs filter created by this component.
         */
        producedFilters: {
          type: Array,
          notify: true,
          computed: 'buildArray(nameFilter, ageFilter, ethnicityFilter, hairFilter, eyeFilter, heightFilter, weightFilter)'
        },

        /**
         * The filter for the name feature.
         */
        nameFilter: {
          type: Object
        },

        /**
         * The filter for the age feature.
         */
        ageFilter: {
          type: Object
        },

        /**
         * The filter for the ethnicity feature.
         */
        ethnicityFilter: {
          type: Object
        },

        /**
         * The filter for the hair color feature.
         */
        hairFilter: {
          type: Object
        },

        /**
         * The filter for the eye color feature.
         */
        eyeFilter: {
          type: Object
        },

        /**
         * The filter for the height feature.
         */
        heightFilter: {
          type: Object
        },

        /**
         * The filter for the weight feature.
         */
        weightFilter: {
          type: Object
        },

        /**
         * The collection of transform functions.
         */
        transforms: {
          type: Object
        }
      },

      /**
       * Returns the aggregation field for the given aggregation field.
       */
      getAggregationField: function(aggregationField) {
        return 'itemOffered.' + aggregationField;
      }
    });
  })();
  </script>
</dom-module>
