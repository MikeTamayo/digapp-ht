<!--
Copyright 2017 Next Century Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/elastic-error/elastic-error.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../feature-query-and-display/feature-query-and-display.html">

<dom-module id="people-features">
  <template>
    <style include="iron-flex iron-flex-factors"></style>

    <style>
      :host {
        display: block;
        overflow-x: auto;
      }

      feature-query-and-display {
        /* TODO Change to min-width 150px if columns are reduced from 4 to 3 */
        min-width: 100px;
      }

      .add-side-margins {
        margin: 0 5px;
      }

      .add-large-bottom-margin {
        margin-bottom: 15px;
      }

      .add-small-bottom-margin {
        margin-bottom: 5px;
      }
    </style>

    <div class="layout horizontal add-large-bottom-margin">
      <div class="flex-4">
        <template is="dom-if" if="[[servicesError]]">
          <elastic-error error="[[servicesError]]" message="{{servicesErrorMessage}}"></elastic-error>
          <div>[[servicesErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="attribute"
          aggregation-field="fields.service.strict.key"
          aggregation-count="[[aggregationCount]]"
          selected="{{selectedServices}}"
          query-field="[[queryField]]"
          query-value="[[queryValue]]"
          client="[[client]]"
          index-name="[[indexName]]"
          index-types='["ads"]'
          error="{{servicesError}}"
          filter-list="[[filterList]]"
          transform-function="[[transforms.offerProviderAttributes]]"
          data-property="attribute"
          item-type="Services"
          count-type="Ads"
          show-checkboxes>
        </feature-query-and-display>
      </div>

      <div class="flex-4">
        <template is="dom-if" if="[[priceError]]">
          <elastic-error error="[[priceError]]" message="{{priceErrorMessage}}"></elastic-error>
          <div>[[priceErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="attribute"
          aggregation-field="fields.price.strict.key"
          aggregation-count="[[aggregationCount]]"
          selected="{{selectedPrice}}"
          query-field="[[queryField]]"
          query-value="[[queryValue]]"
          client="[[client]]"
          index-name="[[indexName]]"
          index-types='["ads"]'
          error="{{priceError}}"
          filter-list="[[filterList]]"
          transform-function="[[transforms.offerProviderAttributes]]"
          data-property="attribute"
          item-type="Price"
          count-type="Ads"
          show-checkboxes>
        </feature-query-and-display>
      </div>

      <div class="flex-4">
        <template is="dom-if" if="[[nameError]]">
          <elastic-error error="[[nameError]]" message="{{nameErrorMessage}}"></elastic-error>
          <div>[[nameErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="attribute"
          aggregation-field="fields.name.strict.key"
          aggregation-count="[[aggregationCount]]"
          selected="{{selectedName}}"
          query-field="[[queryField]]"
          query-value="[[queryValue]]"
          client="[[client]]"
          index-name="[[indexName]]"
          index-types='["ads"]'
          error="{{nameError}}"
          filter-list="[[filterList]]"
          transform-function="[[transforms.offerProviderAttributes]]"
          data-property="attribute"
          item-type="Name"
          count-type="Ads"
          show-checkboxes>
        </feature-query-and-display>
      </div>
    </div>

    <div class="layout horizontal add-small-bottom-margin">
      <div class="flex-4">
        <template is="dom-if" if="[[ageError]]">
          <elastic-error error="[[ageError]]" message="{{ageErrorMessage}}"></elastic-error>
          <div>[[ageErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2 add-side-margins" small
          aggregation-name="attribute"
          aggregation-field="fields.age.strict.key"
          aggregation-count="[[aggregationCount]]"
          selected="{{selectedAge}}"
          query-field="[[queryField]]"
          query-value="[[queryValue]]"
          client="[[client]]"
          index-name="[[indexName]]"
          index-types='["ads"]'
          error="{{ageError}}"
          filter-list="[[filterList]]"
          transform-function="[[transforms.offerProviderAttributes]]"
          data-property="attribute"
          item-type="Age"
          count-type="Ads"
          show-checkboxes>
        </feature-query-and-display>
      </div>

      <div class="flex-4">
        <template is="dom-if" if="[[ethnicityError]]">
          <elastic-error error="[[ethnicityError]]" message="{{ethnicityErrorMessage}}"></elastic-error>
          <div>[[ethnicityErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2 add-side-margins" small
          aggregation-name="attribute"
          aggregation-field="fields.ethnicity.strict.key"
          aggregation-count="[[aggregationCount]]"
          selected="{{selectedEthnicity}}"
          query-field="[[queryField]]"
          query-value="[[queryValue]]"
          client="[[client]]"
          index-name="[[indexName]]"
          index-types='["ads"]'
          error="{{ethnicityError}}"
          filter-list="[[filterList]]"
          transform-function="[[transforms.offerProviderAttributes]]"
          data-property="attribute"
          item-type="Ethnicity"
          count-type="Ads"
          show-checkboxes>
        </feature-query-and-display>
      </div>

      <div class="flex-4">
        <template is="dom-if" if="[[eyeError]]">
          <elastic-error error="[[eyeError]]" message="{{eyeErrorMessage}}"></elastic-error>
          <div>[[eyeErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="attribute"
          aggregation-field="fields.eye_color.strict.key"
          aggregation-count="[[aggregationCount]]"
          selected="{{selectedEyeColor}}"
          query-field="[[queryField]]"
          query-value="[[queryValue]]"
          client="[[client]]"
          index-name="[[indexName]]"
          index-types='["ads"]'
          error="{{eyeError}}"
          filter-list="[[filterList]]"
          transform-function="[[transforms.offerProviderAttributes]]"
          data-property="attribute"
          item-type="Eye Color"
          count-type="Ads"
          show-checkboxes>
        </feature-query-and-display>
      </div>
    </div>

    <div class="layout horizontal add-small-bottom-margin">
      <div class="flex-4">
        <template is="dom-if" if="[[hairError]]">
          <elastic-error error="[[hairError]]" message="{{hairErrorMessage}}"></elastic-error>
          <div>[[hairErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="attribute"
          aggregation-field="fields.hair_color.strict.key"
          aggregation-count="[[aggregationCount]]"
          selected="{{selectedHairColor}}"
          query-field="[[queryField]]"
          query-value="[[queryValue]]"
          client="[[client]]"
          index-name="[[indexName]]"
          index-types='["ads"]'
          error="{{hairError}}"
          filter-list="[[filterList]]"
          transform-function="[[transforms.offerProviderAttributes]]"
          data-property="attribute"
          item-type="Hair Color"
          count-type="Ads"
          show-checkboxes>
        </feature-query-and-display>
      </div>

      <div class="flex-4">
        <template is="dom-if" if="[[heightError]]">
          <elastic-error error="[[heightError]]" message="{{heightErrorMessage}}"></elastic-error>
          <div>[[heightErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2 add-side-margins" small
          aggregation-name="attribute"
          aggregation-field="fields.height.strict.key"
          aggregation-count="[[aggregationCount]]"
          selected="{{selectedHeight}}"
          query-field="[[queryField]]"
          query-value="[[queryValue]]"
          client="[[client]]"
          index-name="[[indexName]]"
          index-types='["ads"]'
          error="{{heightError}}"
          filter-list="[[filterList]]"
          transform-function="[[transforms.offerProviderAttributes]]"
          data-property="attribute"
          item-type="Height (cm)"
          count-type="Ads"
          show-checkboxes>
        </feature-query-and-display>
      </div>

      <div class="flex-4">
        <template is="dom-if" if="[[weightError]]">
          <elastic-error error="[[weightError]]" message="{{weightErrorMessage}}"></elastic-error>
          <div>[[weightErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2 add-side-margins" small
          aggregation-name="attribute"
          aggregation-field="fields.weight.strict.key"
          aggregation-count="[[aggregationCount]]"
          selected="{{selectedWeight}}"
          query-field="[[queryField]]"
          query-value="[[queryValue]]"
          client="[[client]]"
          index-name="[[indexName]]"
          index-types='["ads"]'
          error="{{weightError}}"
          filter-list="[[filterList]]"
          transform-function="[[transforms.offerProviderAttributes]]"
          data-property="attribute"
          item-type="Weight (kg)"
          count-type="Ads"
          show-checkboxes>
        </feature-query-and-display>
      </div>
    </div>
  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'people-features',

      properties: {
        /**
         * The field for the elasticsearch query.
         */
        queryField: {
          type: String
        },

        /**
         * The value for the elasticsearch query.
         */
        queryValue: {
          type: String
        },

        /**
         * The count of results for all the elasticsearch aggregations.  Default is 0 (all results).
         */
        aggregationCount: {
          type: Number,
          value: 0
        },

        /**
         * The elasticsearch client.
         */
        client: {
          type: Object
        },

        /**
         * The elasticsearch index to query.
         */
        indexName: {
          type: String
        },

        /**
         * The list of elasticjs filters used in the aggregations run by this component.
         */
        filterList: {
          type: Array
        },

        /**
         * The list of selected age strings.
         */
        selectedAge: {
          type: Array,
          notify: true
        },

        /**
         * The list of selected ethnicity strings.
         */
        selectedEthnicity: {
          type: Array,
          notify: true
        },

        /**
         * The list of selected eye color strings.
         */
        selectedEyeColor: {
          type: Array,
          notify: true
        },

        /**
         * The list of selected hair color strings.
         */
        selectedHairColor: {
          type: Array,
          notify: true
        },

        /**
         * The list of selected height strings.
         */
        selectedHeight: {
          type: Array,
          notify: true
        },

        /**
         * The list of selected name strings.
         */
        selectedName: {
          type: Array,
          notify: true
        },

        /**
         * The list of selected price strings.
         */
        selectedPrice: {
          type: Array,
          notify: true
        },

        /**
         * The list of selected services strings.
         */
        selectedServices: {
          type: Array,
          notify: true
        },

        /**
         * The list of selected weight strings.
         */
        selectedWeight: {
          type: Array,
          notify: true
        },

        /**
         * The error for the age feature.
         */
        ageError: {
          type: Object
        },

        /**
         * The error for the ethnicity feature.
         */
        ethnicityError: {
          type: Object
        },

        /**
         * The error for the eye color feature.
         */
        eyeError: {
          type: Object
        },

        /**
         * The error for the hair color feature.
         */
        hairError: {
          type: Object
        },

        /**
         * The error for the height feature.
         */
        heightError: {
          type: Object
        },

        /**
         * The error for the name feature.
         */
        nameError: {
          type: Object
        },

        /**
         * The error for the price feature.
         */
        priceError: {
          type: Object
        },

        /**
         * The error for the services feature.
         */
        servicesError: {
          type: Object
        },

        /**
         * The error for the weight feature.
         */
        weightError: {
          type: Object
        },

        /**
         * Whether or not to display a checkbox in each horizontal-bar.
         */
        showCheckboxes: {
          type: Boolean,
          value: false
        },

        /**
         * The collection of feature transform functions.
         */
        transforms: {
          type: Object
        }
      }
    });
  })();
  </script>
</dom-module>
