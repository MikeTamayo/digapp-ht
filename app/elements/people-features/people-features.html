<!--
Copyright 2017 Next Century Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/elastic-error/elastic-error.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../feature-query-and-display/feature-query-and-display.html">

<dom-module id="people-features">
  <template>
    <style include="iron-flex iron-flex-factors"></style>

    <style>
      :host {
        display: block;
        overflow-x: auto;
        --horizontal-bar-color: var(--light-entity-provider-color);
      }
    </style>

    <div class="layout horizontal">
      <div class="flex-2">
        <template is="dom-if" if="[[nameError]]">
          <elastic-error error="[[nameError]]" message="{{nameErrorMessage}}"></elastic-error>
          <div>[[nameErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="name"
          aggregation-field="[[getAggregationField('name.raw')]]"
          filter-field="itemOffered.name.raw"
          selected="{{selectedName}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{nameError}}"
          filter-list="[[filterList]]"
          feature-transform="[[transforms.peopleFeaturesName]]"
          transform-property="name"
          data-id-property="key"
          data-text-property="key"
          feature-title="Name">
        </feature-query-and-display>
      </div>

      <div class="flex-2">
        <template is="dom-if" if="[[ageError]]">
          <elastic-error error="[[ageError]]" message="{{ageErrorMessage}}"></elastic-error>
          <div>[[ageErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="age"
          aggregation-field="[[getAggregationField('age')]]"
          filter-field="itemOffered.age"
          selected="{{selectedAge}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{ageError}}"
          filter-list="[[filterList]]"
          feature-transform="[[transforms.peopleFeaturesAge]]"
          transform-property="age"
          data-id-property="key"
          data-text-property="key"
          feature-title="Age">
        </feature-query-and-display>
      </div>

      <div class="flex-2">
        <template is="dom-if" if="[[ethnicityError]]">
          <elastic-error error="[[ethnicityError]]" message="{{ethnicityErrorMessage}}"></elastic-error>
          <div>[[ethnicityErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="ethnicity"
          aggregation-field="[[getAggregationField('ethnicity')]]"
          filter-field="itemOffered.ethnicity"
          selected="{{selectedEthnicity}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{ethnicityError}}"
          filter-list="[[filterList]]"
          feature-transform="[[transforms.peopleFeaturesEthnicity]]"
          transform-property="ethnicity"
          data-id-property="key"
          data-text-property="key"
          feature-title="Ethnicity">
        </feature-query-and-display>
      </div>

      <div class="flex-2">
        <template is="dom-if" if="[[hairError]]">
          <elastic-error error="[[hairError]]" message="{{hairErrorMessage}}"></elastic-error>
          <div>[[hairErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="hairColor"
          aggregation-field="[[getAggregationField('hairColor')]]"
          filter-field="itemOffered.hairColor"
          selected="{{selectedHairColor}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{hairError}}"
          filter-list="[[filterList]]"
          feature-transform="[[transforms.peopleFeaturesHairColor]]"
          transform-property="hairColor"
          data-id-property="key"
          data-text-property="key"
          feature-title="Hair Color">
        </feature-query-and-display>
      </div>
    </div>

    <div class="layout horizontal">
      <div class="flex-2">
        <template is="dom-if" if="[[eyeError]]">
          <elastic-error error="[[eyeError]]" message="{{eyeErrorMessage}}"></elastic-error>
          <div>[[eyeErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="eyeColor"
          aggregation-field="[[getAggregationField('eyeColor')]]"
          filter-field="itemOffered.eyeColor"
          selected="{{selectedEyeColor}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{eyeError}}"
          filter-list="[[filterList]]"
          feature-transform="[[transforms.peopleFeaturesEyeColor]]"
          transform-property="eyeColor"
          data-id-property="key"
          data-text-property="key"
          feature-title="Eye Color">
        </feature-query-and-display>
      </div>

      <div class="flex-2">
        <template is="dom-if" if="[[heightError]]">
          <elastic-error error="[[heightError]]" message="{{heightErrorMessage}}"></elastic-error>
          <div>[[heightErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="height"
          aggregation-field="[[getAggregationField('height')]]"
          filter-field="itemOffered.height"
          selected="{{selectedHeight}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{heightError}}"
          filter-list="[[filterList]]"
          feature-transform="[[transforms.peopleFeaturesHeight]]"
          transform-property="height"
          data-id-property="key"
          data-text-property="key"
          feature-title="Height (cm)">
        </feature-query-and-display>
      </div>

      <div class="flex-2">
        <template is="dom-if" if="[[weightError]]">
          <elastic-error error="[[weightError]]" message="{{weightErrorMessage}}"></elastic-error>
          <div>[[weightErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="weight"
          aggregation-field="[[getAggregationField('weight')]]"
          filter-field="itemOffered.weight"
          selected="{{selectedWeight}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{weightError}}"
          filter-list="[[filterList]]"
          feature-transform="[[transforms.peopleFeaturesWeight]]"
          transform-property="weight"
          data-id-property="key"
          data-text-property="key"
          feature-title="Weight (kg)">
        </feature-query-and-display>
      </div>

      <!-- Add a 4th column to the bottom row so it matches the top row. -->
      <div class="flex-2"></div>
    </div>
  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'people-features',

      properties: {
        /**
         * The field for the elasticsearch query.
         */
        queryField: {
          type: String
        },

        /**
         * The string value or array of values for the elasticsearch query.
         */
        queryValues: {
          type: Array
        },

        /**
         * The elasticsearch client.
         */
        client: {
          type: Object
        },

        /**
         * The elasticsearch index to query.
         */
        index: {
          type: String
        },

        /**
         * The list of elasticjs filters used in the aggregations run by this component.
         */
        filterList: {
          type: Array
        },

        /**
         * The list of selected name strings.
         */
        selectedName: {
          type: Object,
          notify: true
        },

        /**
         * The list of selected age strings.
         */
        selectedAge: {
          type: Object,
          notify: true
        },

        /**
         * The list of selected ethnicity strings.
         */
        selectedEthnicity: {
          type: Object,
          notify: true
        },

        /**
         * The list of selected eye color strings.
         */
        selectedEyeColor: {
          type: Object,
          notify: true
        },

        /**
         * The list of selected hair color strings.
         */
        selectedHairColor: {
          type: Object,
          notify: true
        },

        /**
         * The list of selected height strings.
         */
        selectedHeight: {
          type: Object,
          notify: true
        },

        /**
         * The list of selected weight strings.
         */
        selectedWeight: {
          type: Object,
          notify: true
        },

        /**
         * The error for the name feature.
         */
        nameError: {
          type: Object
        },

        /**
         * The error for the age feature.
         */
        ageError: {
          type: Object
        },

        /**
         * The error for the ethnicity feature.
         */
        ethnicityError: {
          type: Object
        },

        /**
         * The error for the hair color feature.
         */
        hairError: {
          type: Object
        },

        /**
         * The error for the eye color feature.
         */
        eyeError: {
          type: Object
        },

        /**
         * The error for the height feature.
         */
        heightError: {
          type: Object
        },

        /**
         * The error for the weight feature.
         */
        weightError: {
          type: Object
        },

        /**
         * The collection of feature transform functions.
         */
        transforms: {
          type: Object
        }
      },

      /**
       * Returns the aggregation field for the given aggregation field.
       */
      getAggregationField: function(aggregationField) {
        return 'itemOffered.' + aggregationField;
      }
    });
  })();
  </script>
</dom-module>
