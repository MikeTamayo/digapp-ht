<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/elastic-error/elastic-error.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../behaviors.html">
<link rel="import" href="../feature-query-and-display/feature-query-and-display.html">

<dom-module id="people-features">
  <template>
    <style include="iron-flex iron-flex-factors"></style>

    <style>
      :host {
        display: block;
        overflow-x: auto;
        --horizontal-bar-color: var(--light-entity-provider-color);
      }
    </style>

    <div class="layout horizontal">
      <div class="flex-2">
        <template is="dom-if" if="[[nameError]]">
          <elastic-error error="[[nameError]]" message="{{nameErrorMessage}}"></elastic-error>
          <div>[[nameErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="people_features"
          aggregation-field="[[getAggregationField('name.raw')]]"
          filter-field="itemOffered.name.raw"
          produced-filter="{{nameFilter}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{nameError}}"
          consumed-filters="[[buildArray(consumedFilters, ageFilter, ethnicityFilter, hairFilter, eyeFilter, heightFilter, weightFilter)]]"
          transform="[[transforms.common.peopleFeatures]]"
          transform-property="features"
          data-id-property="key"
          data-text-property="key"
          feature-title="Name">
        </feature-query-and-display>
      </div>

      <div class="flex-2">
        <template is="dom-if" if="[[ageError]]">
          <elastic-error error="[[ageError]]" message="{{ageErrorMessage}}"></elastic-error>
          <div>[[ageErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="people_features"
          aggregation-field="[[getAggregationField('age')]]"
          filter-field="itemOffered.age"
          produced-filter="{{ageFilter}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{ageError}}"
          consumed-filters="[[buildArray(consumedFilters, nameFilter, ethnicityFilter, hairFilter, eyeFilter, heightFilter, weightFilter)]]"
          transform="[[transforms.common.peopleFeatures]]"
          transform-property="features"
          data-id-property="key"
          data-text-property="key"
          feature-title="Age">
        </feature-query-and-display>
      </div>

      <div class="flex-2">
        <template is="dom-if" if="[[ethnicityError]]">
          <elastic-error error="[[ethnicityError]]" message="{{ethnicityErrorMessage}}"></elastic-error>
          <div>[[ethnicityErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="people_features"
          aggregation-field="[[getAggregationField('ethnicity')]]"
          filter-field="itemOffered.ethnicity"
          produced-filter="{{ethnicityFilter}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{ethnicityError}}"
          consumed-filters="[[buildArray(consumedFilters, nameFilter, ageFilter, hairFilter, eyeFilter, heightFilter, weightFilter)]]"
          transform="[[transforms.common.peopleFeatures]]"
          transform-property="features"
          data-id-property="key"
          data-text-property="key"
          feature-title="Ethnicity">
        </feature-query-and-display>
      </div>

      <div class="flex-2">
        <template is="dom-if" if="[[hairError]]">
          <elastic-error error="[[hairError]]" message="{{hairErrorMessage}}"></elastic-error>
          <div>[[hairErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="people_features"
          aggregation-field="[[getAggregationField('hairColor')]]"
          filter-field="itemOffered.hairColor"
          produced-filter="{{hairFilter}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{hairError}}"
          consumed-filters="[[buildArray(consumedFilters, nameFilter, ageFilter, ethnicityFilter, eyeFilter, heightFilter, weightFilter)]]"
          transform="[[transforms.common.peopleFeatures]]"
          transform-property="features"
          data-id-property="key"
          data-text-property="key"
          feature-title="Hair Color">
        </feature-query-and-display>
      </div>
    </div>

    <div class="layout horizontal">
      <div class="flex-2">
        <template is="dom-if" if="[[eyeError]]">
          <elastic-error error="[[eyeError]]" message="{{eyeErrorMessage}}"></elastic-error>
          <div>[[eyeErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="people_features"
          aggregation-field="[[getAggregationField('eyeColor')]]"
          filter-field="itemOffered.eyeColor"
          produced-filter="{{eyeFilter}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{eyeError}}"
          consumed-filters="[[buildArray(consumedFilters, nameFilter, ageFilter, ethnicityFilter, hairFilter, heightFilter, weightFilter)]]"
          transform="[[transforms.common.peopleFeatures]]"
          transform-property="features"
          data-id-property="key"
          data-text-property="key"
          feature-title="Eye Color">
        </feature-query-and-display>
      </div>

      <div class="flex-2">
        <template is="dom-if" if="[[heightError]]">
          <elastic-error error="[[heightError]]" message="{{heightErrorMessage}}"></elastic-error>
          <div>[[heightErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="people_features"
          aggregation-field="[[getAggregationField('height')]]"
          filter-field="itemOffered.height"
          produced-filter="{{heightFilter}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{heightError}}"
          consumed-filters="[[buildArray(consumedFilters, nameFilter, ageFilter, ethnicityFilter, hairFilter, eyeFilter, weightFilter)]]"
          transform="[[transforms.common.peopleFeatures]]"
          transform-property="features"
          data-id-property="key"
          data-text-property="key"
          feature-title="Height (cm)">
        </feature-query-and-display>
      </div>

      <div class="flex-2">
        <template is="dom-if" if="[[weightError]]">
          <elastic-error error="[[weightError]]" message="{{weightErrorMessage}}"></elastic-error>
          <div>[[weightErrorMessage]]</div>
        </template>

        <feature-query-and-display class="flex-2" small
          aggregation-name="people_features"
          aggregation-field="[[getAggregationField('weight')]]"
          filter-field="itemOffered.weight"
          produced-filter="{{weightFilter}}"
          query-field="[[queryField]]"
          query-values="[[queryValues]]"
          client="[[client]]"
          index="[[index]]"
          index-types='["offer"]'
          error="{{weightError}}"
          consumed-filters="[[buildArray(consumedFilters, nameFilter, ageFilter, ethnicityFilter, hairFilter, eyeFilter, heightFilter)]]"
          transform="[[transforms.common.peopleFeatures]]"
          transform-property="features"
          data-id-property="key"
          data-text-property="key"
          feature-title="Weight (kg)">
        </feature-query-and-display>
      </div>

      <!-- Add a 4th column to the bottom row so it matches the top row. -->
      <div class="flex-2"></div>
    </div>
  </template>

  <script>
  (function() {
    /* globals DigBehaviors */
    'use strict';

    Polymer({
      is: 'people-features',

      behaviors: [DigBehaviors.ArrayBehavior],

      properties: {
        /**
         * The field for the elasticsearch query.
         */
        queryField: {
          type: String
        },

        /**
         * The string value or array of values for the elasticsearch query.
         */
        queryValues: {
          type: Array
        },

        /**
         * The elasticsearch client.
         */
        client: {
          type: Object
        },

        /**
         * The elasticsearch index to query.
         */
        index: {
          type: String
        },

        /**
         * The list of elasticjs filters used in the aggregations run by this component.
         */
        consumedFilters: {
          type: Array,
          notify: true
        },

        /**
         * The elasticjs filter created by this component.
         */
        producedFilters: {
          type: Array,
          notify: true,
          computed: 'buildArray(nameFilter, ageFilter, ethnicityFilter, hairFilter, eyeFilter, heightFilter, weightFilter)'
        },

        /**
         * The filter for the name feature.
         */
        nameFilter: {
          type: Object
        },

        /**
         * The filter for the age feature.
         */
        ageFilter: {
          type: Object
        },

        /**
         * The filter for the ethnicity feature.
         */
        ethnicityFilter: {
          type: Object
        },

        /**
         * The filter for the hair color feature.
         */
        hairFilter: {
          type: Object
        },

        /**
         * The filter for the eye color feature.
         */
        eyeFilter: {
          type: Object
        },

        /**
         * The filter for the height feature.
         */
        heightFilter: {
          type: Object
        },

        /**
         * The filter for the weight feature.
         */
        weightFilter: {
          type: Object
        },

        /**
         * The error for the name feature.
         */
        nameError: {
          type: Object
        },

        /**
         * The error for the age feature.
         */
        ageError: {
          type: Object
        },

        /**
         * The error for the ethnicity feature.
         */
        ethnicityError: {
          type: Object
        },

        /**
         * The error for the hair color feature.
         */
        hairError: {
          type: Object
        },

        /**
         * The error for the eye color feature.
         */
        eyeError: {
          type: Object
        },

        /**
         * The error for the height feature.
         */
        heightError: {
          type: Object
        },

        /**
         * The error for the weight feature.
         */
        weightError: {
          type: Object
        },

        /**
         * The collection of transform functions.
         */
        transforms: {
          type: Object
        }
      },

      /**
       * Returns the aggregation field for the given aggregation field.
       */
      getAggregationField: function(aggregationField) {
        return 'itemOffered.' + aggregationField;
      }
    });
  })();
  </script>
</dom-module>
