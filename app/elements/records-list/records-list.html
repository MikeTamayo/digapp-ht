<!--
Copyright 2017 Next Century Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paginated-list/paginated-list.html">
<link rel="import" href="../lodash.html">
<link rel="import" href="../single-record/single-record.html">

<dom-module id="records-list">
  <template>
    <style>
      :host {
        display: block;
        height: 100%;
      }

      paginated-list {
        /* Max Height = Height of 50 Single Records */
        --paginated-list-max-height: 3000px;
      }

      single-record:first-of-type {
        border-top-style: solid;
        border-top-width: 1px;
        border-top-color: var(--primary-background-color);
      }

      single-record {
        border-bottom-style: solid;
        border-bottom-width: 1px;
        border-bottom-color: var(--primary-background-color);
      }
    </style>

    <paginated-list
      loading="[[loading]]"
      load-type="[[computeLoadType(type)]]"
      items="[[queryResults]]"
      total-items="[[totalResults]]"
      page="{{page}}"
      page-size="[[pageSize]]"
      shown-items="{{shownResults}}">

      <template is="dom-repeat" items="{{shownResults}}" initial-count="25">
        <single-record item="{{item}}"
          client="[[client]]"
          annotation-manager="[[annotationManager]]"
          new-tab="[[newTab]]"
          blur="[[blur]]"
          notification-query-date="{{notificationQueryDate}}"
          modal-icon-last>
        </single-record>
      </template>
    </paginated-list>
  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'records-list',

      properties: {
        /**
         * an instance of elasticsearch.Client which is connected to
         * an elasticsearch server
         */
        client: {
          type: Object
        },

        /**
         * The results from a query to show in this list that are reset for each new page.
         */
        queryResults: {
          type: Array
        },

        /**
         * The total number of results for all pages.
         */
        totalResults: {
          type: Number
        },

        /**
         * The results shown in this list that are taken from the query results.
         */
        shownResults: {
          type: Array,
          notify: true
        },

        /**
         * The current page.
         */
        page: {
          type: Number,
          value: 1,
          notify: true
        },

        /**
         * The page size.
         */
        pageSize: {
          type: Number
        },

        /**
         * Whether a query is running.
         */
        loading: {
          type: Boolean,
          value: false,
          notify: true
        },

        /**
         * The annotation manager.
         */
        annotationManager: {
          type: Object
        },

        /**
         * Whether to open a link in a new tab.
         */
        newTab: {
          type: Boolean,
          value: false,
          notify: true
        },

        /**
         * The type of the data to use in the title for this list.
         */
        type: {
          type: String,
          value: 'Record',
          notify: true
        },

        /**
         * The title for this list.
         */
        recordsListTitle: {
          type: String,
          value: 'No Records',
          computed: 'computeTitle(type, shownResults.length, totalResults)',
          notify: true
        },

        /**
         * Whether to blur the images.
         */
        blur: {
          type: Boolean,
          notify: true
        },

        /**
         * Whether a notification query is being viewed and the notification date associated with that query.
         */
        notificationQueryDate: {
          type: Object,
          notify: true
        }

      },

      computeLoadType: function(type) {
        return type + 's';
      },

      /**
       * Returns the title for this list based on the type, shownResults, and totalResults.
       */
      computeTitle: function(type, count, total) {
        if(total) {
          // Use regex replace to add commas to count.
          var totalString = total.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
          if(count && count < total) {
            var countString = count.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            return countString + ' of ' + totalString + ' ' + type + (total === 1 ? '' : 's');
          }
          return totalString + ' ' + type + (total === 1 ? '' : 's');
        }
        return 'No ' + type + 's';
      }
    });
  })();
  </script>
</dom-module>
