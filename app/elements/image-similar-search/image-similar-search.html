<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">

<dom-module id="image-similar-search">
  <template>
    <style include="icon-styles"></style>
    <style include="web-component-styles"></style>

    <style>
      :host {
        display: block;
        height: 100%;
      }
    </style>
      <h3>URL</h3>
      <paper-input type="search" value="{{imageUrl}}" placeholder="Enter Image URL">
      </paper-input>
      
      <div class="buttons">
        <paper-button on-tap="getData" autofocus>Search</paper-button>
      </div>


      <iron-ajax
      id="xhr"
      url="https://isi.memexproxy.com/ColumbiaUimgSearch.php"
      params='{"url":"https://c1.staticflickr.com/9/8177/8055293459_12a4fe0869_z_d.jpg"}'
      handle-as="json"
      method="GET"
      with-credentials="true"
      on-response="handleResponse"></iron-ajax>

      <paper-dialog id="simImages" modal style='width: 75%;'>
        <h2>Similar Images</h2>
        <paper-dialog-scrollable>
          <template is="dom-repeat" items="[[images]]">
            <iron-image src="[[item]]" width="150" height="150" sizing="cover" preload fade></iron-image>
          </template>
        </paper-dialog-scrollable>
        <div class="buttons">
          <paper-button dialog-confirm >Close</paper-button>
        </div>
        </div>
      </paper-dialog>

  </template>

  <script>
  (function() {
    'use strict';

    /* globals DigBehaviors */
    Polymer({
      is: 'image-similar-search',

      properties: {
        headers: {
          type: Object,
          value: function() {
            return {};
          }
        },
        user: String,
        password: String,
        images: {
            type: Array,
            value: function() {
              return [];
            },
            notify: true
        },
        blur: {
          type: Boolean,
          notify: true
        }
      },

      makeHeaders: function(user, password) {
        return "Basic " + btoa(user + ":" + password);
      },

      observers: ['_setBasicAuth(user, password)'],

      _setBasicAuth(user, password) {
          // might be needed
          this.headers['X-Requested-With'] = "XMLHttpRequest";
          this.headers['content-type']='application/json';
          // this sets your Auth header
          this.headers['Authorization'] = this.makeHeaders(user, password);
      },
      handleResponse: function(event) {
        console.log(event.detail.response);
        var resp = event.detail.response;
        this.images = resp.images[0].similar_images.cached_image_urls;
        this.$.simImages.open();
      },
      getData: function(){
        // this.$.xhr.headers['X-Requested-With'] = "XMLHttpRequest";
        // this.$.xhr.headers['Content-type'] = "text/plain";
        // this.$.xhr.headers['Access-Control-Allow-Origin'] = "*";
        this.$.xhr.headers['Authorization'] = this.makeHeaders(this.user, this.password);
        this.$.xhr.generateRequest();
        // var auth = "Basic " + btoa('1dig2' + ":" + 'BotscRHQqalKQIjPAFqK7UI2QNoe88');
        // var ajaxRequest = this.$.ajaxImage;
        // console.log("jbjkbjkbjkbkjbkj");
        // ajaxRequest.headers = '{"X-Requested-With": "XMLHttpRequest" , "authorization": "' + (auth) + '"}'
        // ajaxRequest.method = 'GET';
        // //Authorization = "Basic " + btoa('1dig2' + ":" + 'BotscRHQqalKQIjPAFqK7UI2QNoe88');
        // console.log(ajaxRequest.headers);
        // // make the iron-ajax call
        // ajaxRequest.generateRequest();
      }
    });
  })();
  </script>
</dom-module>
