<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../image-viewer/image-viewer.html">

<dom-module id="image-similar-search">
  <template>
    <style include="icon-styles"></style>
    <style include="web-component-styles"></style>

    <style>
      :host {
        display: block;
        height: 100%;
      }
    </style>
      <h3>URL</h3>
      <paper-input type="search" value="{{imageUrl}}" placeholder="Enter Image URL">
      </paper-input>
      
      <div class="buttons">
        <paper-button on-tap="getData" autofocus>Search</paper-button>
      </div>

<!--       <iron-ajax auto
          url="https://isi.memexproxy.com/ColumbiaUimgSearch.php"
          headers='{"X-Requested-With": "XMLHttpRequest"}'
          params='{"part":"snippet", "q":"polymer", "key": "AIzaSyAuecFZ9xJXbGDkQYWBmYrtzOGJD-iDIgI", "type": "video"}'
          handle-as="json"
          last-response="{{ajaxResponse}}"></iron-ajax> -->

      <iron-ajax
      id="xhr"
      url="https://isi.memexproxy.com/ColumbiaUimgSearch.php"
      params='{"url":"https://s3.amazonaws.com/roxyimages/5df359ba5aa9409fad27de9a895b90dab8291d94.jpg"}'
      handle-as="json"
      method="GET"
      with-credentials="true"
      last-response="{{ajaxResponse}}"></iron-ajax>

<!--     <template is="dom-repeat" items="[[ajaxResponse.images.similar_images.cached_image_urls]]">
        <div class="horizontal-section">
          <h2><a href="[[url(item)]]" target="_blank">url</a></h2>
          <iron-image src="[[item]]" width="256" height="256" sizing="cover" preload fade></iron-image>
        </div>
    </template>

    <div class="loading-container">
      <template is="dom-if" if="[[loading]]">
        <paper-spinner active="[[loading]]"></paper-spinner>
        <span class="button-height-text">Loading Images...</span>
      </template>
    </div> -->

  </template>

  <script>
  (function() {
    'use strict';

    /* globals DigBehaviors */
    Polymer({
      is: 'image-similar-search',

      properties: {
        headers: {
          type: Object,
          value: function() {
            return {};
          }
        },
        user: String,
        password: String

      },


      makeHeaders: function(user, password){
        return "Basic " + btoa(user + ":" + password);
      },

      observers: ['_setBasicAuth(user, password)'],

      _setBasicAuth(user, password){
          // might be needed
          this.headers['X-Requested-With'] = "XMLHttpRequest";
          this.headers['content-type']='application/json';
          // this sets your Auth header
          this.headers['Authorization'] = this.makeHeaders(user, password);
      },
      // observers: ['_setBasicAuth(user, password)'],

      getData: function(){
        // this.$.xhr.headers['X-Requested-With'] = "XMLHttpRequest";
        // this.$.xhr.headers['Content-type'] = "text/plain";
        // this.$.xhr.headers['Access-Control-Allow-Origin'] = "*";
        this.$.xhr.headers['Authorization'] = this.makeHeaders(this.user, this.password);
        this.$.xhr.generateRequest();
        // var auth = "Basic " + btoa('1dig2' + ":" + 'BotscRHQqalKQIjPAFqK7UI2QNoe88');
        // var ajaxRequest = this.$.ajaxImage;
        // console.log("jbjkbjkbjkbkjbkj");
        // ajaxRequest.headers = '{"X-Requested-With": "XMLHttpRequest" , "authorization": "' + (auth) + '"}'
        // ajaxRequest.method = 'GET';
        // //Authorization = "Basic " + btoa('1dig2' + ":" + 'BotscRHQqalKQIjPAFqK7UI2QNoe88');
        // console.log(ajaxRequest.headers);
        // // make the iron-ajax call
        // ajaxRequest.generateRequest();
      }
    });
  })();
  </script>
</dom-module>
