<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<dom-module id="itinerary-list">
  <style>
    :host {
      display: block;
      /* Max Height = Height of 50 Items */
      max-height: 2000px;
      overflow: auto;
    }

    .itinerary-header {
      cursor: pointer;
      padding: 10px;
    }

    .itinerary-header.collapse {
      box-shadow: none;
    }

    .itinerary-header:hover,
    .itinerary-header.expand {
      background-color: rgba(0,0,0,0.05);
    }

    .itinerary-icon {
      padding-right: 5px;
      height: 20px;
      width: 20px;
      vertical-align: text-bottom;
    }

    .date-icon {
      color: var(--entity-date-color);
    }

    .location-icon {
      color: var(--entity-location-color);
    }

    .itinerary-text {
      margin-bottom: 10px;
      padding: 10px
    }

    .itinerary-location {
      margin: 0;
      padding: 5px 0;
    }

    .itinerary-data {
      font-size: 14px;
      margin: 0;
      padding: 5px 0 5px 30px;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  </style>

  <template>
    <template is="dom-repeat" items="{{data}}">
      <div class="itinerary">
        <paper-material class$="itinerary-header {{getHeaderClass(item.expand)}}" on-click="toggleItinerary">
          <iron-icon icon="icons:date-range" class="itinerary-icon date-icon"></iron-icon>
          <strong>{{formatDate(item.date)}}: {{getLocationsForHeader(item.city)}}</strong>
        </paper-material>

        <iron-collapse id="itinerary{{item.date}}">
          <paper-material class="itinerary-text">
            <template is="dom-repeat" items='{{item.city}}' as="city">
              <div>
              <p class="itinerary-location">
                <iron-icon icon="communication:location-on" class="itinerary-icon location-icon"></iron-icon>
                <strong>{{getLocation(city.city)}}</strong>
              </p>
              <template is="dom-repeat" items='{{city.data}}' as="cityItem">
                <p class="itinerary-data">
                  <span class="name"><strong>{{cityItem.key}}:</strong> {{cityItem.value}}</span>
                </p>
              </template>
              </div>
            </template>
          </paper-material>
        </iron-collapse>
      </div>
    </template>
  </template>

  <script>
    Polymer({
      is: 'itinerary-list',

      properties: {
        data: {
          type: Array,
          value: function() {
            return [];
          },
          notify: true
        },
      },

      getLocation: function(city) {
        return city.split(':').slice(0,2).join(', ');
      },

      getHeaderClass: function(expand) {
        return (expand ? 'expand' : 'collapse');
      },

      toggleItinerary: function(event) {
        event.model.set('item.expand', !event.model.item.expand);
        this.$$('#itinerary' + event.model.item.date).toggle();
      },

      formatDate: function(date) {
        return new Date(date).toDateString();
      },

      getLocationsForHeader: function(cities) {
        var locations = '';
        for(var i = 0; i < cities.length; ++i) {
          if(i > 2) {
            locations += ', and ' + (cities.length - 3) + ' more';
            break;
          } else {
            locations += (i > 0 ? ', ' : '') + cities[i].city.split(':')[0];
          }
        }
        return locations;
      }
    });
  </script>
</dom-module>
