<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../item-list/item-list.html">
<link rel="import" href="../records-grid/records-grid.html">

<dom-module id="itinerary-list">
  <template>
    <style include="list-item-styles"></style>

    <style>
      :host {
        display: block;
      }

      item-list {
        /* Max Height = Height of 50 Items */
        --item-list-max-height: 3000px;
      }

      item-list ::content .list-item-body paper-item,
      item-list ::content .list-item-body records-grid {
        margin: 0 40px;
      }
    </style>

    <item-list
      loading="[[loading]]"
      load-type="Timeline"
      items="[[data]]"
      total-items="[[data.length]]">

      <template is="dom-repeat" items="[[data]]" as="dateItem">
        <div class="itinerary">
          <paper-material class$="list-item-head [[getHeaderClass(dateItem.opened)]]" clickable on-tap="toggleItinerary">
            <paper-icon-item>
              <iron-icon class$="list-item-icon [[getProperty(dateItem, dataStyleClassProperty)]]" icon="[[getProperty(dateItem, dataIconProperty)]]" item-icon></iron-icon>
              <iron-icon class="closed-icon" icon="icons:expand-more" item-icon></iron-icon>
              <iron-icon class="opened-icon" icon="icons:expand-less" item-icon></iron-icon>

              <paper-item-body two-line>
                <div>
                  <strong>[[getInterval(interval)]]</strong>
                  <strong title="[[getProperty(dateItem, dataDateProperty)]]">[[getProperty(dateItem, dataDateProperty)]]</strong>
                </div>
                <div secondary><strong title="[[getProperty(dateItem, dataSubtitleProperty, 'Unknown Locations')]]">[[getProperty(dateItem, dataSubtitleProperty, 'Unknown Locations')]]</strong></div>
              </paper-item-body>
            </paper-icon-item>
          </paper-material>

          <iron-collapse id$="[[getId(dateItem, dataDateProperty)]]">
            <div class="list-item-collapse-body">
              <template is="dom-repeat" items="[[getProperty(dateItem, dataItemsProperty)]]" as="materialItem">
                <paper-material class="list-item-body">
                  <paper-icon-item>
                    <iron-icon class$="list-item-icon [[getProperty(materialItem, dataItemStyleClassProperty)]]" icon="[[getProperty(materialItem, dataItemIconProperty)]]" item-icon></iron-icon>
                    <paper-item-body>
                      <div><strong>[[getProperty(materialItem, dataItemNameProperty, 'Unknown')]]</strong></div>
                    </paper-item-body>
                  </paper-icon-item>

                  <paper-item>
                    <paper-item-body>
                      <div>
                        <strong>Count:</strong>
                        <span secondary>[[getProperty(materialItem, dataItemCountProperty, 'Unknown')]]</span>
                      </div>
                    </paper-item-body>
                  </paper-item>

                  <template is="dom-repeat" items="[[getProperty(materialItem, dataItemDetailsProperty)]]" as="detailItem">
                    <paper-item>
                      <paper-item-body>
                        <div><strong class="capitalize">[[getProperty(detailItem, dataDetailNameProperty)]]:</strong></div>
                      </paper-item-body>
                    </paper-item>

                    <records-grid
                      data="[[getProperty(detailItem, dataDetailItemsProperty)]]">
                    </records-grid>
                  </template>
                </paper-material>
              </template>
            </div>
          </iron-collapse>
        </div>
      </template>
    </item-list>
  </template>

  <script>
    Polymer({
      is: 'itinerary-list',

      properties: {
        /**
         * The property for the date for each object in the data.
         */
        dataDateProperty: {
          type: String,
          value: 'date'
        },

        /**
         * The property for the icon for each object in the data.
         */
        dataIconProperty: {
          type: String,
          value: 'icon'
        },

        /**
         * The property for the style class of the icon for each object in the data.
         */
        dataStyleClassProperty: {
          type: String,
          value: 'styleClass'
        },

        /**
         * The property for the items for each object in the data.
         */
        dataItemsProperty: {
          type: String,
          value: 'items'
        },

        /**
         * The property for the name for each item in the items for each object in the data.
         */
        dataItemNameProperty: {
          type: String,
          value: 'name'
        },

        /**
         * The property for the icon for each item in the items for each object in the data.
         */
        dataItemIconProperty: {
          type: String,
          value: 'icon'
        },

        /**
         * The property for the style class of the icon for each item in the items for each object in the data.
         */
        dataItemStyleClassProperty: {
          type: String,
          value: 'styleClass'
        },

        /**
         * The property for the count for each item in the items for each object in the data.
         */
        dataItemCountProperty: {
          type: String,
          value: 'count'
        },

        /**
         * The property for the details for each item in the items for each object in the data.
         */
        dataItemDetailsProperty: {
          type: String,
          value: 'details'
        },

        /**
         * The property for the name for each detail in the details for each item in the items for each object in the data.
         */
        dataDetailNameProperty: {
          type: String,
          value: 'name'
        },

        /**
         * The property for the items for each detail in the details for each item in the items for each object in the data.
         */
        dataDetailItemsProperty: {
          type: String,
          value: 'items'
        },

        /**
         * The property for the subtitle for each object in the data.
         */
        dataSubtitleProperty: {
          type: String,
          value: 'subtitle'
        },

        /**
         * The data to show.
         */
        data: {
          type: Array,
          value: function() {
            return [];
          },
          notify: true
        },

        /**
         * The source of the data to use in the title for this itinerary.
         */
        source: {
          type: String,
          value: ''
        },

        /**
         * The time interval for the data.
         */
        interval: {
          type: String
        },

        /**
         * The title for this itinerary.
         */
        itineraryTitle: {
          type: String,
          value: 'No Data',
          computed: 'computeTitle(source, data.length)',
          notify: true
        },

        /**
         * Whether the data is loading.
         */
        loading: {
          type: Boolean,
          value: false,
          notify: true
        }
      },

      /**
       * Returns the title for this itinerary based on the source and the data.
       */
      computeTitle: function(source, count) {
        return (source ? source + ' ' : '') + 'Timeline (' + (count ? count : 'No') + ' Date' + (count === 1 ? '' : 's') + ')';
      },

      getHeaderClass: function(opened) {
        return (opened ? 'opened' : 'closed');
      },

      getId: function(item, dataDateProperty) {
        return 'itinerary_' + new Date(item[dataDateProperty]).getTime();
      },

      getInterval: function(interval) {
        return interval && interval === 'week' ? 'Week of' : '';
      },

      getProperty: function(item, property, defaultValue) {
        return item[property] || defaultValue;
      },

      toggleItinerary: function(event) {
        event.model.set('dateItem.opened', !event.model.dateItem.opened);
        this.$$('#' + this.getId(event.model.dateItem, this.dataDateProperty)).toggle();
      }
    });
  </script>
</dom-module>
