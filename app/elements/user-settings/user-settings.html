<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">

<script src="../../scripts/google-analytics.js"></script>

<dom-module id="user-settings">
  <template>
    <style>
      :host {
        display: block;
      }

      paper-icon-button {
        @apply(--paper-icon-button);
      }

      paper-material {
        background-color: white;
        border-radius: 2px;
        margin: 0;
        padding: 10px;
        white-space: nowrap;
        width: 600px;
      }

      paper-material > div {
        margin: 10px;
      }

      paper-button {
        margin: 0;
        padding: 0;
      }

      .head {
        font-weight: bold;
      }

      .name {
        color: var(--secondary-text-color);
        font-size: 14px;
        height: 20px;
        line-height: 20px;
        padding-right: 10px;
        text-transform: uppercase;
      }

      .text {
        color: var(--primary-text-color);
        font-size: 18px;
        height: 24px;
        line-height: 24px;
      }

      .divider {
        border: 1px solid #eee;
      }

      .pointer:hover {
        cursor: pointer;
      }

      .checkbox {
        height: 20px;
        width: 20px;
        padding-right: 10px;
      }
    </style>

    <paper-icon-button icon="settings" title="Open User Settings" on-tap="open"></paper-icon-button>

    <paper-dialog id="settings" modal entry-animation="fade-in-animation" exit-animation="fade-out-animation">
      <paper-material elevation="1">
        <div class="layout horizontal">
          <span class="head text flex">User Settings</span>
          <paper-button dialog-confirm title="Close User Settings">
            <iron-icon icon="clear"></iron-icon>
          </paper-button>
        </div>

        <div class="divider"></div>

        <div class="layout horizontal">
          <div class="start-justified flex">
            <span class="name">Logged in as:</span>
            <span class="text">[[username]]</span>
          </div>
          <div class="end-justified">
            <span class="name">DIG Version:</span>
            <span class="text">DIG_VERSION</span>
          </div>
        </div>

        <div class="divider"></div>

        <template is="dom-if" if="[[showAdvancedSearch]]">
          <div class="layout horizontal pointer" title="Toggle Advanced Search" on-tap="advancedSearchToggle">
            <iron-icon class="checkbox" icon$="{{checkboxToShow(advancedSearch)}}"></iron-icon>
            <span class="text">Advanced Search</span>
          </div>
        </template>

        <div class="layout horizontal pointer" title="Toggle Blur Images" on-tap="blurToggle">
          <iron-icon class="checkbox" icon$="{{checkboxToShow(blurImages)}}"></iron-icon>
          <span class="text">Blur Images</span>
        </div>
      </paper-material>
    </paper-dialog>
  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'user-settings',

      properties: {
        username: {
          type: String,
          notify: true,
          observer: 'usernameObserver'
        },
        showAdvancedSearch: {
          type: Boolean,
          value: false
        },
        advancedSearch: {
          type: Boolean,
          value: false,
          notify: true
        },
        blurImages: {
          type: Boolean,
          value: true,
          notify: true
        }
      },
      ready: function() {
        if(sessionStorage.getItem('advancedSearch')) {
          this.advancedSearch = sessionStorage.getItem('advancedSearch') === 'true' ? true : false;
        }
        if(sessionStorage.getItem('blurImages')) {
          this.blurImages = sessionStorage.getItem('blurImages') === 'true' ? true : false;
        }
      },
      advancedSearchToggle: function() {
        this.advancedSearch = !this.advancedSearch;
        sessionStorage.setItem('advancedSearch', this.advancedSearch);
      },
      blurToggle: function() {
        this.blurImages = !this.blurImages;
        sessionStorage.setItem('blurImages', this.blurImages);
      },
      open: function() {
        this.$.settings.open();
      },
      checkboxToShow: function(setting) {
        return setting ? 'check-box' : 'check-box-outline-blank';
      },
      usernameObserver: function() {
        /* jshint ignore:start */
        ga('set', 'dimension1', window.btoa(this.username));
        ga('set', 'userId', window.btoa(this.username));
        ga('send', 'pageview');
        /* jshint ignore:end */
      }
    });
  })();
  </script>
</dom-module>
