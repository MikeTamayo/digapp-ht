<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel='import' href='../mustache.html'>

<script>
(function() {
  'use strict';
  Polymer({
    is: 'query-builder',

    properties: {
      /**
       * The elastic search query which this element builds
       */
      query: {
        type: Object,
        notify: true,
        readOnly: true
      },

      /**
       * The query template object passed in from the config.
       */
      queryTemplate: {
        type: Object,
        notify: true
      },

      /**
       * Application scope javascript object which contains query templates
       * and other configuration data
       */ 
      appConfig: {
        type: Object
      }
    },
    observers: [
      'waitForQueryTemplate(queryTemplate)'
    ],

    /**
     * Get query string parameters and then build the query based on the queryTemplate
     */
    waitForQueryTemplate: function() {
      app.getURLParams();
      this.buildElasticQuery();
    },

    /**
     * Build a query from query string parameters and a query template
     */
    buildElasticQuery: function() {
      /* globals Mustache */
      var view = {
        field: app.params.field,
        value: app.params.value
      };

      var query = JSON.parse(Mustache.render(JSON.stringify(this.queryTemplate), view));

      this._setQuery(query);
    }

  });
})();
</script>
