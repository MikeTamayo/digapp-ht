<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="highlighted-text">
  <template>
    <style>
      :host {
        display: block;
      }

      .highlight {
        background-color: var(--highlighted-text-color, yellow);
      }
    </style>

    <template is="dom-repeat" items="[[_spans]]">
      <span id$="[[_getId(index)]]" class$="[[item.styleClass]]">[[item.text]]</span>
    </template>
  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'highlighted-text',

      properties: {
        /**
         * The tags (without punctuation) surrounding the words to highlight in the text.  For example, if the text is '<tag>Text</tag>' then set the tags to 'tag'.
         */
        tags: {
          type: String,
          value: 'highlight'
        },

        /**
         * The text containing words to highlight.
         */
        text: {
          type: String
        },

        /**
         * The spans to show generated by this component from the given tags and text.
         */
        _spans: {
          type: Array,
          value: function() {
            return [];
          }
        }
      },

      observers: [
        '_updateSpans(tags, text)'
      ],

      /**
       * Finds and returns spans of the given text by searching for the given start and end tags.
       */
      _findSpans: function(startTag, endTag, text) {
        var spans = [];

        var startIndex = text.indexOf(startTag);
        var endIndex = text.indexOf(endTag);

        if(startIndex >= 0 && endIndex >= 0) {
          if(startIndex > 0) {
            spans.push({
              text: text.substring(0, startIndex),
              styleClass: ''
            });
          }
          spans.push({
            text: text.substring(startIndex + startTag.length, endIndex),
            styleClass: 'highlight'
          });
          return spans.concat(this._findSpans(startTag, endTag, text.substring(endIndex + endTag.length)));
        }

        return [{
          text: text,
          styleClass: ''
        }];
      },

      /**
       * Returns the ID for the span at the given index.
       */
      _getId: function(index) {
        return 'span' + index;
      },

      /**
       * Updates the spans using the given tags and text.
       */
      _updateSpans: function(tags, text) {
        var startTag = '<' + tags + '>';
        var endTag = '</' + tags + '>';
        var spans = this._findSpans(startTag, endTag, text);
        this.set('_spans', spans);
      }
    });
  })();
  </script>
</dom-module>
