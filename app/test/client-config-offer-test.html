<!--
Copyright 2017 Next Century Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>client-config</title>
  <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../bower_components/web-component-tester/browser.js"></script>
  <script src="data/offer-result.js" type="text/javascript"></script>
  <script src="data/offer-aggregations.js" type="text/javascript"></script>
  <script src="data/people-aggregations.js" type="text/javascript"></script>
  <link rel="import" href="../elements/client-config/client-config.html">
</head>

<body>
<test-fixture id="client-config-fixture">
  <template>
    <client-config></client-config>
  </template>
</test-fixture>

<script>
  'use strict';
  /* globals suite, test, expect, setup, fixture, offerResult, offerAgg, peopleAgg, assert */
  /* jshint -W030 */
  suite('<client-config> offer tests', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with offer transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.offer).to.be.a('Function');
    });

    test('defines offer', function() {
      var output = clientConfig.config.transforms.offer.offer(offerResult);
      assert.equal(output.id, 'http://dig.isi.edu/ht/data/offer/9E47C0AFA1C00617F6AF1E5DB9D35F8A3F2BE658830653E51AB7CC38C5C9F954');
      assert.equal(output.type, 'offer');
      assert.equal(output.icon, 'maps:local-offer');
      assert.equal(output.link, '/offer.html?value=http://dig.isi.edu/ht/data/offer/9E47C0AFA1C00617F6AF1E5DB9D35F8A3F2BE658830653E51AB7CC38C5C9F954&field=_id');
      assert.equal(output.styleClass, 'entity-offer-font');
      assert.equal(output.url, 'http://google.com');
      assert.equal(output.name, 'This is the title');
      assert.equal(output.date, 'Oct 17, 2015');
      assert.equal(output.publisher, 'google.com');
      assert.equal(output.description, 'This is the description.');
      assert.equal(output.location, 'West Palm Beach, Florida, United States');
    });

    test('defines image array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(offerResult);
      assert.deepEqual(output.images, [{
        id: 'http://dig.isi.edu/ht/data/0501F8D47865203415090787585F27A8E738FDC8',
        icon: 'image:photo',
        link: '/image.html?value=http://dig.isi.edu/ht/data/0501F8D47865203415090787585F27A8E738FDC8&field=_id',
        source: 'http://url1',
        styleClass: 'entity-image-font',
      }, {
        id: 'http://dig.isi.edu/ht/data/5C88F2ADC78DDFC173023B04CF0AD9508CD7E88F',
        icon: 'image:photo',
        link: '/image.html?value=http://dig.isi.edu/ht/data/5C88F2ADC78DDFC173023B04CF0AD9508CD7E88F&field=_id',
        source: 'http://url2',
        styleClass: 'entity-image-font',
      }]);
    });

    test('defines location array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(offerResult);
      assert.deepEqual(output.locations, [{
        key: 'West Palm Beach:Florida:United States:-80.05337:26.71534',
        latitude: '26.71534',
        longitude: '-80.05337',
        icon: 'communication:location-on',
        styleClass: 'entity-location-font',
        text: 'West Palm Beach, Florida, United States',
        type: 'location'
      }]);
    });

    test('defines person in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(offerResult);
      assert.deepEqual(output.person, {
        id: 'http://dig.isi.edu/ht/data/adultservice/04683C829AF807EC2E2E634FC9F7352FE1CB071C',
        names: [],
        ages: ['24'],
        ethnicities: ['indian'],
        hairColors: [],
        eyeColors: [],
        heights: ['157'],
        weights: ['49'],
        icon: 'icons:account-circle',
        link: '/provider.html?value=http://dig.isi.edu/ht/data/adultservice/04683C829AF807EC2E2E634FC9F7352FE1CB071C&field=_id',
        name: '24, indian',
        styleClass: 'entity-provider-font',
        type: 'provider'
      });
    });

    test('defines price array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(offerResult);
      assert.deepEqual(output.prices, [{
        icon: 'editor:attach-money',
        styleClass: 'entity-money-font',
        text: '300-per-60min',
        type: 'money'
      }, {
        icon: 'editor:attach-money',
        styleClass: 'entity-money-font',
        text: '400-per-60min',
        type: 'money'
      }]);
    });

    test('defines phone array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(offerResult);
      assert.deepEqual(output.phones, [{
        id: 'http://dig.isi.edu/ht/data/phone/1-1234567890',
        type: 'phone',
        text: '123-456-7890',
        link: '/phone.html?value=http://dig.isi.edu/ht/data/phone/1-1234567890&field=_id',
        icon: 'communication:phone',
        styleClass: 'entity-phone-font'
      }]);
    });

    test('defines email array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(offerResult);
      assert.deepEqual(output.emails, [{
        id: 'http://dig.isi.edu/ht/data/email/abc%40xyz.com',
        type: 'email',
        text: 'abc@xyz.com',
        link: '/email.html?value=http://dig.isi.edu/ht/data/email/abc%40xyz.com&field=_id',
        icon: 'communication:email',
        styleClass: 'entity-email-font'
      }]);
    });

    test('defines webpage array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(offerResult);
      assert.deepEqual(output.webpages, [{
        id: 'http://dig.isi.edu/ht/data/webpage/9E47C0AFA1C00617F6AF1E5DB9D35F8A3F2BE658830653E51AB7CC38C5C9F954',
        icon: 'av:web',
        link: 'http://google.com',
        styleClass: 'entity-webpage-font',
        text: 'http://google.com',
        type: 'webpage'
      }]);
    });

    test('defines cache array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(offerResult);
      assert.deepEqual(output.caches, [{
        id: '9E47C0AFA1C00617F6AF1E5DB9D35F8A3F2BE658830653E51AB7CC38C5C9F954',
        icon: 'icons:cached',
        link: '/cache.html?value=9E47C0AFA1C00617F6AF1E5DB9D35F8A3F2BE658830653E51AB7CC38C5C9F954&field=_id',
        styleClass: 'entity-cache-font',
        text: 'Open Cached Webpage',
        type: 'cache'
      }]);
    });

    test('defines locationDescriptor in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(offerResult);
      assert.deepEqual(output.locationDescriptor, {
        icon: 'communication:location-on',
        styleClass: 'entity-location-font',
        text: 'West Palm Beach, Florida, United States',
        link: '/location.html?value=West Palm Beach:Florida:United States:-80.05337:26.71534&field=availableAtOrFrom.address.key',
        type: 'location'
      });
    });

    test('defines descriptors in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(offerResult);
      assert.deepEqual(output.descriptors, [{
        icon: 'icons:date-range',
        styleClass: 'entity-date-font',
        text: 'Oct 17, 2015',
        type: 'date'
      }, {
        icon: 'av:web',
        styleClass: 'entity-webpage-font',
        text: 'google.com',
        type: 'webpage'
      }]);
    });

    test('defines details in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(offerResult);
      assert.deepEqual(output.details, [{
        name: 'Url',
        link: 'http://google.com',
        text: 'http://google.com'
      }, {
        name: 'Description',
        text: 'This is the description.'
      }, {
        name: 'Cached Webpage',
        link: '/cache.html?value=9E47C0AFA1C00617F6AF1E5DB9D35F8A3F2BE658830653E51AB7CC38C5C9F954&field=_id',
        text: 'Open'
      }]);
    });
  });

  suite('<client-config> offer tests if offer result does not have data', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines offer', function() {
      var output = clientConfig.config.transforms.offer.offer({hits: {hits: [{_id: '1', _source: {itemOffered: {uri: 'person'}}}]}});
      assert.equal(output.id, '1');
      assert.equal(output.type, 'offer');
      assert.equal(output.icon, 'maps:local-offer');
      assert.equal(output.link, '/offer.html?value=1&field=_id');
      assert.equal(output.styleClass, 'entity-offer-font');
      assert.equal(output.name, 'No Title');
      assert.equal(output.date, 'No Date');
      assert.equal(output.publisher, 'No Publisher');
      assert.equal(output.description, 'No Description');
      assert.equal(output.location, 'No Location');
      assert.deepEqual(output.images, []);
      assert.deepEqual(output.locations, []);
      assert.deepEqual(output.prices, []);
      assert.deepEqual(output.phones, []);
      assert.deepEqual(output.emails, []);
      assert.deepEqual(output.webpages, []);
      assert.deepEqual(output.caches, []);
    });

    test('defines person in offer', function() {
      var output = clientConfig.config.transforms.offer.offer({hits: {hits: [{_id: '1', _source: {itemOffered: {uri: 'person'}}}]}});
      assert.deepEqual(output.person, {
        id: 'person',
        names: [],
        ages: [],
        ethnicities: [],
        hairColors: [],
        eyeColors: [],
        heights: [],
        weights: [],
        icon: 'icons:account-circle',
        link: '/provider.html?value=person&field=_id',
        name: 'Unknown Provider',
        styleClass: 'entity-provider-font',
        type: 'provider'
      });
    });

    test('defines locationDescriptor in offer', function() {
      var output = clientConfig.config.transforms.offer.offer({hits: {hits: [{_id: '1', _source: {itemOffered: {uri: 'person'}}}]}});
      assert.deepEqual(output.locationDescriptor, {
        icon: 'communication:location-on',
        styleClass: 'entity-location-font',
        text: 'No Location',
        type: 'location',
        link: undefined
      });
    });

    test('defines descriptors in offer', function() {
      var output = clientConfig.config.transforms.offer.offer({hits: {hits: [{_id: '1', _source: {itemOffered: {uri: 'person'}}}]}});
      assert.deepEqual(output.descriptors, [{
        icon: 'icons:date-range',
        styleClass: 'entity-date-font',
        text: 'No Date',
        type: 'date'
      }, {
        icon: 'av:web',
        styleClass: 'entity-webpage-font',
        text: 'No Publisher',
        type: 'webpage'
      }]);
    });

    test('defines details in offer', function() {
      var output = clientConfig.config.transforms.offer.offer({hits: {hits: [{_id: '1', _source: {itemOffered: {uri: 'person'}}}]}});
      assert.deepEqual(output.details, [{
        name: 'Url',
        link: null,
        text: 'Unavailable'
      }, {
        name: 'Description',
        text: 'No Description'
      }, {
        name: 'Cached Webpage',
        link: null,
        text: 'Unavailable'
      }]);
    });
  });

  suite('<client-config> offer tests if no results from query', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines empty offer for empty data', function() {
      var output = clientConfig.config.transforms.offer.offer({
        hits: {
          hits: []
        }
      });
      assert.deepEqual(output, {});
    });

    test('defines empty offer for data with no id', function() {
      var output = clientConfig.config.transforms.offer.offer({
        hits: {
          hits: [{}]
        }
      });
      assert.deepEqual(output, {});
    });
  });

  suite('<client-config> offer tests for event drops timeline data', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with gatherEventDropsTimelineData transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.gatherEventDropsTimelineData).to.be.a('Function');
    });

    test('drops timeline function given empty input returns empty output', function() {
      var output = clientConfig.config.transforms.offer.gatherEventDropsTimelineData({
        aggregations: {
          locations: {
            locations: {
              buckets: []
            }
          }
        }
      });
      expect(output).to.deep.equal({
        data: [],
        timestamps: []
      });
    });

    test('drops timeline function given offer aggregations returns correct data', function() {
      var output = clientConfig.config.transforms.offer.gatherEventDropsTimelineData(offerAgg);
      expect(output.data).to.be.an('Array');
      expect(output.data.length).to.equal(2);
      expect(output.data[0].name).to.equal('Brooklyn, New York');
      expect(output.data[0].dates).to.be.an('Array');
      expect(output.data[0].dates.length).to.equal(3);
      expect(output.data[0].dates[0].date).to.be.a('Date');
      expect(output.data[0].dates[0].date.getTime()).to.equal(1444435200000);
      expect(output.data[0].dates[0].count).to.equal(1);
      expect(output.data[0].dates[0].name).to.equal('Brooklyn, New York');
      expect(output.data[0].dates[1].date).to.be.a('Date');
      expect(output.data[0].dates[1].date.getTime()).to.equal(1444521600000);
      expect(output.data[0].dates[1].count).to.equal(2);
      expect(output.data[0].dates[1].name).to.equal('Brooklyn, New York');
      expect(output.data[0].dates[2].date).to.be.a('Date');
      expect(output.data[0].dates[2].date.getTime()).to.equal(1444608000000);
      expect(output.data[0].dates[2].count).to.equal(1);
      expect(output.data[0].dates[2].name).to.equal('Brooklyn, New York');
      expect(output.data[1].name).to.equal('Mumbai');
      expect(output.data[1].dates).to.be.an('Array');
      expect(output.data[1].dates.length).to.equal(1);
      expect(output.data[1].dates[0].date).to.be.a('Date');
      expect(output.data[1].dates[0].date.getTime()).to.equal(1444608000000);
      expect(output.data[1].dates[0].count).to.equal(2);
      expect(output.data[1].dates[0].name).to.equal('Mumbai');
    });

    test('drops timeline function given offer aggregations returns correct timestamps', function() {
      var output = clientConfig.config.transforms.offer.gatherEventDropsTimelineData(offerAgg);
      expect(output.timestamps).to.deep.equal([1444608000000, 1444521600000, 1444435200000, 1444608000000]);
    });
  });

  suite('<client-config> offer tests for offer phones', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with offer phones transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.offerPhones).to.be.a('Function');
    });

    test('offer phones function given empty input returns correct array', function() {
      var output = clientConfig.config.transforms.offer.offerPhones({}, '');
      expect(output.title).to.deep.equal('No Telephone Numbers');
      expect(output.phone).to.deep.equal([]);
    });

    test('offer phones function given phone array returns correct sorted array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = clientConfig.config.transforms.offer.offerPhones({
        aggregations: {
          phone: {
            phone: {
              buckets: [{
                doc_count: 10,
                key: 'http://1-9876543210',
              }, {
                doc_count: 1,
                key: 'http://1234567890',
              }]
            }
          }
        }
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.title).to.equal('2 Telephone Numbers');
      expect(output.phone).to.deep.equal([{
        id: 'http://1-9876543210',
        count: 10,
        max: 10,
        link: '/phone.html?value=http://1-9876543210&field=_id',
        styleClass: 'entity-phone-font',
        text: '987-654-3210'
      }, {
        id: 'http://1234567890',
        count: 1,
        max: 10,
        link: '/phone.html?value=http://1234567890&field=_id',
        styleClass: 'entity-phone-font',
        text: '123-456-7890'
      }]);
    });

    test('offer phones function given phone array and ID to ignore returns correct sorted array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = clientConfig.config.transforms.offer.offerPhones({
        aggregations: {
          phone: {
            phone: {
              buckets: [{
                doc_count: 10,
                key: 'http://1-9876543210',
              }, {
                doc_count: 1,
                key: 'http://1234567890',
              }]
            }
          }
        }
      }, 'http://1-9876543210');
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.title).to.equal('1 Other Telephone Number');
      expect(output.phone).to.deep.equal([{
        id: 'http://1234567890',
        count: 1,
        max: 1,
        link: '/phone.html?value=http://1234567890&field=_id',
        styleClass: 'entity-phone-font',
        text: '123-456-7890'
      }]);
    });
  });

  suite('<client-config> offer tests for offer emails', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with offer emails transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.offerEmails).to.be.a('Function');
    });

    test('offer emails function given empty input returns correct array', function() {
      var output = clientConfig.config.transforms.offer.offerEmails({}, '');
      expect(output.title).to.deep.equal('No Email Addresses');
      expect(output.email).to.deep.equal([]);
    });

    test('offer emails function given email array returns correct array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = clientConfig.config.transforms.offer.offerEmails({
        aggregations: {
          email: {
            email: {
              buckets: [{
                doc_count: 25,
                key: 'http://email%40address.com'
              }, {
                doc_count: 5,
                key: 'http://email%40address2.com'
              }]
            }
          }
        }
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.title).to.equal('2 Email Addresses');
      expect(output.email).to.deep.equal([{
        id: 'http://email%40address.com',
        count: 25,
        max: 25,
        link: '/email.html?value=http://email%40address.com&field=_id',
        styleClass: 'entity-email-font',
        text: 'email@address.com'
      }, {
        id: 'http://email%40address2.com',
        count: 5,
        max: 25,
        link: '/email.html?value=http://email%40address2.com&field=_id',
        styleClass: 'entity-email-font',
        text: 'email@address2.com'
      }]);
    });

    test('offer emails function given email array and ID to ignore returns correct sorted array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = clientConfig.config.transforms.offer.offerEmails({
        aggregations: {
          email: {
            email: {
              buckets: [{
                doc_count: 25,
                key: 'http://email%40address.com'
              }, {
                doc_count: 5,
                key: 'http://email%40address2.com'
              }]
            }
          }
        }
      }, 'http://email%40address.com');
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.title).to.equal('1 Other Email Address');
      expect(output.email).to.deep.equal([{
        id: 'http://email%40address2.com',
        count: 5,
        max: 5,
        link: '/email.html?value=http://email%40address2.com&field=_id',
        styleClass: 'entity-email-font',
        text: 'email@address2.com'
      }]);
    });
  });

  suite('<client-config> offer tests: removeNoteFromLocationTimeline transform', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with remove note transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.removeNoteFromLocationTimeline).to.be.a('Function');
    });

    test('results are correct for single removal', function() {
      var output = clientConfig.config.transforms.offer.removeNoteFromLocationTimeline('id1', [{
        locations: [{
          notes: [{
            name: 'Things',
            data: [{
              id: 'id1'
            }, {
              id: 'id2'
            }]
          }]
        }]
      }]);

      expect(output).to.exist;
      expect(output).to.be.an('Array');
      expect(output).to.deep.equal([{
        locations: [{
          notes: [{
            name: 'Other Things',
            data: [{
              id: 'id2'
            }]
          }]
        }]
      }]);
    });

    test('results are correct for single removal causing note removal', function() {
      var output = clientConfig.config.transforms.offer.removeNoteFromLocationTimeline('id1', [{
        locations: [{
          notes: [{
            name: 'Things',
            data: [{
              id: 'id1'
            }]
          }]
        }]
      }]);

      expect(output).to.exist;
      expect(output).to.be.an('Array');
      expect(output).to.deep.equal([{
        locations: [{
          notes: []
        }]
      }]);
    });

    test('results are correct for multiple removals', function() {
      var output = clientConfig.config.transforms.offer.removeNoteFromLocationTimeline('id1', [{
        locations: [{
          notes: [{
            name: 'Things1',
            data: [{
              id: 'id1'
            }, {
              id: 'id2'
            }]
          }]
        }, {
          notes: [{
            name: 'Things2',
            data: [{
              id: 'id1'
            }, {
              id: 'id2'
            }]
          }, {
            name: 'Things3',
            data: [{
              id: 'id1'
            }, {
              id: 'id2'
            }]
          }]
        }]
      }, {
        locations: [{
          notes: [{
            name: 'Things4',
            data: [{
              id: 'id1'
            }, {
              id: 'id2'
            }]
          }]
        }]
      }]);

      expect(output).to.exist;
      expect(output).to.be.an('Array');
      expect(output).to.deep.equal([{
        locations: [{
          notes: [{
            name: 'Other Things1',
            data: [{
              id: 'id2'
            }]
          }]
        }, {
          notes: [{
            name: 'Other Things2',
            data: [{
              id: 'id2'
            }]
          }, {
            name: 'Other Things3',
            data: [{
              id: 'id2'
            }]
          }]
        }]
      }, {
        locations: [{
          notes: [{
            name: 'Other Things4',
            data: [{
              id: 'id2'
            }]
          }]
        }]
      }]);
    });

    test('results are correct for unknown item', function() {
      var output = clientConfig.config.transforms.offer.removeNoteFromLocationTimeline('id2', [{
        locations: [{
          notes: [{
            data: [{
              id: 'id1'
            }]
          }]
        }]
      }]);

      expect(output).to.exist;
      expect(output).to.be.an('Array');
      expect(output).to.deep.equal([{
        locations: [{
          notes: [{
            data: [{
              id: 'id1'
            }]
          }]
        }]
      }]);
    });

    test('results are correct for empty array', function() {
      var output = clientConfig.config.transforms.offer.removeNoteFromLocationTimeline('id1', []);

      expect(output).to.exist;
      expect(output).to.be.an('Array');
      expect(output).to.deep.equal([]);
    });
  });

  suite('<client-config> offer tests: transform for offer publishers', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with offer publishers transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.offerPublishers).to.be.a('Function');
    });

    test('defines offer publishers for offer aggregation buckets', function() {
      var output = clientConfig.config.transforms.offer.offerPublishers(offerAgg);
      assert.equal(output.title, '4 Websites');
      assert.deepEqual(output.publisher, [{
        id: 'google.com',
        count: 84,
        styleClass: 'entity-webpage-font'
      }, {
        id: 'bing.com',
        count: 10,
        styleClass: 'entity-webpage-font'
      }, {
        id: 'yahoo.com',
        count: 5,
        styleClass: 'entity-webpage-font'
      }, {
        id: 'aol.com',
        count: 1,
        styleClass: 'entity-webpage-font'
      }]);
    });
  });

  suite('<client-config> offer tests: transform for offer locations', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with offer locations transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.offerLocations).to.be.a('Function');
    });

    test('defines offer locations for offer aggregation buckets', function() {
      var output = clientConfig.config.transforms.offer.offerLocations(offerAgg);
      assert.equal(output.title, '6 Locations');
      assert.deepEqual(output.location, [{
        key: 'Atlanta:Georgia:United States:-84.38798:33.749',
        count: 45,
        longitude: '-84.38798',
        latitude: '33.749',
        name: 'Atlanta, Georgia',
        longName: 'Atlanta, Georgia, United States (45)',
        link: '/location.html?value=Atlanta:Georgia:United States:-84.38798:33.749&field=availableAtOrFrom.address.key',
        styleClass: 'entity-location-font'
      }, {
        key: 'Brooklyn:New York:United States:-73.94958:40.6501',
        count: 44,
        longitude: '-73.94958',
        latitude: '40.6501',
        name: 'Brooklyn, New York',
        longName: 'Brooklyn, New York, United States (44)',
        link: '/location.html?value=Brooklyn:New York:United States:-73.94958:40.6501&field=availableAtOrFrom.address.key',
        styleClass: 'entity-location-font'
      }, {
        key: 'Houston:Texas:United States:-95.36327:29.76328',
        count: 1,
        longitude: '-95.36327',
        latitude: '29.76328',
        name: 'Houston, Texas',
        longName: 'Houston, Texas, United States (1)',
        link: '/location.html?value=Houston:Texas:United States:-95.36327:29.76328&field=availableAtOrFrom.address.key',
        styleClass: 'entity-location-font'
      }, {
        key: 'Lubbock:Texas:United States:-101.85517:33.57786',
        count: 1,
        longitude: '-101.85517',
        latitude: '33.57786',
        name: 'Lubbock, Texas',
        longName: 'Lubbock, Texas, United States (1)',
        link: '/location.html?value=Lubbock:Texas:United States:-101.85517:33.57786&field=availableAtOrFrom.address.key',
        styleClass: 'entity-location-font'
      }, {
        key: 'Mansfield:Ohio:United States:-82.51545:40.75839',
        count: 1,
        longitude: '-82.51545',
        latitude: '40.75839',
        name: 'Mansfield, Ohio',
        longName: 'Mansfield, Ohio, United States (1)',
        link: '/location.html?value=Mansfield:Ohio:United States:-82.51545:40.75839&field=availableAtOrFrom.address.key',
        styleClass: 'entity-location-font'
      }, {
        key: 'Tri-Cities:Washington:United States:-119.19617:46.2454',
        count: 1,
        longitude: '-119.19617',
        latitude: '46.2454',
        name: 'Tri-Cities, Washington',
        longName: 'Tri-Cities, Washington, United States (1)',
        link: '/location.html?value=Tri-Cities:Washington:United States:-119.19617:46.2454&field=availableAtOrFrom.address.key',
        styleClass: 'entity-location-font'
      }]);
    });
  });

  suite('<client-config> offer tests: transform for similar offer locations', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with similar locations transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.similarLocations).to.be.a('Function');
    });

    test('defines locations for similar location aggregation buckets', function() {
      var output = clientConfig.config.transforms.offer.similarLocations('Atlanta:Georgia:United States:-84.38798:33.749', offerAgg);
      assert.equal(output.similarLocations.length, 5);
      assert.equal(output.similarLocations[0].key, 'Brooklyn:New York:United States:-73.94958:40.6501');
      assert.equal(output.similarLocations[0].count, 44);
      assert.equal(output.similarLocations[0].longitude, '-73.94958');
      assert.equal(output.similarLocations[0].latitude, '40.6501');
      assert.equal(output.similarLocations[0].name, 'Brooklyn, New York');
      assert.equal(output.similarLocations[0].longName, 'Brooklyn, New York, United States (44)');
      assert.equal(output.similarLocations[0].link, '/location.html?value=Brooklyn:New York:United States:-73.94958:40.6501&field=availableAtOrFrom.address.key');
    });
  });

  suite('<client-config> offer tests: transform for the location page map data', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with map locations transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.locationPageMap).to.be.a('Function');
    });

    test('defines locations for map location aggregation buckets', function() {
      var output = clientConfig.config.transforms.offer.locationPageMap({
        key: 'Atlanta:Georgia:United States:-84.38798:33.749',
        count: 45,
        longitude: '-84.38798',
        latitude: '33.749',
        name: 'Atlanta, Georgia',
        longName: 'Atlanta, Georgia, United States (45)',
        link: '/location.html?value=Atlanta:Georgia:United States:-84.38798:33.749&field=availableAtOrFrom.address.key'
      }, offerAgg);
      assert.equal(output.mapLocations.length, 6);
      assert.equal(output.mapLocations[0].key, 'Atlanta:Georgia:United States:-84.38798:33.749');
      assert.equal(output.mapLocations[0].count, 45);
      assert.equal(output.mapLocations[0].longitude, '-84.38798');
      assert.equal(output.mapLocations[0].latitude, '33.749');
      assert.equal(output.mapLocations[0].name, 'Atlanta, Georgia');
      assert.equal(output.mapLocations[0].longName, 'Atlanta, Georgia, United States (45)');
      assert.equal(output.mapLocations[0].link, '/location.html?value=Atlanta:Georgia:United States:-84.38798:33.749&field=availableAtOrFrom.address.key');
      assert.equal(output.mapLocations[0].iconId, 'mainLocation');
      assert.equal(output.mapLocations[1].key, 'Brooklyn:New York:United States:-73.94958:40.6501');
      assert.equal(output.mapLocations[1].count, 44);
      assert.equal(output.mapLocations[1].longitude, '-73.94958');
      assert.equal(output.mapLocations[1].latitude, '40.6501');
      assert.equal(output.mapLocations[1].name, 'Brooklyn, New York');
      assert.equal(output.mapLocations[1].longName, 'Brooklyn, New York, United States (44)');
      assert.equal(output.mapLocations[1].link, '/location.html?value=Brooklyn:New York:United States:-73.94958:40.6501&field=availableAtOrFrom.address.key');
      assert.equal(output.mapLocations[1].iconId, undefined);
    });

    test('if the first location argument is not yet defined, transform returns undefined', function() {
      var output = clientConfig.config.transforms.offer.locationPageMap(undefined, offerAgg);
      assert.equal(output.mapLocations, undefined);
    });

    test('if aggregation argument is not yet defined, transform returns undefined', function() {
      var output = clientConfig.config.transforms.offer.locationPageMap({
        key: 'Atlanta:Georgia:United States:-84.38798:33.749',
        count: 45,
        longitude: '-84.38798',
        latitude: '33.749',
        name: 'Atlanta, Georgia',
        longName: 'Atlanta, Georgia, United States (45)',
        link: '/location.html?value=Atlanta:Georgia:United States:-84.38798:33.749&field=availableAtOrFrom.address.key'
      }, undefined);
      assert.equal(output.mapLocations, undefined);
    });
  });

  suite('<client-config> offer tests: transform for people features', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with people features transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.peopleFeaturesName).to.be.a('Function');
    });

    test('defines name', function() {
      var output = clientConfig.config.transforms.offer.peopleFeaturesName(peopleAgg);
      expect(output).to.exist;
      expect(output.name).to.deep.equal([{
        key: 'Jan',
        count: 5000,
        styleClass: 'entity-provider-font'
      }, {
        key: 'Lily',
        count: 4055,
        styleClass: 'entity-provider-font'
      }, {
        key: 'Bella',
        count: 3152,
        styleClass: 'entity-provider-font'
      }, {
        key: 'Tina',
        count: 2902,
        styleClass: 'entity-provider-font'
      }, {
        key: 'Ashley',
        count: 2774,
        styleClass: 'entity-provider-font'
      }, {
        key: 'Nikki',
        count: 2724,
        styleClass: 'entity-provider-font'
      }, {
        key: 'Angel',
        count: 2656,
        styleClass: 'entity-provider-font'
      }, {
        key: 'Rebecca',
        count: 2648,
        styleClass: 'entity-provider-font'
      }, {
        key: 'Candy',
        count: 2616,
        styleClass: 'entity-provider-font'
      }, {
        key: 'Lexi',
        count: 2616,
        styleClass: 'entity-provider-font'
      }]);
    });
  });

  suite('<client-config> offer tests: transform for location timeline (itinerary)', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with location timeline transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.locationTimeline).to.be.a('Function');
    });

    test('returns array sorted by date', function() {
      var output = clientConfig.config.transforms.offer.locationTimeline(offerAgg);
      assert.isArray(output.dates);
      assert.equal(output.dates.length, 10);
      assert.equal(output.dates[0].subtitle, 'Atlanta, Georgia (1); Brooklyn, New York (1)');
      assert.equal(output.dates[0].date, 'Oct 20, 2015');
      assert.equal(output.dates[0].icon, 'icons:date-range');
      assert.equal(output.dates[0].styleClass, 'entity-date-font');

      assert.isBelow(new Date(output.dates[0].date).getTime(), new Date(output.dates[1].date).getTime());
      assert.isBelow(new Date(output.dates[0].date).getTime(), new Date(output.dates[9].date).getTime());
      assert.isBelow(new Date(output.dates[1].date).getTime(), new Date(output.dates[9].date).getTime());
      assert.isBelow(new Date(output.dates[2].date).getTime(), new Date(output.dates[9].date).getTime());
      assert.isBelow(new Date(output.dates[3].date).getTime(), new Date(output.dates[9].date).getTime());
      assert.isBelow(new Date(output.dates[4].date).getTime(), new Date(output.dates[9].date).getTime());
      assert.isBelow(new Date(output.dates[5].date).getTime(), new Date(output.dates[9].date).getTime());
      assert.isBelow(new Date(output.dates[6].date).getTime(), new Date(output.dates[9].date).getTime());
      assert.isBelow(new Date(output.dates[7].date).getTime(), new Date(output.dates[9].date).getTime());
      assert.isBelow(new Date(output.dates[8].date).getTime(), new Date(output.dates[9].date).getTime());

      assert.isArray(output.dates[0].locations);
      assert.equal(output.dates[0].locations.length, 2);
      assert.equal(output.dates[0].locations[0].link, '/location.html?value=Atlanta:Georgia:United States:-84.38798:33.749&field=availableAtOrFrom.address.key');
      assert.equal(output.dates[0].locations[0].icon, 'communication:location-on');
      assert.equal(output.dates[0].locations[0].name, 'Atlanta, Georgia, United States');
      assert.equal(output.dates[0].locations[0].type, 'location');
      assert.equal(output.dates[0].locations[0].styleClass, 'entity-location-font');
      assert.equal(output.dates[0].locations[0].count, 1);
      assert.isArray(output.dates[0].locations[0].notes);
      assert.equal(output.dates[0].locations[0].notes.length, 3);
      assert.equal(output.dates[0].locations[0].notes[0].name, 'Websites');
      assert.deepEqual(output.dates[0].locations[0].notes[0].data, [{
        icon: 'av:web',
        styleClass: 'entity-webpage-font',
        text: 'google.com',
        type: 'webpage'
      }]);
      assert.equal(output.dates[0].locations[0].notes[1].name, 'Telephone Numbers');
      assert.deepEqual(output.dates[0].locations[0].notes[1].data, [{
        id: 'http://dig.isi.edu/ht/data/phone/1-1112223333',
        icon: 'communication:phone',
        link: '/phone.html?value=http://dig.isi.edu/ht/data/phone/1-1112223333&field=_id',
        styleClass: 'entity-phone-font',
        text: '111-222-3333',
        type: 'phone'
      }]);
      assert.equal(output.dates[0].locations[0].notes[2].name, 'Email Addresses');
      assert.deepEqual(output.dates[0].locations[0].notes[2].data, [{
        id: 'http://dig.isi.edu/ht/data/email/abc%40xyz.com',
        icon: 'communication:email',
        link: '/email.html?value=http://dig.isi.edu/ht/data/email/abc%40xyz.com&field=_id',
        styleClass: 'entity-email-font',
        text: 'abc@xyz.com',
        type: 'email'
      }]);
      assert.equal(output.dates[0].locations[1].name, 'Brooklyn, New York, United States');
      assert.equal(output.dates[0].locations[1].link, '/location.html?value=Brooklyn:New York:United States:-73.94958:40.6501&field=availableAtOrFrom.address.key');
      assert.equal(output.dates[0].locations[1].type, 'location');
      assert.equal(output.dates[0].locations[1].count, 1);
      assert.isArray(output.dates[0].locations[1].notes);
      assert.equal(output.dates[0].locations[1].notes.length, 3);
    });

    test('returns array for dates with no locations', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = clientConfig.config.transforms.offer.locationTimeline({
        aggregations: {
          dates: {
            dates: {
              buckets: [{
                doc_count: 10,
                key: 1445299200000,
                locations: {
                  buckets: []
                }
              }]
            }
          }
        }
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      assert.isArray(output.dates);
      assert.equal(output.dates.length, 1);
      assert.equal(output.dates[0].subtitle, 'Unknown Locations (10)');
      assert.equal(output.dates[0].date, 'Oct 20, 2015');
      assert.isArray(output.dates[0].locations);
      assert.equal(output.dates[0].locations.length, 1);
      assert.equal(output.dates[0].locations[0].name, 'Unknown Location(s)');
      assert.equal(output.dates[0].locations[0].count, 10);
    });

    test('returns empty array for dates with no doc count', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = clientConfig.config.transforms.offer.locationTimeline({
        aggregations: {
          dates: {
            dates: {
              buckets: [{
                doc_count: 0,
                key: 1445299200000,
                locations: {
                  buckets: []
                }
              }]
            }
          }
        }
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      assert.isArray(output.dates);
      assert.equal(output.dates.length, 0);
    });
  });

  suite('<client-config> offer tests for CSV export data', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with CSV export data transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.createExportDataForCsv).to.be.a('Function');
    });

    test('CSV export data function given empty input returns correct array', function() {
      var output = clientConfig.config.transforms.offer.createExportDataForCsv([]);
      expect(output).to.be.an('Array');
      expect(output).to.deep.equal([['ad url', 'dig url', 'title', 'date', 'publisher', 'locations', 'telephone numbers', 'email addresses', 'images', 'description']]);
    });

    test('CSV export data function given results array returns correct array', function() {
      var output = clientConfig.config.transforms.offer.createExportDataForCsv([{
        url: 'url',
        link: 'link',
        name: 'title',
        date: 'today',
        publisher: 'website',
        locations: [{
          text: 'location'
        }],
        phones: [{
          text: 'phone'
        }],
        emails: [{
          text: 'email'
        }],
        images: [{
          source: 'image'
        }],
        description: 'A quick brown fox\njumped over the lazy dog.'
      }]);
      expect(output).to.be.an('Array');
      expect(output.length).to.equal(2);
      expect(output[0]).to.deep.equal(['ad url', 'dig url', 'title', 'date', 'publisher', 'locations', 'telephone numbers', 'email addresses', 'images', 'description']);
      expect(output[1][0]).to.equal('url');
      expect(output[1][1]).to.be.a('String');
      expect(output[1][2]).to.equal('title');
      expect(output[1][3]).to.equal('today');
      expect(output[1][4]).to.equal('website');
      expect(output[1][5]).to.equal('location');
      expect(output[1][6]).to.equal('phone');
      expect(output[1][7]).to.equal('email');
      expect(output[1][8]).to.equal('image');
      expect(output[1][9]).to.equal('A quick brown fox jumped over the lazy dog.');
    });

    test('CSV export data function given results array with multiple emails, images, locations, and phones returns correct array', function() {
      var output = clientConfig.config.transforms.offer.createExportDataForCsv([{
        url: 'url',
        link: 'link',
        name: 'title',
        date: 'today',
        publisher: 'website',
        locations: [{
          text: 'location1'
        }, {
          text: 'location2'
        }, {
          text: 'location3'
        }],
        phones: [{
          text: 'phone1'
        }, {
          text: 'phone2'
        }, {
          text: 'phone3'
        }],
        emails: [{
          text: 'email1'
        }, {
          text: 'email2'
        }, {
          text: 'email3'
        }],
        images: [{
          source: 'image1'
        }, {
          source: 'image2'
        }, {
          source: 'image3'
        }],
        description: 'description'
      }]);
      expect(output).to.be.an('Array');
      expect(output.length).to.equal(2);
      expect(output[0]).to.deep.equal(['ad url', 'dig url', 'title', 'date', 'publisher', 'locations', 'telephone numbers', 'email addresses', 'images', 'description']);
      expect(output[1][0]).to.equal('url');
      expect(output[1][1]).to.be.a('String');
      expect(output[1][2]).to.equal('title');
      expect(output[1][3]).to.equal('today');
      expect(output[1][4]).to.equal('website');
      expect(output[1][5]).to.equal('location1; location2; location3');
      expect(output[1][6]).to.equal('phone1; phone2; phone3');
      expect(output[1][7]).to.equal('email1; email2; email3');
      expect(output[1][8]).to.equal('image1; image2; image3');
      expect(output[1][9]).to.equal('description');
    });
  });

  suite('<client-config> offer tests for PDF export data', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with PDF export data transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.createExportDataForPdf).to.be.a('Function');
    });

    test('PDF export data function given empty input returns correct array', function() {
      var output = clientConfig.config.transforms.offer.createExportDataForPdf([]);
      expect(output).to.be.an('Array');
      expect(output).to.deep.equal([]);
    });

    test('PDF export data function given results array returns correct array', function() {
      var output = clientConfig.config.transforms.offer.createExportDataForPdf([{
        url: 'url',
        link: 'link',
        name: 'title',
        date: 'today',
        publisher: 'website',
        locations: [{
          text: 'location'
        }],
        phones: [{
          text: 'phone'
        }],
        emails: [{
          text: 'email'
        }],
        images: [{
          source: 'image'
        }],
        description: 'A quick brown fox\njumped over the lazy dog.'
      }]);
      expect(output).to.be.an('Array');
      expect(output.length).to.equal(1);
      expect(output[0].images).to.be.an('Array');
      expect(output[0].images.length).to.equal(1);
      expect(output[0].images).deep.equal([{
        id: 'image1',
        source: 'image',
        text: 'image'
      }]);
      expect(output[0].paragraphs).to.be.an('Array');
      expect(output[0].paragraphs.length).to.equal(8);
      expect(output[0].paragraphs[0]).to.deep.equal({
        big: true,
        label: 'title',
        value: ''
      });
      expect(output[0].paragraphs[1]).to.deep.equal({
        label: 'Posting Date:  ',
        value: 'today'
      });
      expect(output[0].paragraphs[2]).to.deep.equal({
        label: 'Location(s):  ',
        value: 'location'
      });
      expect(output[0].paragraphs[3]).to.deep.equal({
        label: 'Telephone Number(s):  ',
        value: 'phone'
      });
      expect(output[0].paragraphs[4]).to.deep.equal({
        label: 'Email Address(es):  ',
        value: 'email'
      });
      expect(output[0].paragraphs[5]).to.deep.equal({
        label: 'Description:  ',
        value: 'A quick brown fox jumped over the lazy dog.'
      });
      expect(output[0].paragraphs[6]).to.deep.equal({
        label: 'URL:  ',
        value: 'url'
      });
      expect(output[0].paragraphs[7]).to.be.an('Object');
      expect(output[0].paragraphs[7].label).to.equal('DIG URL:  ');
      expect(output[0].paragraphs[7].label).to.be.a('String');
    });

    test('PDF export data function given results array with multiple emails, images, locations, and phones returns correct array', function() {
      var output = clientConfig.config.transforms.offer.createExportDataForPdf([{
        url: 'url',
        link: 'link',
        name: 'title',
        date: 'today',
        publisher: 'website',
        locations: [{
          text: 'location1'
        }, {
          text: 'location2'
        }, {
          text: 'location3'
        }],
        phones: [{
          text: 'phone1'
        }, {
          text: 'phone2'
        }, {
          text: 'phone3'
        }],
        emails: [{
          text: 'email1'
        }, {
          text: 'email2'
        }, {
          text: 'email3'
        }],
        images: [{
          source: 'image1'
        }, {
          source: 'image2'
        }, {
          source: 'image3'
        }],
        description: 'description'
      }]);
      expect(output).to.be.an('Array');
      expect(output.length).to.equal(1);
      expect(output[0].images).to.be.an('Array');
      expect(output[0].images.length).to.equal(3);
      expect(output[0].images).deep.equal([{
        id: 'image1',
        source: 'image1',
        text: 'image1'
      }, {
        id: 'image2',
        source: 'image2',
        text: 'image2'
      }, {
        id: 'image3',
        source: 'image3',
        text: 'image3'
      }]);
      expect(output[0].paragraphs).to.be.an('Array');
      expect(output[0].paragraphs.length).to.equal(8);
      expect(output[0].paragraphs[0]).to.deep.equal({
        big: true,
        label: 'title',
        value: ''
      });
      expect(output[0].paragraphs[1]).to.deep.equal({
        label: 'Posting Date:  ',
        value: 'today'
      });
      expect(output[0].paragraphs[2]).to.deep.equal({
        label: 'Location(s):  ',
        value: 'location1, location2, location3'
      });
      expect(output[0].paragraphs[3]).to.deep.equal({
        label: 'Telephone Number(s):  ',
        value: 'phone1, phone2, phone3'
      });
      expect(output[0].paragraphs[4]).to.deep.equal({
        label: 'Email Address(es):  ',
        value: 'email1, email2, email3'
      });
      expect(output[0].paragraphs[5]).to.deep.equal({
        label: 'Description:  ',
        value: 'description'
      });
      expect(output[0].paragraphs[6]).to.deep.equal({
        label: 'URL:  ',
        value: 'url'
      });
      expect(output[0].paragraphs[7]).to.be.an('Object');
      expect(output[0].paragraphs[7].label).to.equal('DIG URL:  ');
      expect(output[0].paragraphs[7].label).to.be.a('String');
    });
  });

  suite('<client-config> offer tests for offers transform function', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines client config object with offers transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.offers).to.be.an('Function');
    });

    test('defines correct offer array from offer result', function() {
      var output = clientConfig.config.transforms.offer.offers(offerResult);
      assert.equal(output.count, 1);
      assert.isArray(output.data);
      assert.equal(output.data.length, 1);
      assert.equal(output.data[0].id, 'http://dig.isi.edu/ht/data/offer/9E47C0AFA1C00617F6AF1E5DB9D35F8A3F2BE658830653E51AB7CC38C5C9F954');
      assert.equal(output.data[0].type, 'offer');
      assert.equal(output.data[0].icon, 'maps:local-offer');
      assert.equal(output.data[0].link, '/offer.html?value=http://dig.isi.edu/ht/data/offer/9E47C0AFA1C00617F6AF1E5DB9D35F8A3F2BE658830653E51AB7CC38C5C9F954&field=_id');
      assert.equal(output.data[0].styleClass, 'entity-offer-font');
      assert.equal(output.data[0].url, 'http://google.com');
      assert.equal(output.data[0].name, 'This is the title');
      assert.equal(output.data[0].date, 'Oct 17, 2015');
      assert.equal(output.data[0].publisher, 'google.com');
      assert.equal(output.data[0].description, 'This is the description.');
      assert.equal(output.data[0].location, 'West Palm Beach, Florida, United States');

      assert.deepEqual(output.data[0].images, [{
        id: 'http://dig.isi.edu/ht/data/0501F8D47865203415090787585F27A8E738FDC8',
        icon: 'image:photo',
        link: '/image.html?value=http://dig.isi.edu/ht/data/0501F8D47865203415090787585F27A8E738FDC8&field=_id',
        source: 'http://url1',
        styleClass: 'entity-image-font'
      }, {
        id: 'http://dig.isi.edu/ht/data/5C88F2ADC78DDFC173023B04CF0AD9508CD7E88F',
        icon: 'image:photo',
        link: '/image.html?value=http://dig.isi.edu/ht/data/5C88F2ADC78DDFC173023B04CF0AD9508CD7E88F&field=_id',
        source: 'http://url2',
        styleClass: 'entity-image-font'
      }]);

      assert.deepEqual(output.data[0].locations, [{
        key: 'West Palm Beach:Florida:United States:-80.05337:26.71534',
        latitude: '26.71534',
        longitude: '-80.05337',
        icon: 'communication:location-on',
        styleClass: 'entity-location-font',
        text: 'West Palm Beach, Florida, United States',
        type: 'location'
      }]);

      assert.deepEqual(output.data[0].person, {
        id: 'http://dig.isi.edu/ht/data/adultservice/04683C829AF807EC2E2E634FC9F7352FE1CB071C',
        names: [],
        ages: ['24'],
        ethnicities: ['indian'],
        hairColors: [],
        eyeColors: [],
        heights: ['157'],
        weights: ['49'],
        icon: 'icons:account-circle',
        link: '/provider.html?value=http://dig.isi.edu/ht/data/adultservice/04683C829AF807EC2E2E634FC9F7352FE1CB071C&field=_id',
        name: '24, indian',
        styleClass: 'entity-provider-font',
        type: 'provider'
      });

      assert.deepEqual(output.data[0].prices, [{
        icon: 'editor:attach-money',
        styleClass: 'entity-money-font',
        text: '300-per-60min',
        type: 'money'
      }, {
        icon: 'editor:attach-money',
        styleClass: 'entity-money-font',
        text: '400-per-60min',
        type: 'money'
      }]);

      assert.deepEqual(output.data[0].phones, [{
        id: 'http://dig.isi.edu/ht/data/phone/1-1234567890',
        type: 'phone',
        text: '123-456-7890',
        link: '/phone.html?value=http://dig.isi.edu/ht/data/phone/1-1234567890&field=_id',
        icon: 'communication:phone',
        styleClass: 'entity-phone-font'
      }]);

      assert.deepEqual(output.data[0].emails, [{
        id: 'http://dig.isi.edu/ht/data/email/abc%40xyz.com',
        type: 'email',
        text: 'abc@xyz.com',
        link: '/email.html?value=http://dig.isi.edu/ht/data/email/abc%40xyz.com&field=_id',
        icon: 'communication:email',
        styleClass: 'entity-email-font'
      }]);

      assert.deepEqual(output.data[0].webpages, [{
        id: 'http://dig.isi.edu/ht/data/webpage/9E47C0AFA1C00617F6AF1E5DB9D35F8A3F2BE658830653E51AB7CC38C5C9F954',
        icon: 'av:web',
        link: 'http://google.com',
        styleClass: 'entity-webpage-font',
        text: 'http://google.com',
        type: 'webpage'
      }]);

      assert.deepEqual(output.data[0].caches, [{
        id: '9E47C0AFA1C00617F6AF1E5DB9D35F8A3F2BE658830653E51AB7CC38C5C9F954',
        icon: 'icons:cached',
        link: '/cache.html?value=9E47C0AFA1C00617F6AF1E5DB9D35F8A3F2BE658830653E51AB7CC38C5C9F954&field=_id',
        styleClass: 'entity-cache-font',
        text: 'Open Cached Webpage',
        type: 'cache'
      }]);

      assert.deepEqual(output.data[0].locationDescriptor, {
        icon: 'communication:location-on',
        styleClass: 'entity-location-font',
        text: 'West Palm Beach, Florida, United States',
        link: '/location.html?value=West Palm Beach:Florida:United States:-80.05337:26.71534&field=availableAtOrFrom.address.key',
        type: 'location'
      });

      assert.deepEqual(output.data[0].descriptors, [{
        icon: 'icons:date-range',
        styleClass: 'entity-date-font',
        text: 'Oct 17, 2015',
        type: 'date'
      }, {
        icon: 'av:web',
        styleClass: 'entity-webpage-font',
        text: 'google.com',
        type: 'webpage'
      }]);

      assert.deepEqual(output.data[0].details, [{
        name: 'Url',
        link: 'http://google.com',
        text: 'http://google.com'
      }, {
        name: 'Description',
        text: 'This is the description.'
      }, {
        name: 'Cached Webpage',
        link: '/cache.html?value=9E47C0AFA1C00617F6AF1E5DB9D35F8A3F2BE658830653E51AB7CC38C5C9F954&field=_id',
        text: 'Open'
      }]);
    });

    test('defines offer array with correct count from offer aggregation', function() {
      var output = clientConfig.config.transforms.offer.offers(offerAgg);
      expect(output).to.be.an('Object');
      expect(output.data).to.be.an('Array');
      expect(output.data.length).to.equal(2);
      expect(output.count).to.equal(2);
    });

    test('defines correct offer #1 from offer aggregation', function() {
      var output = clientConfig.config.transforms.offer.offers(offerAgg);
      assert.equal(output.data[0].id, 'http://dig.isi.edu/ht/data/offer/3F1A732EAB37911CBB3C2259594ED1A81CA455E776BA729ED584861E836C358C');
      assert.equal(output.data[0].type, 'offer');
      assert.equal(output.data[0].name, 'Title 1');
      assert.equal(output.data[0].icon, 'maps:local-offer');
      assert.equal(output.data[0].link, '/offer.html?value=http://dig.isi.edu/ht/data/offer/3F1A732EAB37911CBB3C2259594ED1A81CA455E776BA729ED584861E836C358C&field=_id');
      assert.equal(output.data[0].styleClass, 'entity-offer-font');
      assert.equal(output.data[0].url, 'http://offerUrl1');
      assert.equal(output.data[0].date, 'Oct 30, 2015');
      assert.equal(output.data[0].publisher, 'Publisher_1');
      assert.equal(output.data[0].description, 'Description 1');
      assert.equal(output.data[0].location, 'Brooklyn, New York, United States');
      // TODO Test data should have images and prices and better person data.
      assert.deepEqual(output.data[0].images, []);
      assert.deepEqual(output.data[0].prices, []);

      assert.deepEqual(output.data[0].locations, [{
        key: 'Brooklyn:New York:United States:-73.94958:40.6501',
        latitude: '40.6501',
        longitude: '-73.94958',
        icon: 'communication:location-on',
        styleClass: 'entity-location-font',
        text: 'Brooklyn, New York, United States',
        type: 'location'
      }]);

      assert.deepEqual(output.data[0].person, {
        id: 'http://dig.isi.edu/ht/data/adultservice/D616C97E26A7EB30EBA624F49FC882A9C1BF92A2',
        names: [],
        ages: [],
        ethnicities: [],
        hairColors: [],
        eyeColors: [],
        heights: [],
        weights: [],
        icon: 'icons:account-circle',
        link: '/provider.html?value=http://dig.isi.edu/ht/data/adultservice/D616C97E26A7EB30EBA624F49FC882A9C1BF92A2&field=_id',
        name: 'Unknown Provider',
        styleClass: 'entity-provider-font',
        type: 'provider'
      });

      assert.deepEqual(output.data[0].phones, [{
        id: 'http://dig.isi.edu/ht/data/phone/1-9876543210',
        icon: 'communication:phone',
        link: '/phone.html?value=http://dig.isi.edu/ht/data/phone/1-9876543210&field=_id',
        styleClass: 'entity-phone-font',
        text: '987-654-3210',
        type: 'phone',
      }]);

      assert.deepEqual(output.data[0].emails, [{
        id: 'http://dig.isi.edu/ht/data/email/abc%40xyz.com',
        icon: 'communication:email',
        link: '/email.html?value=http://dig.isi.edu/ht/data/email/abc%40xyz.com&field=_id',
        styleClass: 'entity-email-font',
        text: 'abc@xyz.com',
        type: 'email'
      }]);

      assert.deepEqual(output.data[0].webpages, [{
        id: 'http://dig.isi.edu/ht/data/webpage/3F1A732EAB37911CBB3C2259594ED1A81CA455E776BA729ED584861E836C358C',
        icon: 'av:web',
        link: 'http://offerUrl1',
        styleClass: 'entity-webpage-font',
        text: 'http://offerUrl1',
        type: 'webpage'
      }]);

      assert.deepEqual(output.data[0].caches, [{
        id: '3F1A732EAB37911CBB3C2259594ED1A81CA455E776BA729ED584861E836C358C',
        icon: 'icons:cached',
        link: '/cache.html?value=3F1A732EAB37911CBB3C2259594ED1A81CA455E776BA729ED584861E836C358C&field=_id',
        styleClass: 'entity-cache-font',
        text: 'Open Cached Webpage',
        type: 'cache'
      }]);

      assert.deepEqual(output.data[0].locationDescriptor, {
        icon: 'communication:location-on',
        styleClass: 'entity-location-font',
        text: 'Brooklyn, New York, United States',
        link: '/location.html?value=Brooklyn:New York:United States:-73.94958:40.6501&field=availableAtOrFrom.address.key',
        type: 'location'
      });

      assert.deepEqual(output.data[0].descriptors, [{
        icon: 'icons:date-range',
        styleClass: 'entity-date-font',
        text: 'Oct 30, 2015',
        type: 'date'
      }, {
        icon: 'av:web',
        styleClass: 'entity-webpage-font',
        text: 'Publisher_1',
        type: 'webpage'
      }]);

      assert.deepEqual(output.data[0].details, [{
        name: 'Url',
        link: 'http://offerUrl1',
        text: 'http://offerUrl1'
      }, {
        name: 'Description',
        text: 'Description 1'
      }, {
        name: 'Cached Webpage',
        link: '/cache.html?value=3F1A732EAB37911CBB3C2259594ED1A81CA455E776BA729ED584861E836C358C&field=_id',
        text: 'Open'
      }]);
    });

    test('defines correct offer #2 from offer aggregation', function() {
      var output = clientConfig.config.transforms.offer.offers(offerAgg);
      assert.equal(output.data[1].id, 'http://dig.isi.edu/ht/data/offer/99A1B80A500E764D522B4F6FFA88107559D7866A2C2F6532D8A4206CC15E5422');
      assert.equal(output.data[1].type, 'offer');
      assert.equal(output.data[1].name, 'Title 2');
      assert.equal(output.data[1].icon, 'maps:local-offer');
      assert.equal(output.data[1].link, '/offer.html?value=http://dig.isi.edu/ht/data/offer/99A1B80A500E764D522B4F6FFA88107559D7866A2C2F6532D8A4206CC15E5422&field=_id');
      assert.equal(output.data[1].styleClass, 'entity-offer-font');
      assert.equal(output.data[1].url, 'http://offerUrl2');
      assert.equal(output.data[1].date, 'Nov 2, 2015');
      assert.equal(output.data[1].publisher, 'Publisher_2');
      assert.equal(output.data[1].description, 'Description 2');
      assert.equal(output.data[1].location, 'Atlanta, Georgia, United States');

      // TODO Test data should have images and prices and better person data.
      assert.deepEqual(output.data[1].images, []);
      assert.deepEqual(output.data[1].prices, []);

      assert.deepEqual(output.data[1].locations, [{
        key: 'Atlanta:Georgia:United States:-84.38798:33.749',
        latitude: '33.749',
        longitude: '-84.38798',
        icon: 'communication:location-on',
        styleClass: 'entity-location-font',
        text: 'Atlanta, Georgia, United States',
        type: 'location'
      }]);

      assert.deepEqual(output.data[1].person, {
        id: 'http://dig.isi.edu/ht/data/adultservice/8CA3AB3D5392444AB60AE344DFD6F89EB0AF8A07',
        names: [],
        ages: [],
        ethnicities: [],
        hairColors: [],
        eyeColors: [],
        heights: [],
        weights: [],
        icon: 'icons:account-circle',
        link: '/provider.html?value=http://dig.isi.edu/ht/data/adultservice/8CA3AB3D5392444AB60AE344DFD6F89EB0AF8A07&field=_id',
        name: 'Unknown Provider',
        styleClass: 'entity-provider-font',
        type: 'provider'
      });

      assert.deepEqual(output.data[1].phones, [{
        id: 'http://dig.isi.edu/ht/data/phone/1-1112223333',
        icon: 'communication:phone',
        link: '/phone.html?value=http://dig.isi.edu/ht/data/phone/1-1112223333&field=_id',
        styleClass: 'entity-phone-font',
        text: '111-222-3333',
        type: 'phone',
      }]);

      assert.deepEqual(output.data[1].emails, [{
        id: 'http://dig.isi.edu/ht/data/email/email2%40gmail.com',
        icon: 'communication:email',
        link: '/email.html?value=http://dig.isi.edu/ht/data/email/email2%40gmail.com&field=_id',
        styleClass: 'entity-email-font',
        text: 'email2@gmail.com',
        type: 'email'
      }]);

      assert.deepEqual(output.data[1].webpages, [{
        id: 'http://dig.isi.edu/ht/data/webpage/99A1B80A500E764D522B4F6FFA88107559D7866A2C2F6532D8A4206CC15E5422',
        icon: 'av:web',
        link: 'http://offerUrl2',
        styleClass: 'entity-webpage-font',
        text: 'http://offerUrl2',
        type: 'webpage'
      }]);

      assert.deepEqual(output.data[1].caches, [{
        id: '99A1B80A500E764D522B4F6FFA88107559D7866A2C2F6532D8A4206CC15E5422',
        icon: 'icons:cached',
        link: '/cache.html?value=99A1B80A500E764D522B4F6FFA88107559D7866A2C2F6532D8A4206CC15E5422&field=_id',
        styleClass: 'entity-cache-font',
        text: 'Open Cached Webpage',
        type: 'cache'
      }]);

      assert.deepEqual(output.data[1].locationDescriptor, {
        icon: 'communication:location-on',
        styleClass: 'entity-location-font',
        text: 'Atlanta, Georgia, United States',
        type: 'location',
        link: '/location.html?value=Atlanta:Georgia:United States:-84.38798:33.749&field=availableAtOrFrom.address.key',
      });

      assert.deepEqual(output.data[1].descriptors, [{
        icon: 'icons:date-range',
        styleClass: 'entity-date-font',
        text: 'Nov 2, 2015',
        type: 'date'
      }, {
        icon: 'av:web',
        styleClass: 'entity-webpage-font',
        text: 'Publisher_2',
        type: 'webpage'
      }]);

      assert.deepEqual(output.data[1].details, [{
        name: 'Url',
        link: 'http://offerUrl2',
        text: 'http://offerUrl2'
      }, {
        name: 'Description',
        text: 'Description 2'
      }, {
        name: 'Cached Webpage',
        link: '/cache.html?value=99A1B80A500E764D522B4F6FFA88107559D7866A2C2F6532D8A4206CC15E5422&field=_id',
        text: 'Open'
      }]);
    });

    test('defines correct offer array from sparse data', function() {
      var output = clientConfig.config.transforms.offer.offers({hits: {hits: [{_id: 'id'}], total: 1}});
      assert.equal(output.count, 1);
      assert.equal(output.data[0].id, 'id');
      assert.equal(output.data[0].type, 'offer');
      assert.equal(output.data[0].name, 'No Title');
      assert.equal(output.data[0].icon, 'maps:local-offer');
      assert.equal(output.data[0].link, '/offer.html?value=id&field=_id');
      assert.equal(output.data[0].styleClass, 'entity-offer-font');
      assert.equal(output.data[0].date, 'No Date');
      assert.equal(output.data[0].publisher, 'No Publisher');
      assert.equal(output.data[0].description, 'No Description');
      assert.equal(output.data[0].location, 'No Location');
      assert.isUndefined(output.data[0].url);
      assert.deepEqual(output.data[0].images, []);
      assert.deepEqual(output.data[0].locations, []);
      assert.deepEqual(output.data[0].phones, []);
      assert.deepEqual(output.data[0].emails, []);
      assert.deepEqual(output.data[0].webpages, []);
      assert.deepEqual(output.data[0].caches, []);
      assert.deepEqual(output.data[0].person, {});

      assert.deepEqual(output.data[0].locationDescriptor, {
        icon: 'communication:location-on',
        styleClass: 'entity-location-font',
        text: 'No Location',
        type: 'location',
        link: undefined
      });

      assert.deepEqual(output.data[0].descriptors, [{
        icon: 'icons:date-range',
        styleClass: 'entity-date-font',
        text: 'No Date',
        type: 'date'
      }, {
        icon: 'av:web',
        styleClass: 'entity-webpage-font',
        text: 'No Publisher',
        type: 'webpage'
      }]);

      assert.deepEqual(output.data[0].details, [{
        name: 'Url',
        link: null,
        text: 'Unavailable'
      }, {
        name: 'Description',
        text: 'No Description'
      }, {
        name: 'Cached Webpage',
        link: null,
        text: 'Unavailable'
      }]);
    });
  });
</script>
</body>
</html>
