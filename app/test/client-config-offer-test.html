<!--
Copyright 2017 Next Century Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>client-config</title>
  <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../bower_components/web-component-tester/browser.js"></script>
  <script src="data/ad-data.js" type="text/javascript"></script>
  <link rel="import" href="../elements/client-config/client-config.html">
  <link rel="import" href="../elements/lodash.html">
</head>

<body>
<test-fixture id="client-config-fixture">
  <template>
    <client-config></client-config>
  </template>
</test-fixture>

<script>
  'use strict';
  /* globals _, suite, setup, fixture, test, expect, assert, AD_DATA */
  /* jshint -W030 */
  suite('<client-config> offer tests', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with offer transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.offer).to.be.a('Function');
    });

    test('defines offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.equal(output.id, 'FB19C30D81EC27912DC9A3905BDF1BE5484D6697EDA2C5A5BDAFF220887A9965');
      assert.equal(output.url, 'http://google.com/abc123');
      assert.equal(output.rank, 1.23);
      assert.equal(output.domain, 'google.com');
      assert.equal(output.type, 'offer');
      assert.equal(output.icon, 'maps:local-offer');
      assert.equal(output.link, '/offer.html?id=FB19C30D81EC27912DC9A3905BDF1BE5484D6697EDA2C5A5BDAFF220887A9965');
      assert.equal(output.styleClass, 'entity-offer-font');
      assert.equal(output.title, 'Test Ad');
      assert.equal(output.description, 'The quick brown fox jumped over the lazy dog.');
      assert.isUndefined(output.highlightedText);
    });

    test('defines date array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.dates, [{
        annotate: false,
        confidence: undefined,
        count: undefined,
        id: '2017-02-06T00:00:00',
        icon: 'icons:date-range',
        link: undefined,
        styleClass: 'entity-date-font',
        text: 'Feb 6, 2017',
        type: 'date'
      }]);
    });

    test('defines publisher array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.publishers, [{
        annotate: false,
        confidence: undefined,
        count: undefined,
        id: 'google.com',
        icon: 'av:web',
        link: undefined,
        styleClass: 'entity-webpage-font',
        text: 'google.com',
        type: 'webpage'
      }]);
    });

    test('defines location array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.locations, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: 'Roanoke:Virginia:United States:-79.94143:37.27097',
        icon: 'communication:location-on',
        latitude: '37.27097',
        longitude: '-79.94143',
        link: '/location.html?id=Roanoke:Virginia:United States:-79.94143:37.27097',
        styleClass: 'entity-location-font',
        text: 'Roanoke, Virginia',
        textAndCount: 'Roanoke, Virginia',
        textAndCountry: 'Roanoke, Virginia, United States',
        type: 'location'
      }, {
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: 'Atlanta:Georgia:United States:-84.38798:33.749',
        icon: 'communication:location-on',
        latitude: '33.749',
        longitude: '-84.38798',
        link: '/location.html?id=Atlanta:Georgia:United States:-84.38798:33.749',
        styleClass: 'entity-location-font',
        text: 'Atlanta, Georgia',
        textAndCount: 'Atlanta, Georgia',
        textAndCountry: 'Atlanta, Georgia, United States',
        type: 'location'
      }, {
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: 'Brooklyn:New York:United States:-73.94958:40.6501',
        icon: 'communication:location-on',
        latitude: '40.6501',
        longitude: '-73.94958',
        link: '/location.html?id=Brooklyn:New York:United States:-73.94958:40.6501',
        styleClass: 'entity-location-font',
        text: 'Brooklyn, New York',
        textAndCount: 'Brooklyn, New York',
        textAndCountry: 'Brooklyn, New York, United States',
        type: 'location'
      }, {
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: 'Houston:Texas:United States:-95.36327:29.76328',
        icon: 'communication:location-on',
        latitude: '29.76328',
        longitude: '-95.36327',
        link: '/location.html?id=Houston:Texas:United States:-95.36327:29.76328',
        styleClass: 'entity-location-font',
        text: 'Houston, Texas',
        textAndCount: 'Houston, Texas',
        textAndCountry: 'Houston, Texas, United States',
        type: 'location'
        /*
      }, {
        annotate: false,
        confidence: 'relaxed',
        count: undefined,
        id: 'Columbus:Ohio:United States:-82.99879:39.96118',
        icon: 'communication:location-on',
        latitude: '39.96118',
        longitude: '-82.99879',
        link: '/location.html?id=Columbus:Ohio:United States:-82.99879:39.96118',
        styleClass: 'entity-location-font',
        text: 'Columbus, Ohio',
        textAndCount: 'Columbus, Ohio',
        textAndCountry: 'Columbus, Ohio, United States',
        type: 'location'
        */
      }]);
    });

    test('defines phone array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.phones, [{
        annotate: true,
        confidence: 'strict',
        count: undefined,
        id: '+1-1234567890',
        link: '/phone.html?id=+1-1234567890',
        icon: 'communication:phone',
        styleClass: 'entity-phone-font',
        text: '123-456-7890',
        type: 'phone'
        /*
      }, {
        annotate: true,
        confidence: 'relaxed',
        count: undefined,
        id: '1112223333',
        link: '/phone.html?id=1112223333',
        icon: 'communication:phone',
        styleClass: 'entity-phone-font',
        text: '111-222-3333',
        type: 'phone'
      }, {
        annotate: true,
        confidence: 'relaxed',
        count: undefined,
        id: '+1-9999999999',
        link: '/phone.html?id=+1-9999999999',
        icon: 'communication:phone',
        styleClass: 'entity-phone-font',
        text: '999-999-9999',
        type: 'phone'
        */
      }]);
    });

    test('defines email array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.emails, [{
        annotate: true,
        confidence: 'strict',
        count: undefined,
        id: 'test@gmail.com',
        link: '/email.html?id=test%40gmail.com',
        icon: 'communication:email',
        styleClass: 'entity-email-font',
        text: 'test@gmail.com',
        type: 'email'
        /*
      }, {
        annotate: true,
        confidence: 'relaxed',
        count: undefined,
        id: 'test@yahoo.com',
        link: '/email.html?id=test%40yahoo.com',
        icon: 'communication:email',
        styleClass: 'entity-email-font',
        text: 'test@yahoo.com',
        type: 'email'
        */
      }]);
    });

    test('defines webpage array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.webpages, [{
        annotate: false,
        confidence: undefined,
        count: undefined,
        id: 'http://google.com/abc123',
        icon: 'av:web',
        link: undefined,
        styleClass: 'entity-webpage-font',
        text: 'http://google.com/abc123',
        type: 'webpage'
      }]);
    });

    test('defines cache array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.caches, [{
        annotate: false,
        confidence: undefined,
        count: undefined,
        id: 'FB19C30D81EC27912DC9A3905BDF1BE5484D6697EDA2C5A5BDAFF220887A9965',
        icon: 'icons:cached',
        link: '/cache.html?id=FB19C30D81EC27912DC9A3905BDF1BE5484D6697EDA2C5A5BDAFF220887A9965',
        styleClass: 'entity-cache-font',
        text: 'Open Cached Ad Webpage',
        type: 'cache'
      }]);
    });

    test('defines review IDs array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.reviewIds, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: '123456',
        icon: 'icons:thumbs-up-down',
        link: undefined,
        styleClass: 'entity-review-font',
        text: '123456',
        type: 'review'
      }]);
    });

    test('defines social media IDs array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.socialIds, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: 'username',
        icon: 'social:public',
        link: undefined,
        styleClass: 'entity-social-font',
        text: 'twitter username',
        type: 'social'
      }]);
    });

    test('defines services array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.services, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: 'massage',
        icon: 'icons:work',
        link: undefined,
        styleClass: 'entity-service-font',
        text: 'massage',
        type: 'service'
        /*
      }, {
        annotate: false,
        confidence: 'relaxed',
        count: undefined,
        id: 'deep tissue',
        icon: 'icons:work',
        link: undefined,
        styleClass: 'entity-service-font',
        text: 'deep tissue',
        type: 'service'
        */
      }]);
    });

    test('defines price array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.prices, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: '180-per-60min',
        icon: 'editor:attach-money',
        link: undefined,
        styleClass: 'entity-money-font',
        text: '180',
        type: 'money'
      }, {
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: '120-per-30min',
        icon: 'editor:attach-money',
        link: undefined,
        styleClass: 'entity-money-font',
        text: '120',
        type: 'money'
        /*
      }, {
        annotate: false,
        confidence: 'relaxed',
        count: undefined,
        id: '75-per-15min',
        icon: 'editor:attach-money',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: '75',
        type: 'provider'
        */
      }]);
    });

    test('defines name array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.names, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: 'bianca',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'bianca',
        type: 'provider'
        /*
      }, {
        annotate: false,
        confidence: 'relaxed',
        count: undefined,
        id: 'sweet',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'sweet',
        type: 'provider'
        */
      }]);
    });

    test('defines age array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.ages, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: '24',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: '24',
        type: 'provider'
        /*
      }, {
        annotate: false,
        confidence: 'relaxed',
        count: undefined,
        id: '35',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: '35',
        type: 'provider'
        */
      }]);
    });

    test('defines ethnicity array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.ethnicities, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: 'hispanic',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'hispanic',
        type: 'provider'
        /*
      }, {
        annotate: false,
        confidence: 'relaxed',
        count: undefined,
        id: 'asian',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'asian',
        type: 'provider'
        */
      }]);
    });

    test('defines gender array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.genders, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: 'female',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'female',
        type: 'provider'
      }]);
    });

    test('defines eye color array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.eyeColors, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: 'brown',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'brown',
        type: 'provider'
        /*
      }, {
        annotate: false,
        confidence: 'relaxed',
        count: undefined,
        id: 'black',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'black',
        type: 'provider'
        */
      }]);
    });

    test('defines hair color array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.hairColors, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: 'black',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'black',
        type: 'provider'
      }]);
    });

    test('defines height array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.heights, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: '157',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: '157',
        type: 'provider'
        /*
      }, {
        annotate: false,
        confidence: 'relaxed',
        count: undefined,
        id: '155',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: '155',
        type: 'provider'
        */
      }]);
    });

    test('defines weight array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.weights, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: '60',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: '60',
        type: 'provider'
        /*
      }, {
        annotate: false,
        confidence: 'relaxed',
        count: undefined,
        id: '78',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: '78',
        type: 'provider'
        */
      }]);
    });

    test('defines detail array in offer', function() {
      var output = clientConfig.config.transforms.offer.offer(AD_DATA);
      assert.deepEqual(output.details, [{
        name: 'Url',
        link: 'http://google.com/abc123',
        text: 'http://google.com/abc123'
      }, {
        highlightedText: undefined,
        name: 'Description',
        text: 'The quick brown fox jumped over the lazy dog.'
      }, {
        name: 'Cached Ad Webpage',
        link: '/cache.html?id=FB19C30D81EC27912DC9A3905BDF1BE5484D6697EDA2C5A5BDAFF220887A9965',
        text: 'Open'
      }]);
    });
  });

  suite('<client-config> offer tests with highlights', function() {
    var clientConfig;
    var data;
    var output;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
      data = _.cloneDeep(AD_DATA);
      data.hits.hits[0].highlight = {
        'fields.title.strict.name': ['<em>Test</em> Ad'],
        'fields.description.strict.name': ['The <em>quick brown</em> fox jumped over the <em>lazy</em> dog.'],
        'fields.city.strict.name': ['<em>Roanoke</em>', '<em>Atlanta</em>'],
        'fields.state.strict.name': ['<em>Texas</em>'],
        'fields.phone.strict.name': ['<em>+1-1234567890</em>'],
        'fields.email.strict.name': ['<em>test@gmail.com</em>'],
        'fields.review_id.strict.name': ['<em>123456</em>'],
        'fields.social_media_id.strict.name': ['twitter <em>username</em>'],
        'fields.service.strict.name': ['<em>massage</em>'],
        'fields.price.strict.name': ['<em>180</em>'],
        'fields.name.strict.name': ['<em>bianca</em>'],
        'fields.gender.strict.name': ['<em>female</em>'],
        'fields.age.strict.name': ['<em>24</em>'],
        'fields.ethnicity.strict.name': ['<em>hispanic</em>'],
        'fields.eye_color.strict.name': ['<em>brown</em>'],
        'fields.hair_color.strict.name': ['<em>black</em>'],
        'fields.height.strict.name': ['<em>157</em>'],
        'fields.weight.strict.name': ['<em>60</em>'],
        'tld': ['<em>google.com</em>']
      };
      output = clientConfig.config.transforms.offer.offer(data);
    });

    test('defines offer', function() {
      assert.equal(output.id, 'FB19C30D81EC27912DC9A3905BDF1BE5484D6697EDA2C5A5BDAFF220887A9965');
      assert.equal(output.url, 'http://google.com/abc123');
      assert.equal(output.rank, 1.23);
      assert.equal(output.domain, 'google.com');
      assert.equal(output.type, 'offer');
      assert.equal(output.icon, 'maps:local-offer');
      assert.equal(output.link, '/offer.html?id=FB19C30D81EC27912DC9A3905BDF1BE5484D6697EDA2C5A5BDAFF220887A9965');
      assert.equal(output.styleClass, 'entity-offer-font');
      assert.equal(output.title, 'Test Ad');
      assert.equal(output.description, 'The quick brown fox jumped over the lazy dog.');
      assert.equal(output.highlightedText, '<em>Test</em> Ad');
    });

    test('defines publisher array in offer', function() {
      assert.deepEqual(output.publishers, [{
        annotate: false,
        confidence: undefined,
        count: undefined,
        highlight: true,
        id: 'google.com',
        icon: 'av:web',
        link: undefined,
        styleClass: 'entity-webpage-font',
        text: 'google.com',
        type: 'webpage'
      }]);
    });

    test('defines location array in offer', function() {
      assert.deepEqual(output.locations, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: 'Roanoke:Virginia:United States:-79.94143:37.27097',
        icon: 'communication:location-on',
        latitude: '37.27097',
        longitude: '-79.94143',
        link: '/location.html?id=Roanoke:Virginia:United States:-79.94143:37.27097',
        styleClass: 'entity-location-font',
        text: 'Roanoke, Virginia',
        textAndCount: 'Roanoke, Virginia',
        textAndCountry: 'Roanoke, Virginia, United States',
        type: 'location'
      }, {
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: 'Atlanta:Georgia:United States:-84.38798:33.749',
        icon: 'communication:location-on',
        latitude: '33.749',
        longitude: '-84.38798',
        link: '/location.html?id=Atlanta:Georgia:United States:-84.38798:33.749',
        styleClass: 'entity-location-font',
        text: 'Atlanta, Georgia',
        textAndCount: 'Atlanta, Georgia',
        textAndCountry: 'Atlanta, Georgia, United States',
        type: 'location'
      }, {
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: 'Brooklyn:New York:United States:-73.94958:40.6501',
        icon: 'communication:location-on',
        latitude: '40.6501',
        longitude: '-73.94958',
        link: '/location.html?id=Brooklyn:New York:United States:-73.94958:40.6501',
        styleClass: 'entity-location-font',
        text: 'Brooklyn, New York',
        textAndCount: 'Brooklyn, New York',
        textAndCountry: 'Brooklyn, New York, United States',
        type: 'location'
      }, {
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: 'Houston:Texas:United States:-95.36327:29.76328',
        icon: 'communication:location-on',
        latitude: '29.76328',
        longitude: '-95.36327',
        link: '/location.html?id=Houston:Texas:United States:-95.36327:29.76328',
        styleClass: 'entity-location-font',
        text: 'Houston, Texas',
        textAndCount: 'Houston, Texas',
        textAndCountry: 'Houston, Texas, United States',
        type: 'location'
      }]);
    });

    test('defines phone array in offer', function() {
      assert.deepEqual(output.phones, [{
        annotate: true,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: '+1-1234567890',
        link: '/phone.html?id=+1-1234567890',
        icon: 'communication:phone',
        styleClass: 'entity-phone-font',
        text: '123-456-7890',
        type: 'phone'
      }]);
    });

    test('defines email array in offer', function() {
      assert.deepEqual(output.emails, [{
        annotate: true,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: 'test@gmail.com',
        icon: 'communication:email',
        link: '/email.html?id=test%40gmail.com',
        styleClass: 'entity-email-font',
        text: 'test@gmail.com',
        type: 'email'
      }]);
    });

    test('defines review IDs array in offer', function() {
      assert.deepEqual(output.reviewIds, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: '123456',
        icon: 'icons:thumbs-up-down',
        link: undefined,
        styleClass: 'entity-review-font',
        text: '123456',
        type: 'review'
      }]);
    });

    test('defines social media IDs array in offer', function() {
      assert.deepEqual(output.socialIds, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: 'username',
        icon: 'social:public',
        link: undefined,
        styleClass: 'entity-social-font',
        text: 'twitter username',
        type: 'social'
      }]);
    });

    test('defines services array in offer', function() {
      assert.deepEqual(output.services, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: 'massage',
        icon: 'icons:work',
        link: undefined,
        styleClass: 'entity-service-font',
        text: 'massage',
        type: 'service'
      }]);
    });

    test('defines price array in offer', function() {
      assert.deepEqual(output.prices, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: '180-per-60min',
        icon: 'editor:attach-money',
        link: undefined,
        styleClass: 'entity-money-font',
        text: '180',
        type: 'money'
      }, {
        annotate: false,
        confidence: 'strict',
        count: undefined,
        id: '120-per-30min',
        icon: 'editor:attach-money',
        link: undefined,
        styleClass: 'entity-money-font',
        text: '120',
        type: 'money'
      }]);
    });

    test('defines name array in offer', function() {
      assert.deepEqual(output.names, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: 'bianca',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'bianca',
        type: 'provider'
      }]);
    });

    test('defines age array in offer', function() {
      assert.deepEqual(output.ages, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: '24',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: '24',
        type: 'provider'
      }]);
    });

    test('defines ethnicity array in offer', function() {
      assert.deepEqual(output.ethnicities, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: 'hispanic',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'hispanic',
        type: 'provider'
      }]);
    });

    test('defines gender array in offer', function() {
      assert.deepEqual(output.genders, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: 'female',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'female',
        type: 'provider'
      }]);
    });

    test('defines eye color array in offer', function() {
      assert.deepEqual(output.eyeColors, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: 'brown',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'brown',
        type: 'provider'
      }]);
    });

    test('defines hair color array in offer', function() {
      assert.deepEqual(output.hairColors, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: 'black',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: 'black',
        type: 'provider'
      }]);
    });

    test('defines height array in offer', function() {
      assert.deepEqual(output.heights, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: '157',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: '157',
        type: 'provider'
      }]);
    });

    test('defines weight array in offer', function() {
      assert.deepEqual(output.weights, [{
        annotate: false,
        confidence: 'strict',
        count: undefined,
        highlight: true,
        id: '60',
        icon: 'icons:account-circle',
        link: undefined,
        styleClass: 'entity-provider-font',
        text: '60',
        type: 'provider'
      }]);
    });

    test('defines detail array in offer', function() {
      assert.deepEqual(output.details, [{
        name: 'Url',
        link: 'http://google.com/abc123',
        text: 'http://google.com/abc123'
      }, {
        highlightedText: 'The <em>quick brown</em> fox jumped over the <em>lazy</em> dog.',
        name: 'Description',
        text: 'The quick brown fox jumped over the lazy dog.'
      }, {
        name: 'Cached Ad Webpage',
        link: '/cache.html?id=FB19C30D81EC27912DC9A3905BDF1BE5484D6697EDA2C5A5BDAFF220887A9965',
        text: 'Open'
      }]);
    });
  });

  suite('<client-config> offer tests with highlights (edge cases)', function() {
    var clientConfig;
    var data;
    var output;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
      data = _.cloneDeep(AD_DATA);
      data.hits.hits[0].highlight = {
        'fields.email.strict.name': ['<em>test</em>@gmail.com'],
        'tld': ['<em>google</em>.com']
      };
      output = clientConfig.config.transforms.offer.offer(data);
    });

    test('does not define highlight in publisher if partial match', function() {
      assert.deepEqual(output.publishers, [{
        annotate: false,
        confidence: undefined,
        count: undefined,
        id: 'google.com',
        icon: 'av:web',
        link: undefined,
        styleClass: 'entity-webpage-font',
        text: 'google.com',
        type: 'webpage'
      }]);
    });

    test('does not define highlight in email if partial match', function() {
      assert.deepEqual(output.emails, [{
        annotate: true,
        confidence: 'strict',
        count: undefined,
        id: 'test@gmail.com',
        link: '/email.html?id=test%40gmail.com',
        icon: 'communication:email',
        styleClass: 'entity-email-font',
        text: 'test@gmail.com',
        type: 'email'
      }]);
    });
  });

  suite('<client-config> offer tests if offer result does not have data', function() {
    var clientConfig;
    var output;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      output = clientConfig.config.transforms.offer.offer({
        hits: {
          hits: [{
            _source: {
              doc_id: 'testId',
              tld: 'testDomain',
              url: 'testUrl'
            }
          }]
        }
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */
    });

    test('defines offer', function() {
      assert.equal(output.id, 'testId');
      assert.equal(output.url, 'testUrl');
      assert.equal(output.domain, 'testDomain');
      assert.equal(output.type, 'offer');
      assert.equal(output.icon, 'maps:local-offer');
      assert.equal(output.link, '/offer.html?id=testId');
      assert.equal(output.styleClass, 'entity-offer-font');
      assert.equal(output.title, 'No Title');
      assert.equal(output.description, 'No Description');
      assert.deepEqual(output.locations, []);
      assert.deepEqual(output.phones, []);
      assert.deepEqual(output.emails, []);
      assert.deepEqual(output.services, []);
      assert.deepEqual(output.prices, []);
      assert.deepEqual(output.names, []);
      assert.deepEqual(output.ages, []);
      assert.deepEqual(output.ethnicities, []);
      assert.deepEqual(output.genders, []);
      assert.deepEqual(output.hairColors, []);
      assert.deepEqual(output.eyeColors, []);
      assert.deepEqual(output.heights, []);
      assert.deepEqual(output.weights, []);
    });

    test('defines date array in offer', function() {
      assert.deepEqual(output.dates, [{
        annotate: false,
        confidence: undefined,
        count: undefined,
        id: undefined,
        icon: 'icons:date-range',
        link: undefined,
        styleClass: 'entity-date-font',
        text: 'No Date',
        type: 'date'
      }]);
    });

    test('defines publisher array in offer', function() {
      assert.deepEqual(output.publishers, [{
        annotate: false,
        confidence: undefined,
        count: undefined,
        id: 'testDomain',
        icon: 'av:web',
        link: undefined,
        styleClass: 'entity-webpage-font',
        text: 'testDomain',
        type: 'webpage'
      }]);
    });

    test('defines webpage array in offer', function() {
      assert.deepEqual(output.webpages, [{
        annotate: false,
        confidence: undefined,
        count: undefined,
        id: 'testUrl',
        icon: 'av:web',
        link: undefined,
        styleClass: 'entity-webpage-font',
        text: 'testUrl',
        type: 'webpage'
      }]);
    });

    test('defines cache array in offer', function() {
      assert.deepEqual(output.caches, [{
        annotate: false,
        confidence: undefined,
        count: undefined,
        id: 'testId',
        icon: 'icons:cached',
        link: '/cache.html?id=testId',
        styleClass: 'entity-cache-font',
        text: 'Open Cached Ad Webpage',
        type: 'cache'
      }]);
    });

    test('defines detail array in offer', function() {
      assert.deepEqual(output.details, [{
        name: 'Url',
        link: 'testUrl',
        text: 'testUrl'
      }, {
        highlightedText: undefined,
        name: 'Description',
        text: 'No Description'
      }, {
        name: 'Cached Ad Webpage',
        link: '/cache.html?id=testId',
        text: 'Open'
      }]);
    });
  });

  suite('<client-config> offer tests if no results from query', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines empty offer for empty data', function() {
      var output = clientConfig.config.transforms.offer.offer({
        hits: {
          hits: []
        }
      });
      assert.deepEqual(output, {});
    });

    test('defines empty offer for data with no id', function() {
      var output = clientConfig.config.transforms.offer.offer({
        hits: {
          hits: [{
            tld: 'google.com',
            url: 'http://google.com'
          }]
        }
      });
      assert.deepEqual(output, {});
    });

    test('defines empty offer for data with no tld', function() {
      var output = clientConfig.config.transforms.offer.offer({
        hits: {
          hits: [{
            id: '1',
            url: 'http://google.com'
          }]
        }
      });
      assert.deepEqual(output, {});
    });

    test('defines empty offer for data with no url', function() {
      var output = clientConfig.config.transforms.offer.offer({
        hits: {
          hits: [{
            id: '1',
            url: 'http://google.com'
          }]
        }
      });
      assert.deepEqual(output, {});
    });
  });

  suite('<client-config> offer tests for offer extractions', function() {
    var clientConfig;
    /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
    var data = {
      aggregations: {
        phone: {
          phone: {
            buckets: [{
              doc_count: 10,
              key: '+1-9876543210',
            }, {
              doc_count: 1,
              key: '1234567890',
            }]
          }
        }
      }
    };
    /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with offer extractions transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.offerExtractions).to.be.a('Function');
    });

    test('offer extractions function given empty input array returns correct output', function() {
      var output = clientConfig.config.transforms.offer.offerExtractions([], {
        property: 'phone',
        type: 'phone'
      });
      expect(output.header).to.deep.equal('No Telephone Numbers');
      expect(output.data).to.deep.equal([]);
    });

    test('offer extractions function given input array and config returns correct output', function() {
      var output = clientConfig.config.transforms.offer.offerExtractions(data, {
        property: 'phone',
        type: 'phone'
      });
      expect(output.header).to.equal('2 Telephone Numbers');
      expect(output.data).to.deep.equal([{
        annotate: true,
        confidence: undefined,
        count: 10,
        id: '+1-9876543210',
        icon: 'communication:phone',
        link: '/phone.html?id=+1-9876543210',
        styleClass: 'entity-phone-font',
        text: '987-654-3210',
        type: 'phone'
      }, {
        annotate: true,
        confidence: undefined,
        count: 1,
        id: '1234567890',
        icon: 'communication:phone',
        link: '/phone.html?id=1234567890',
        styleClass: 'entity-phone-font',
        text: '123-456-7890',
        type: 'phone'
      }]);
    });

    test('offer extractions function given input array and config with ID to ignore returns correct output', function() {
      var output = clientConfig.config.transforms.offer.offerExtractions(data, {
        ignoreId: '+1-9876543210',
        property: 'phone',
        type: 'phone'
      });
      expect(output.header).to.equal('1 Other Telephone Number');
      expect(output.data).to.deep.equal([{
        annotate: true,
        confidence: undefined,
        count: 1,
        id: '1234567890',
        icon: 'communication:phone',
        link: '/phone.html?id=1234567890',
        styleClass: 'entity-phone-font',
        text: '123-456-7890',
        type: 'phone'
      }]);
    });
  });

  suite('<client-config> offer tests for offer locations header', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with offer locations header transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.offerLocationsHeader).to.be.a('Function');
    });

    test('offer locations header function given input returns correct output', function() {
      var output = clientConfig.config.transforms.offer.offerLocationsHeader([]);
      expect(output).to.deep.equal('No Locations');
    });

    test('offer locations header function given array with single element returns correct array', function() {
      var output = clientConfig.config.transforms.offer.offerLocationsHeader([1]);
      expect(output).to.deep.equal('1 Location');
    });

    test('offer locations header function given array with multiple elements returns correct array', function() {
      var output = clientConfig.config.transforms.offer.offerLocationsHeader([1, 2, 3]);
      expect(output).to.deep.equal('3 Locations');
    });
  });

  suite('<client-config> offer tests for the location page map data', function() {
    var clientConfig;
    var data = [{
      id: 'Atlanta:Georgia:United States:-84.38798:33.749'
    }, {
      id: 'Brooklyn:New York:United States:-73.94958:40.6501'
    }, {
      id: 'Houston:Texas:United States:-95.36327:29.76328'
    }];

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with map locations transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.locationPageMap).to.be.a('Function');
    });

    test('defines locations for map location aggregation buckets', function() {
      var output = clientConfig.config.transforms.offer.locationPageMap('Atlanta:Georgia:United States:-84.38798:33.749', data);
      expect(output).to.deep.equal([{
        iconId: 'mainLocation',
        id: 'Atlanta:Georgia:United States:-84.38798:33.749'
      }, {
        id: 'Brooklyn:New York:United States:-73.94958:40.6501'
      }, {
        id: 'Houston:Texas:United States:-95.36327:29.76328'
      }]);
    });

    test('if the first location argument is not yet defined, transform returns undefined', function() {
      var output = clientConfig.config.transforms.offer.locationPageMap(undefined, data);
      expect(output).to.be.undefined;
    });

    test('if aggregation argument is not yet defined, transform returns undefined', function() {
      var output = clientConfig.config.transforms.offer.locationPageMap('Atlanta:Georgia:United States:-84.38798:33.749', undefined);
      expect(output).to.be.undefined;
    });
  });

  suite('<client-config> offer revisions tests', function() {
    var clientConfig;

    setup(function() {
      clientConfig = fixture('client-config-fixture');
    });

    test('defines config object with revisions transform function', function() {
      expect(clientConfig).to.exist;
      expect(clientConfig.config).to.be.an('Object');
      expect(clientConfig.config.transforms).to.be.an('Object');
      expect(clientConfig.config.transforms.offer).to.be.an('Object');
      expect(clientConfig.config.transforms.offer.revisions).to.be.an('Function');
    });

    test('defines revisions for multiple dates', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = clientConfig.config.transforms.offer.revisions({
        aggregations: {
          revisions: {
            doc_count: 15,
            revisions: {
              buckets: [{
                key_as_string: '2016-01-01T00:00:00.000Z',
                doc_count: 10
              }, {
                key_as_string: '2016-01-02T00:00:00.000Z',
                doc_count: 5
              }]
            }
          }
        }
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output).to.deep.equal([{
        date: 'Jan 1, 2016',
        list: [{
          count: 10,
          label: 'Revision on Jan 1, 2016'
        }]
      }, {
        date: 'Jan 2, 2016',
        list: [{
          count: 5,
          label: 'Revision on Jan 2, 2016'
        }]
      }]);
    });

    test('defines revisions for single date with multiple revisions', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = clientConfig.config.transforms.offer.revisions({
        aggregations: {
          revisions: {
            doc_count: 5,
            revisions: {
              buckets: [{
                key_as_string: '2016-01-01T00:00:00.000Z',
                doc_count: 5
              }]
            }
          }
        }
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output).to.deep.equal([{
        date: 'Jan 1, 2016',
        list: [{
          count: 5,
          label: 'Revision on Jan 1, 2016'
        }]
      }]);
    });

    test('defines revisions for a single date with single revision as an empty array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = clientConfig.config.transforms.offer.revisions({
        aggregations: {
          revisions: {
            doc_count: 1,
            revisions: {
              buckets: [{
                key_as_string: '2016-01-01T00:00:00.000Z',
                doc_count: 1
              }]
            }
          }
        }
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output).to.deep.equal([]);
    });
  });
</script>
</body>
</html>
