<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>drops-timeline-transform</title>

  <script src="../bower_components/webcomponentsjs/webcomponents.min.js"></script>
  <script src="../bower_components/web-component-tester/browser.js"></script>
  <script src="../bower_components/test-fixture/test-fixture-mocha.js"></script>
  <script src="../bower_components/test-fixture/test-fixture-mocha.js"></script>
  <script src="../scripts/drops-timeline-transform.js"></script>
  <link rel="import" href="../bower_components/test-fixture/test-fixture.html">

  <link rel="import" href="../bower_components/json-transform/json-transform.html">

</head>
<body>

<test-fixture id="drops-timeline-transformation-fixture">
  <template>
    <!-- Unit testing the transformation function for drops timeline -->
    <json-transform></json-transform>
  </template>
</test-fixture>

<script>
  /* globals suite, setup, fixture, test, expect, dropsTimelineTransform */
  /* jshint -W030 */
  suite('<drops-timeline>', function() {
    var dropsTimelineTransformationElem;

    setup(function() {
      dropsTimelineTransformationElem = fixture('drops-timeline-transformation-fixture');
      dropsTimelineTransformationElem.transformFunction = dropsTimelineTransform();
    });

    test('good response from ES server should transform data correctly', function() {
      var dataIn = JSON.parse('{"took":2,"timed_out":false,"_shards":{"total":5,"successful":5,"failed":0},"hits":{"total":1,"max_score":1,"hits":[{"_index":"dig-1","_type":"offer","_id":"http://dig.isi.edu/ht/data/offer/A1E9F90509D7E721EE20607707B16E0C7D3EA6CB659AD8F1E5C15676CD787387","_score":1,"_source":{"a":"Offer","availableAtOrFrom":{"uri":"http://dig.isi.edu/ht/data/offer/A1E9F90509D7E721EE20607707B16E0C7D3EA6CB659AD8F1E5C15676CD787387/place","address":[{"a":"http://schema.org/PostalAddress","addressCountry":"India","uri":"http://dig.isi.edu/ht/data/offer/A1E9F90509D7E721EE20607707B16E0C7D3EA6CB659AD8F1E5C15676CD787387/address","addressLocality":"Mumbai","addressRegion":"State of Maharashtra","key":"Mumbai:State of Maharashtra:India:72.88261:19.07283","extractorOutput":"Mumbai","geo":{"latitude":"19.07283","a":"http://schema.org/GeoCoordinates","longitude":"72.88261"}}]},"title":["Escorts Service In Nashik Available Aunties Neetu 9860309861 - Mumbai escorts - backpage.com"],"uri":"http://dig.isi.edu/ht/data/offer/A1E9F90509D7E721EE20607707B16E0C7D3EA6CB659AD8F1E5C15676CD787387","seller":{"a":"http://schema.dig.isi.edu/ontology/PersonOrOrganization","telephone":[{"a":"http://schema.dig.isi.edu/ontology/PhoneNumber","uri":"http://dig.isi.edu/ht/data/phone/1-9503320944","name":"9503320944"},{"a":"http://schema.dig.isi.edu/ontology/PhoneNumber","uri":"http://dig.isi.edu/ht/data/phone/1-9860309861","name":"9860309861"}],"uri":"http://dig.isi.edu/ht/data/seller/9F2BBE81E3BEFD509F0FB8A59F1046A7B232C886"},"itemOffered":{"a":"http://schema.dig.isi.edu/ontology/AdultService","age":"24","uri":"http://dig.isi.edu/ht/data/adultservice/9F2BBE81E3BEFD509F0FB8A59F1046A7B232C886"},"mainEntityOfPage":{"a":"http://schema.org/WebPage","publisher":{"a":"http://schema.org/Organization","uri":"http://dig.isi.edu/ht/data/organization/backpage.com","name":"backpage.com"},"description":"Neetu 9860309861    Best Escort In Nashik India, Best Model Escort In Nashik India, Bollywood Model Escort Nashik India, Bombay Model Escort Service Nashik India, Call Girl In Nashik India, Call Girls In Nashik India, Cheapest Model Escort In Nashik India, Elite Nashik Model Escort India, Best Escort In Nashik India, Best Model Escort In Nashik India, Bollywood Model Escort Nashik India, Bombay Model Escort Service Nashik India, Call Girl In Nashik India, Call Girls In Nashik India, Cheapest Model Escort In Nashik India, Elite Nashik Model Escort India    For Booking  Neetu 9860309861, 9503320944     Visit on  -  nasikcallgirls.com","url":"http://mumbai.backpage.com/FemaleEscorts/escorts-service-in-nashik-available-aunties-neetu-9860309861/18429386","uri":"http://dig.isi.edu/ht/data/webpage/A1E9F90509D7E721EE20607707B16E0C7D3EA6CB659AD8F1E5C15676CD787387","dateCreated":"2015-10-12T00:00:00","mentions":["http://dig.isi.edu/ht/data/phone/1-9503320944","http://dig.isi.edu/ht/data/phone/1-9860309861"],"name":["Escorts Service In Nashik Available Aunties Neetu 9860309861 - Mumbai escorts - backpage.com"]},"validFrom":"2015-10-12T09:32:00"}}]},"aggregations":{"locations":{"doc_count":1,"locations":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"Mumbai:State of Maharashtra:India:72.88261:19.07283","doc_count":1,"dates":{"buckets":[{"key_as_string":"2015-10-12T00:00:00.000Z","key":1444608000000,"doc_count":1}]}}]}}}}');
      var dataOut;
      dropsTimelineTransformationElem.dataIn = dataIn;
      dropsTimelineTransformationElem.dataOut = dataOut;
      expect(dataOut).to.be.an('object');
      expect(dataOut).to.be.deep.equal(JSON.parse('{"data":[{"name":"Mumbai","data":["2015-10-12T00:00:00.000Z"]}],"timestamps":[1444608000000]}'));
    });

    test('good response from ES server (multiple phone numbers) should transform data correctly', function() {
      var dataIn = JSON.parse('{"took":4,"timed_out":false,"_shards":{"total":5,"successful":5,"failed":0},"hits":{"total":1,"max_score":1,"hits":[{"_index":"dig-1","_type":"offer","_id":"http://dig.isi.edu/ht/data/offer/0F804B25561DEF71338015A4011D3FB8EFBD629D6D92326FDC66DB58CD69A39B","_score":1,"_source":{"a":"Offer","availableAtOrFrom":{"uri":"http://dig.isi.edu/ht/data/offer/0F804B25561DEF71338015A4011D3FB8EFBD629D6D92326FDC66DB58CD69A39B/place","address":[{"a":"http://schema.org/PostalAddress","addressCountry":"India","uri":"http://dig.isi.edu/ht/data/offer/0F804B25561DEF71338015A4011D3FB8EFBD629D6D92326FDC66DB58CD69A39B/address","addressLocality":"Mumbai","addressRegion":"State of Maharashtra","key":"Mumbai:State of Maharashtra:India:72.88261:19.07283","extractorOutput":"Mumbai","geo":{"latitude":"19.07283","a":"http://schema.org/GeoCoordinates","longitude":"72.88261"}}]},"title":["Hot Models In Nashik Escorts Services Prity 7387632159 07030636260 - Mumbai escorts - backpage.com"],"uri":"http://dig.isi.edu/ht/data/offer/0F804B25561DEF71338015A4011D3FB8EFBD629D6D92326FDC66DB58CD69A39B","seller":{"a":"http://schema.dig.isi.edu/ontology/PersonOrOrganization","telephone":[{"a":"http://schema.dig.isi.edu/ontology/PhoneNumber","uri":"http://dig.isi.edu/ht/data/phone/1-7387632159","name":"7387632159"},{"a":"http://schema.dig.isi.edu/ontology/PhoneNumber","uri":"http://dig.isi.edu/ht/data/phone/1-7030636260","name":"7030636260"},{"a":"http://schema.dig.isi.edu/ontology/PhoneNumber","uri":"http://dig.isi.edu/ht/data/phone/1-15907030636","name":"15907030636"}],"uri":"http://dig.isi.edu/ht/data/seller/BB9ECAEDB9A272C5F702728AF1E2A76EB760F33E"},"itemOffered":{"a":"http://schema.dig.isi.edu/ontology/AdultService","age":["24"],"uri":"http://dig.isi.edu/ht/data/adultservice/BB9ECAEDB9A272C5F702728AF1E2A76EB760F33E"},"mainEntityOfPage":{"a":"http://schema.org/WebPage","publisher":{"a":"http://schema.org/Organization","uri":"http://dig.isi.edu/ht/data/organization/backpage.com","name":"backpage.com"},"description":"Prity  073876 32159 , 07030636260 \n \nHigh Profile Girls  \nModel Escort Girl In Nashik India, Model Escort In Nashik India, Model Escort In Navi Nashik India, Model Escort Independent Nashik India, Model Escort Nashik Independent India, Model Escort Nashik India, Model Escort Service In Nashik India, Model Escort Service Nashik India, Model Escort Services In Nashik India, Model Escort Services Nashik India, Female Escort In Nashik India, Female Model Escort In Nashik India \n \nFor Booking Prity  07387632159, 07030636260 \nVisit On -  nasikescortsservices.com","url":"http://mumbai.backpage.com/FemaleEscorts/hot-models-in-nashik-escorts-services-prity-7387632159-07030636260/18265277","uri":"http://dig.isi.edu/ht/data/webpage/0F804B25561DEF71338015A4011D3FB8EFBD629D6D92326FDC66DB58CD69A39B","dateCreated":"2015-10-05T00:00:00","mentions":["http://dig.isi.edu/ht/data/phone/1-7387632159","http://dig.isi.edu/ht/data/phone/1-7030636260","http://dig.isi.edu/ht/data/phone/1-15907030636"],"name":["Hot Models In Nashik Escorts Services Prity 7387632159 07030636260 - Mumbai escorts - backpage.com"]},"validFrom":"2015-10-05T10:35:00"}}]},"aggregations":{"locations":{"doc_count":1,"locations":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"Mumbai:State of Maharashtra:India:72.88261:19.07283","doc_count":1,"dates":{"buckets":[{"key_as_string":"2015-10-05T00:00:00.000Z","key":1444003200000,"doc_count":1}]}}]}}}}');
      var dataOut;
      dropsTimelineTransformationElem.dataIn = dataIn;
      dropsTimelineTransformationElem.dataOut = dataOut;
      expect(dataOut).to.be.an('object');
      expect(dataOut).to.be.deep.equal(JSON.parse('{"data":[{"name":"Mumbai","data":["2015-10-05T00:00:00.000Z"]}],"timestamps":[1444003200000]}'));
    });

    test('good response from ES server (multiple aggs result) should transform data correctly', function() {
      var dataIn = JSON.parse('{"took":4,"timed_out":false,"_shards":{"total":5,"successful":5,"failed":0},"hits":{"total":1,"max_score":1,"hits":[{"_index":"dig-1","_type":"offer","_id":"http://dig.isi.edu/ht/data/offer/0F804B25561DEF71338015A4011D3FB8EFBD629D6D92326FDC66DB58CD69A39B","_score":1,"_source":{"a":"Offer","availableAtOrFrom":{"uri":"http://dig.isi.edu/ht/data/offer/0F804B25561DEF71338015A4011D3FB8EFBD629D6D92326FDC66DB58CD69A39B/place","address":[{"a":"http://schema.org/PostalAddress","addressCountry":"India","uri":"http://dig.isi.edu/ht/data/offer/0F804B25561DEF71338015A4011D3FB8EFBD629D6D92326FDC66DB58CD69A39B/address","addressLocality":"Mumbai","addressRegion":"State of Maharashtra","key":"Mumbai:State of Maharashtra:India:72.88261:19.07283","extractorOutput":"Mumbai","geo":{"latitude":"19.07283","a":"http://schema.org/GeoCoordinates","longitude":"72.88261"}}]},"title":["Hot Models In Nashik Escorts Services Prity 7387632159 07030636260 - Mumbai escorts - backpage.com"],"uri":"http://dig.isi.edu/ht/data/offer/0F804B25561DEF71338015A4011D3FB8EFBD629D6D92326FDC66DB58CD69A39B","seller":{"a":"http://schema.dig.isi.edu/ontology/PersonOrOrganization","telephone":[{"a":"http://schema.dig.isi.edu/ontology/PhoneNumber","uri":"http://dig.isi.edu/ht/data/phone/1-7387632159","name":"7387632159"},{"a":"http://schema.dig.isi.edu/ontology/PhoneNumber","uri":"http://dig.isi.edu/ht/data/phone/1-7030636260","name":"7030636260"},{"a":"http://schema.dig.isi.edu/ontology/PhoneNumber","uri":"http://dig.isi.edu/ht/data/phone/1-15907030636","name":"15907030636"}],"uri":"http://dig.isi.edu/ht/data/seller/BB9ECAEDB9A272C5F702728AF1E2A76EB760F33E"},"itemOffered":{"a":"http://schema.dig.isi.edu/ontology/AdultService","age":["24"],"uri":"http://dig.isi.edu/ht/data/adultservice/BB9ECAEDB9A272C5F702728AF1E2A76EB760F33E"},"mainEntityOfPage":{"a":"http://schema.org/WebPage","publisher":{"a":"http://schema.org/Organization","uri":"http://dig.isi.edu/ht/data/organization/backpage.com","name":"backpage.com"},"description":"Prity  073876 32159 , 07030636260 \n \nHigh Profile Girls  \nModel Escort Girl In Nashik India, Model Escort In Nashik India, Model Escort In Navi Nashik India, Model Escort Independent Nashik India, Model Escort Nashik Independent India, Model Escort Nashik India, Model Escort Service In Nashik India, Model Escort Service Nashik India, Model Escort Services In Nashik India, Model Escort Services Nashik India, Female Escort In Nashik India, Female Model Escort In Nashik India \n \nFor Booking Prity  07387632159, 07030636260 \nVisit On -  nasikescortsservices.com","url":"http://mumbai.backpage.com/FemaleEscorts/hot-models-in-nashik-escorts-services-prity-7387632159-07030636260/18265277","uri":"http://dig.isi.edu/ht/data/webpage/0F804B25561DEF71338015A4011D3FB8EFBD629D6D92326FDC66DB58CD69A39B","dateCreated":"2015-10-05T00:00:00","mentions":["http://dig.isi.edu/ht/data/phone/1-7387632159","http://dig.isi.edu/ht/data/phone/1-7030636260","http://dig.isi.edu/ht/data/phone/1-15907030636"],"name":["Hot Models In Nashik Escorts Services Prity 7387632159 07030636260 - Mumbai escorts - backpage.com"]},"validFrom":"2015-10-05T10:35:00"}}]},"aggregations":{"locations":{"doc_count":1,"locations":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"Mumbai:State of Maharashtra:India:72.88261:19.07283","doc_count":1,"dates":{"buckets":[{"key_as_string":"2015-10-05T00:00:00.000Z","key":1444003200000,"doc_count":1}]}}]}}}}');
      var dataOut;
      dropsTimelineTransformationElem.dataIn = dataIn;
      dropsTimelineTransformationElem.dataOut = dataOut;
      expect(dataOut).to.be.an('object');
      expect(dataOut).to.be.deep.equal(JSON.parse('{"data":[{"name":"Mumbai","data":["2015-10-05T00:00:00.000Z"]}],"timestamps":[1444003200000]}'));
    });

    test('empty response from ES server should be handled correctly', function() {
      var dataIn = '';
      var dataOut;
      dropsTimelineTransformationElem.dataIn = dataIn;
      dropsTimelineTransformationElem.dataOut = dataOut;
      expect(dataOut).to.be.an('object');
      expect(dataOut).to.be.deep.equal({
        data: [],
        timestamps: []
      });
    });
  });
</script>

</body>
</html>
